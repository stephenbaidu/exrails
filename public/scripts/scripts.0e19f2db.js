window&&!window.InflectionJS&&(window.InflectionJS=null),InflectionJS={uncountable_words:["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news","status","info"],plural_rules:[[new RegExp("(m)an$","gi"),"$1en"],[new RegExp("(pe)rson$","gi"),"$1ople"],[new RegExp("(child)$","gi"),"$1ren"],[new RegExp("^(ox)$","gi"),"$1en"],[new RegExp("(ax|test)is$","gi"),"$1es"],[new RegExp("(octop|vir)us$","gi"),"$1i"],[new RegExp("(alias|status)$","gi"),"$1es"],[new RegExp("(bu)s$","gi"),"$1ses"],[new RegExp("(buffal|tomat|potat)o$","gi"),"$1oes"],[new RegExp("([ti])um$","gi"),"$1a"],[new RegExp("sis$","gi"),"ses"],[new RegExp("(?:([^f])fe|([lr])f)$","gi"),"$1$2ves"],[new RegExp("(hive)$","gi"),"$1s"],[new RegExp("([^aeiouy]|qu)y$","gi"),"$1ies"],[new RegExp("(x|ch|ss|sh)$","gi"),"$1es"],[new RegExp("(matr|vert|ind)ix|ex$","gi"),"$1ices"],[new RegExp("([m|l])ouse$","gi"),"$1ice"],[new RegExp("(quiz)$","gi"),"$1zes"],[new RegExp("s$","gi"),"s"],[new RegExp("$","gi"),"s"]],singular_rules:[[new RegExp("(m)en$","gi"),"$1an"],[new RegExp("(pe)ople$","gi"),"$1rson"],[new RegExp("(child)ren$","gi"),"$1"],[new RegExp("([ti])a$","gi"),"$1um"],[new RegExp("((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$","gi"),"$1$2sis"],[new RegExp("(hive)s$","gi"),"$1"],[new RegExp("(tive)s$","gi"),"$1"],[new RegExp("(curve)s$","gi"),"$1"],[new RegExp("([lr])ves$","gi"),"$1f"],[new RegExp("([^fo])ves$","gi"),"$1fe"],[new RegExp("([^aeiouy]|qu)ies$","gi"),"$1y"],[new RegExp("(s)eries$","gi"),"$1eries"],[new RegExp("(m)ovies$","gi"),"$1ovie"],[new RegExp("(x|ch|ss|sh)es$","gi"),"$1"],[new RegExp("([m|l])ice$","gi"),"$1ouse"],[new RegExp("(bus)es$","gi"),"$1"],[new RegExp("(o)es$","gi"),"$1"],[new RegExp("(shoe)s$","gi"),"$1"],[new RegExp("(cris|ax|test)es$","gi"),"$1is"],[new RegExp("(octop|vir)i$","gi"),"$1us"],[new RegExp("(alias|status)es$","gi"),"$1"],[new RegExp("^(ox)en","gi"),"$1"],[new RegExp("(vert|ind)ices$","gi"),"$1ex"],[new RegExp("(matr)ices$","gi"),"$1ix"],[new RegExp("(quiz)zes$","gi"),"$1"],[new RegExp("s$","gi"),""]],non_titlecased_words:["and","or","nor","a","an","the","so","but","to","of","at","by","from","into","on","onto","off","out","in","over","with","for"],id_suffix:new RegExp("(_ids|_id)$","g"),underbar:new RegExp("_","g"),space_or_underbar:new RegExp("[ _]","g"),uppercase:new RegExp("([A-Z])","g"),underbar_prefix:new RegExp("^_"),apply_rules:function(a,b,c,d){if(d)a=d;else{var e=c.indexOf(a.toLowerCase())>-1;if(!e)for(var f=0;f<b.length;f++)if(a.match(b[f][0])){a=a.replace(b[f][0],b[f][1]);break}}return a}},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b,c){b||(b=-1);for(var d=-1,e=b;e<this.length;e++)if(this[e]===a||c&&c(this[e],a)){d=e;break}return d}),String.prototype._uncountable_words||(String.prototype._uncountable_words=InflectionJS.uncountable_words),String.prototype._plural_rules||(String.prototype._plural_rules=InflectionJS.plural_rules),String.prototype._singular_rules||(String.prototype._singular_rules=InflectionJS.singular_rules),String.prototype._non_titlecased_words||(String.prototype._non_titlecased_words=InflectionJS.non_titlecased_words),String.prototype.pluralize||(String.prototype.pluralize=function(a){return InflectionJS.apply_rules(this.toString(),this._plural_rules,this._uncountable_words,a)}),String.prototype.singularize||(String.prototype.singularize=function(a){return InflectionJS.apply_rules(this.toString(),this._singular_rules,this._uncountable_words,a)}),String.prototype.camelize||(String.prototype.camelize=function(a){for(var b=this.toLowerCase(),c=b.split("/"),d=0;d<c.length;d++){for(var e=c[d].split("_"),f=a&&d+1===c.length?1:0,g=f;g<e.length;g++)e[g]=e[g].charAt(0).toUpperCase()+e[g].substring(1);c[d]=e.join("")}return b=c.join("::")}),String.prototype.underscore||(String.prototype.underscore=function(){for(var a=this,b=a.split("::"),c=0;c<b.length;c++)b[c]=b[c].replace(InflectionJS.uppercase,"_$1"),b[c]=b[c].replace(InflectionJS.underbar_prefix,"");return a=b.join("/").toLowerCase()}),String.prototype.humanize||(String.prototype.humanize=function(a){var b=this.toLowerCase();return b=b.replace(InflectionJS.id_suffix,""),b=b.replace(InflectionJS.underbar," "),a||(b=b.capitalize()),b}),String.prototype.capitalize||(String.prototype.capitalize=function(){var a=this.toLowerCase();return a=a.substring(0,1).toUpperCase()+a.substring(1)}),String.prototype.dasherize||(String.prototype.dasherize=function(){var a=this;return a=a.replace(InflectionJS.space_or_underbar,"-")}),String.prototype.titleize||(String.prototype.titleize=function(){var a=this.toLowerCase();a=a.replace(InflectionJS.underbar," ");for(var b=a.split(" "),c=0;c<b.length;c++){for(var d=b[c].split("-"),e=0;e<d.length;e++)this._non_titlecased_words.indexOf(d[e].toLowerCase())<0&&(d[e]=d[e].capitalize());b[c]=d.join("-")}return a=b.join(" "),a=a.substring(0,1).toUpperCase()+a.substring(1)}),String.prototype.demodulize||(String.prototype.demodulize=function(){var a=this,b=a.split("::");return a=b[b.length-1]}),String.prototype.tableize||(String.prototype.tableize=function(){var a=this;return a=a.underscore().pluralize()}),String.prototype.classify||(String.prototype.classify=function(){var a=this;return a=a.camelize().singularize()}),String.prototype.foreign_key||(String.prototype.foreign_key=function(a){var b=this;return b=b.demodulize().underscore()+(a?"":"_")+"id"}),String.prototype.ordinalize||(String.prototype.ordinalize=function(){for(var a=this,b=a.split(" "),c=0;c<b.length;c++){var d=parseInt(b[c]);if(NaN===d){var e=b[c].substring(b[c].length-2),f=b[c].substring(b[c].length-1),g="th";"11"!=e&&"12"!=e&&"13"!=e&&("1"===f?g="st":"2"===f?g="nd":"3"===f&&(g="rd")),b[c]+=g}}return a=b.join(" ")}),window.Modernizr=function(a,b,c){function d(a){n.cssText=a}function e(a,b){return typeof a===b}var f,g,h,i="2.8.3",j={},k=b.documentElement,l="modernizr",m=b.createElement(l),n=m.style,o=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),p={},q=[],r=q.slice,s=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:l+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',l,'">',a,"</style>"].join(""),j.id=l,(m?j:n).innerHTML+=f,n.appendChild(j),m||(n.style.background="",n.style.overflow="hidden",i=k.style.overflow,k.style.overflow="hidden",k.appendChild(n)),g=c(j,a),m?j.parentNode.removeChild(j):(n.parentNode.removeChild(n),k.style.overflow=i),!!g},t={}.hasOwnProperty;h=e(t,"undefined")||e(t.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return t.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=r.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(r.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(r.call(arguments)))};return d}),p.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:s(["@media (",o.join("touch-enabled),("),l,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c};for(var u in p)h(p,u)&&(g=u.toLowerCase(),j[g]=p[u](),q.push((j[g]?"":"no-")+g));return j.addTest=function(a,b){if("object"==typeof a)for(var d in a)h(a,d)&&j.addTest(d,a[d]);else{if(a=a.toLowerCase(),j[a]!==c)return j;b="function"==typeof b?b():b,"undefined"!=typeof enableClasses&&enableClasses&&(k.className+=" "+(b?"":"no-")+a),j[a]=b}return j},d(""),m=f=null,j._version=i,j._prefixes=o,j.testStyles=s,j}(this,this.document),function(a){"use strict";if("undefined"==typeof XLSX)return void console.log("xlsx.js is required. Get it from https://github.com/SheetJS/js-xlsx");if("undefined"==typeof _)return void console.log("Lodash.js is required. Get it from http://lodash.com/");var b=this,c=(b.XLSXReader,function(a,b,d,e){var f={};return c.utils.intializeFromFile(f,a,b,d,e),f});"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.XLSXReader=c):b.XLSXReader=c,c.VERSION="0.0.1",c.utils={intializeFromFile:function(a,b,d,e,f){var g=new FileReader;g.onload=function(b){var g=b.target.result,h=XLSX.read(g,{type:"binary"});a.sheets=c.utils.parseWorkbook(h,d,e),f(a)},g.readAsBinaryString(b)},parseWorkbook:function(a,b,d){if(d===!0)return c.utils.to_json(a);var e={};return _.forEachRight(a.SheetNames,function(d){var f=a.Sheets[d];e[d]=c.utils.parseSheet(f,b)}),e},parseSheet:function(b,c){var d=XLSX.utils.decode_range(b["!ref"]),e=[];return c===!0&&_.forEachRight(_.range(d.s.r,d.e.r+1),function(c){var f=[];_.forEachRight(_.range(d.s.c,d.e.c+1),function(d){var e=XLSX.utils.encode_cell({c:d,r:c}),g=b[e];f[d]=g?g.v:a}),e[c]=f}),{data:e,name:b.name,col_size:d.e.c+1,row_size:d.e.r+1}},to_json:function(a){var b={};return a.SheetNames.forEach(function(c){var d=XLSX.utils.sheet_to_row_object_array(a.Sheets[c]);d.length>0&&(b[c]=d)}),b}}}.call(this);var app=angular.module("angularApp",["ngAria","ngCookies","ngMessages","ngResource","ngRoute","ui.router","ngSanitize","ngTouch","ng-token-auth","angular-underscore","chart.js","angularFileUpload","ng-mfb","ui.select","ui.bootstrap","xeditable","daterangepicker","angular-loading-bar","pascalprecht.translate","formly","formlyBootstrap"]);angular.module("angularApp").constant("APP",{root:"/",apiPrefix:"/api/",partials:{fab:"app/partials/floating-action-button.html",filterInput:"app/partials/filter-input.html",header:"app/partials/header.html",searchForm:"app/partials/search-form.html",indexGrid:"app/partials/index-grid.html",indexGridName:"app/partials/index-grid-name.html",indexGridNoLink:"app/partials/index-grid-no-link.html",indexGridPopUp:"app/partials/index-grid-pop-up.html",loadMoreButton:"app/partials/load-more-button.html",formlyForm:"app/partials/formly-form.html",formNewButtons:"app/partials/form-new-buttons.html",formShowButtons:"app/partials/form-show-buttons.html",formEditButtons:"app/partials/form-edit-buttons.html",bulkNav:"app/partials/bulk-nav.html",bulkGrid:"app/partials/bulk-grid.html",uploadsGrid:"app/partials/uploads-grid.html",closeButton:"app/partials/close-button.html"}}),angular.module("angularApp").run(["APP",function(a){a.modules={main:[{text:"Users",url:"users",icon:"fa fa-users color-deep-purple-300"},{text:"Roles",url:"roles",icon:"glyphicon glyphicon-user color-red-100"},{text:"UserForm",url:"form/roles",icon:"fa fa-user color-teal-500"}],admin:[{text:"Users",url:"users",icon:"fa fa-briefcase color-deep-purple-300"},{text:"Roles",url:"roles",icon:"fa fa-user color-red-100"}],reports:[{text:"User",url:"user_info",icon:"fa fa-files-o color-teal-500"},{text:"Users",url:"users",icon:"fa fa-clipboard color-blue-grey-500"},{text:"Roles",url:"roles",icon:"fa fa-clipboard"}]}}]),angular.module("angularApp").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),b.when("/","/main"),a.state("app",{url:"/?q",templateUrl:"app/layouts/app.html",controller:"AppCtrl",resolve:{auth:["$auth","$state","$rootScope",function(a,b,c){return a.validateUser()["catch"](function(){b.go("login")})}]}}).state("login",{url:"/login",templateUrl:"app/layouts/login.html",controller:"LoginCtrl"}).state("maintenance",{url:"/maintenance",templateUrl:"app/layouts/maintenance.html"}).state("app.dashboard",{url:"dashboard",templateUrl:function(a){return"app/layouts/dashboard.html"},controller:"ModuleCtrl"}).state("app.reports",{url:"reports",templateUrl:function(a){return"app/layouts/reports_module.html"}}).state("app.reports.report",{url:"/:report",templateUrl:function(a){return"app/components/reports/show.html"},controller:"ReportCtrl"}).state("app.module",{url:":module",templateUrl:function(a){return"app/layouts/"+a.module+"_module.html"},controller:"ModuleCtrl"}).state("app.module.reports",{url:"/report",template:"<div ui-view></div>"}).state("app.module.reports.report",{url:"/:report",templateUrl:function(a){return"app/components/reports/show.html"},controller:"ReportCtrl"}).state("app.module.form",{url:"/form/:model",onEnter:["$stateParams","$state","$uibModal",function(a,b,c){c.open({templateUrl:"app/components/"+a.model+"/new.html",size:"lg"}).result["finally"](function(){b.go("^")})}]}).state("app.module.model",{url:"/:model",templateUrl:function(a){return"app/components/"+a.model+"/index.html"}}).state("app.module.model.new",{url:"/new",templateUrl:function(a){return"app/components/"+a.model+"/new.html"}}).state("app.module.model.show",{url:"/:id",templateUrl:function(a){return"app/components/"+a.model+"/show.html"}}).state("app.module.model.newPop",{url:"/new/pop",onEnter:["$stateParams","$state","$uibModal",function(a,b,c){c.open({templateUrl:"app/components/"+a.model+"/new.html",size:"lg"}).result["finally"](function(){b.go("^")})}]}).state("app.module.model.showPop",{url:"/:id/pop",onEnter:["$stateParams","$state","$uibModal",function(a,b,c){c.open({templateUrl:"app/components/"+a.model+"/show.html",size:"lg"}).result["finally"](function(){b.go("^")})}]}).state("app.module.model.page",{url:"/p/:page",templateUrl:function(a){return"app/components/"+a.model+"/"+a.page+".html"}}).state("app.module.model.bulk",{url:"/:id/bulk/:table",templateUrl:function(a){return"app/components/"+a.model+"/bulk.html"}}).state("app.module.model.view",{url:"/:id/:view",templateUrl:function(a){return"app/components/"+a.model+"/"+a.view+".html"}})}]),angular.module("angularApp").config(["$authProvider",function(a){a.configure({apiUrl:"/api",confirmationSuccessUrl:window.location.href.split("#")[0]})}]).factory("auth401Interceptor",["$q","$location",function(a,b){return{responseError:function(c){return 401===c.status&&b.path("/login"),a.reject(c)}}}]).config(["$httpProvider",function(a){a.interceptors.push("auth401Interceptor")}]).factory("auth404Interceptor",["$q","$location","exMsg",function(a,b,c){return{responseError:function(b){return 404===b.status&&c.sweetAlert("Invalid request","","error"),a.reject(b)}}}]).config(["$httpProvider",function(a){a.interceptors.push("auth404Interceptor")}]).factory("$exceptionHandler",function(){return function(a,b){}}).run(["editableOptions",function(a){a.theme="bs3"}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]).config(["formlyConfigProvider",function(a){a.setType({name:"ex-input",templateUrl:"app/templates/ex-input.html",wrapper:["bootstrapLabel","bootstrapHasError"],overwriteOk:!0}),a.setType({name:"ex-select",templateUrl:"app/templates/ex-select.html",wrapper:["bootstrapLabel","bootstrapHasError"],overwriteOk:!0}),a.setType({name:"ex-select-multiple",templateUrl:"app/templates/ex-select-multiple.html",wrapper:["bootstrapLabel","bootstrapHasError"],overwriteOk:!0}),a.setType({name:"ex-datepicker",templateUrl:"app/templates/ex-datepicker.html",wrapper:["bootstrapLabel","bootstrapHasError"],overwriteOk:!0}),a.setWrapper({name:"validation",types:["ex-input","ex-select","ex-select-multiple","ex-datepicker"],templateUrl:"app/templates/error-messages.html"})}]).run(["formlyConfig","formlyValidationMessages",function(a,b){a.extras.errorExistsAndShouldBeVisibleExpression="fc.$touched || form.$submitted",b.addStringMessage("required","This field is required")}]).filter("whereMulti",function(){return function(a,b,c){var d=[];return angular.isArray(c)&&c.forEach(function(c){for(var e=0;e<a.length;e++)if(c==a[e][b]){d.push(a[e]);break}}),d}}),angular.module("angularApp").filter("byId",function(){return function(a,b){for(var c=0,d=a.length;d>c;c++)if(+a[c].id==+b)return a[c];return{}}}),angular.module("angularApp").filter("byValue",function(){return function(a,b){for(var c=0,d=a.length;d>c;c++)if(+a[c].value==+b)return a[c];return{}}}),angular.module("angularApp").service("exMsg",["$q",function(a){return{notify:function(a){new PNotify(a)},success:function(a,b){new PNotify({title:b||"Success",text:a,type:"success",nonblock:!0})},error:function(a,b){new PNotify({title:b||"Error",text:a,type:"error",nonblock:!0,nonblock_opacity:.2})},notice:function(a,b){new PNotify({text:a,type:"notice",nonblock:!0,nonblock_opacity:.5})},info:function(a,b){new PNotify({title:b||"Info",text:a,addclass:"custom",opacity:.8,nonblock:!0,nonblock_opacity:.2})},errorSummary:function(a){var b="<ul>";angular.forEach(a,function(a){b+="<li>"+a+"</li>"}),b+="</ul>",new PNotify({title:"Error Summary",text:b,type:"error",hide:!1})},confirm:function(b,c){var d=a.defer();return sweetAlert({title:c||"Confirm",text:b,type:"warning",showCancelButton:!0,animation:"slide-from-top"},function(a){return a?(d.resolve(!0),!0):(d.reject(!1),!1)}),d.promise},clear:function(){PNotify.removeAll()},sweetAlert:sweetAlert,prompt:function(b,c,d,e){var f=a.defer(),g={title:c||"Input Needed",text:b,type:"input",inputValue:d||"",showCancelButton:!0,animation:"slide-from-top"};return _.merge(g,e||{}),sweetAlert(g,function(a){return a===!1?(f.reject(!1),!1):(f.resolve(a),!0)}),f.promise}}}]),angular.module("angularApp").directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)},isExcel:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|vnd.openxmlformats-officedocument.spreadsheetml.sheet|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)){var h=c.find("canvas"),i=new FileReader;if(i.onload=e,b.isImage(g.file))i.readAsDataURL(g.file);else if(!b.isExcel(g.file))return}}}}}]),angular.module("angularApp").directive("ngFile",function(){return{scope:{ngFile:"="},link:function(a,b,c){b.bind("change",function(b){a.$apply(function(){"multiple"in c?a.ngFile=b.target.files:a.ngFile=b.target.files[0]})})}}}),angular.module("angularApp").service("resourceManager",["$q","$http","$resource",function(a,b,c){var d={models:{}};return window.rm=d,d.getName=function(a){return a=a.replace(/-/gi,"_"),a=a.underscore().split("_"),a=a.slice(0,a.length-1).join("_").camelize()+a[a.length-1].classify()},d.getUrl=function(a){return a=a.underscore().split("_"),a=a.slice(0,a.length-1).join("_").camelize()+a[a.length-1].pluralize().camelize(),a.underscore()},d.getModel=function(a,b){return b=b||{},b.name=a=this.getName(a),b.url||(b.url=this.getUrl(a)),b.key||(b.key=a.underscore()),b.title||(b.title=b.url.titleize()),b},d.register=function(a,b,d,e){if(a=this.getName(a),d=d||{id:"@id"},e=e||{},!this.models[a]){var f=c(b,d,{query:{method:"GET",isArray:!0},update:{method:"PUT"}});app.factory(a,function(){return f}),this.models[a]=this.getModel(a,e),this.models[a].apiUrl=b,this.models[a].klass=f}return this.models[a]},d.query=function(b,c,d){var e=a.defer();return b=this.getName(b),this.models[b].klass.query(c,function(a,b){a.error||a.errors?e.reject(a):e.resolve(a),d&&d(a,b("_meta_total"))},function(a){e.reject(a)}).$promise["catch"](function(a){window.error=a,e.reject({message:"Sorry, you do not have permission."})}),e.promise},d.get=function(b,c,d){var e=a.defer();return b=this.getName(b),this.models[b].klass.get(c,function(a,b){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d.create=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$save(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d.update=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$update(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d["delete"]=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$delete(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d}]),angular.module("angularApp").service("reportService",["$document",function(a){return{toCSV:function(b,c,d,e){var f=this.objectify(c);d=d||this.getColumns(f),b=b||"Report",e=e||!0;var g="Report_"+(new Date).toISOString().replace(/\:/g,"-").replace(".","-")+".csv",h="";if(h+=b+"\r\n\n",e){var i=_.chain(d).map(function(a){return a.title}).value().join(",");h+=i+"\r\n"}h+=_.chain(f).map(function(a){return _.chain(d).map(function(b){return a[b.key]}).value().join(",")}).value().join("\r\n");var j="data:text/csv;charset=utf-8,"+escape(h),k=a[0].createElement("a");k.href=j,k.style.visibility="hidden",k.download=g,a[0].body.appendChild(k),k.click(),a[0].body.removeChild(k)},toPDF:function(a,b,c){var d=this.objectify(b);c=c||this.getColumns(d),a=a||"Report";var e="Report_"+(new Date).toISOString().replace(/\:/g,"-").replace(".","-")+".pdf",f=new jsPDF("l","pt"),g=function(b,c,d){b.setFontSize(20),b.text(a,d.margins.horizontal,60),b.setFontSize(d.fontSize)};f.autoTable(c,d,{renderHeader:g,margins:{horizontal:40,top:80,bottom:50}}),f.save(e)},objectify:function(a){return"object"!=typeof a?JSON.parse(a):a},getColumns:function(a){var b=["string","number"],c=a[0];return _.chain(c).keys().reject(function(a){return 0==a.indexOf("$")}).filter(function(a){return b.indexOf(typeof c[a])>=0}).map(function(a){return{title:a,key:a}}).value()}}}]),angular.module("angularApp").factory("XLSXReaderService",["$q","$rootScope",function(a,b){var c=function(a){angular.extend(this,a)};return c.readFile=function(c,d,e){var f=a.defer();return XLSXReader(c,d,e,function(a){b.$apply(function(){f.resolve(a)})}),f.promise},c}]),angular.module("angularApp").service("gridService",function(){var a={},b={get:function(b){return angular.copy(a[b])||[]},set:function(b,c){a[b]=c}};return b}),angular.module("angularApp").service("fieldService",function(){var a={},b={get:function(b){return angular.copy(a[b])||[]},set:function(b,c){a[b]=c}};return b}),angular.module("angularApp").service("lookupService",["APP","$http",function(a,b){var c={};return{get:function(a,b){return c[a]||this.load(a),c[a][b]},load:function(d,e){var f=a.apiPrefix+"lookups/"+d;return b.get(f,{cache:!0,params:{models:e}}).success(function(a){return c[d]=a,a})}}}]),angular.module("angularApp").service("authService",["$auth",function(a){var b={hasAccess:function(b){var c=b||"";if(c=c.replace(/-/gi,"_"),c.indexOf(":")<0)if(c=c.split("?")[0],c.indexOf("/")<0)c=c.classify()+":index";else{var d=/^([A-z-_]+)\/new/gi,e=/^form\/([A-z-_]+)/gi,f=/^([A-z-_]+)\/(\d+)\/show/gi,g=/^([A-z-_]+)\/(\d+)\/edit/gi,h=d.exec(c),i=e.exec(c),j=f.exec(c),k=g.exec(c);h?c=h[1].classify()+":create":i?c=i[1].classify()+":create":j?c=j[1].classify()+":show":k&&(c=k[1].classify()+":update")}var l=_.find(a.user.permissions,function(a){return a===c});return void 0===l?!1:!0},hasCreateAccess:function(a){return this.hasAccess(a+":create")},hasShowAccess:function(a){return this.hasAccess(a+":show")},hasUpdateAccess:function(a){return this.hasAccess(a+":update")},hasDeleteAccess:function(a){return this.hasAccess(a+":delete")}};return b}]),angular.module("angularApp").service("stateService",["$rootScope","$state","$uibModalStack",function(a,b,c){var d={isIndex:!0,isNew:!1,isNewPop:!1,isShow:!1,isShowPop:!1,isView:!1,isBulk:!1,showIndex:!0,hideNameGrid:!1,update:function(a){a&&(this.isIndex="app.module.model"===a.name,this.isNew="app.module.model.new"===a.name||"app.module.form.model"===a.name,this.isNewPop="app.module.model.newPop"===a.name,this.isShow="app.module.model.show"===a.name,this.isShowPop="app.module.model.showPop"===a.name,this.isView="app.module.model.view"===a.name,this.isBulk="app.module.model.bulk"===a.name,this.showIndex=this.isIndex||this.isNewPop||this.isShowPop,this.hideNameGrid=this.showIndex||this.isBulk)}};return a.$on("$stateChangeSuccess",function(a,b,c,e,f){d.update(b)}),d.update(b.current),d}]),angular.module("angularApp").controller("NgTokenAuthEventsCtrl",["$scope","$rootScope","$auth","exMsg","$state",function(a,b,c,d,e){var f=a;window.ngTokenAuthEventsCtrl=f,window.exMsg=d,PNotify.prototype.options.delay=3e3,f.$on("auth:login-success",function(a,b){console.log("auth:login-success"),d.info("Welcome, "+b.name),e.go("app")}),f.$on("auth:login-error",function(a,b){console.log("auth:login-error");var c=b.errors[0];d.sweetAlert({title:"Login Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:invalid",function(a){console.log("auth:invalid")}),f.$on("auth:validation-success",function(a){console.log("auth:validation-success"),"login"===e.$current.name&&e.go("app")}),f.$on("auth:validation-error",function(a){console.log("auth:validation-error")}),f.$on("auth:logout-success",function(a){console.log("auth:logout-success"),d.info("Goodbye"),"login"!==e.$current.name&&e.go("login")}),f.$on("auth:logout-error",function(a,b){console.log("auth:logout-error"),d.error("Unable to complete logout. Please try again.")}),f.$on("auth:registration-email-success",function(a,b){console.log("auth:registration-email-success");var c="A registration email was sent to "+b.email+". Follow the instructions contained in the email to complete registration.";d.sweetAlert({title:"Registration Successful",text:c,type:"success",animation:"slide-from-top"},function(){e.go(".",{},{reload:!0})})}),f.$on("auth:registration-email-error",function(a,b){console.log("auth:registration-email-error");var c=b.errors.full_messages[0];d.sweetAlert({title:"Registration Failed",text:c,type:"error",animation:"slide-from-top"})}),b.$on("auth:email-confirmation-success",function(a,b){console.log("auth:email-confirmation-success");var c="Your account has been verified";d.sweetAlert({title:"Welcome, "+b.name,text:c,type:"info",animation:"slide-from-top"})}),f.$on("auth:email-confirmation-error",function(a,b){console.log("auth:email-confirmation-error"),d.error("There was an error with your registration.")}),f.$on("auth:password-reset-request-success",function(a,b){console.log("auth:password-reset-request-success");var c="Password reset instructions were sent to "+b.email;d.sweetAlert({title:"Password Reset",text:c,type:"info",animation:"slide-from-top"})}),f.$on("auth:password-reset-request-error",function(a,b){console.log("auth:password-reset-request-error");var c=b.errors[0];d.sweetAlert({title:"Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:password-reset-confirm-success",function(){console.log("auth:password-reset-confirm-success"),d.sweetAlert({title:"Reset Password",text:"New Password:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password"},function(a){return a===!1?!1:""===a?(d.sweetAlert.showInputError("No password provided!"),!1):void d.sweetAlert({title:"Reset Password",text:"New Password Again:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password Again"},function(b){return b===!1?!1:""===b?(d.sweetAlert.showInputError("No password provided!"),!1):void c.updatePassword({password:a,password_confirmation:b})})})}),f.$on("auth:password-reset-confirm-error",function(a,b){console.log("auth:password-reset-confirm-error");var c="Unable to verify your account. Please try again.";d.sweetAlert({title:"Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:password-change-success",function(a){console.log("auth:password-change-success");var b="Your password has been successfully updated!";d.sweetAlert({title:"Successful",text:b,type:"info",animation:"slide-from-top"})}),f.$on("auth:password-change-error",function(a,b){console.log("auth:password-change-error");var c="Registration failed: "+b.errors[0];d.sweetAlert({title:"Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:account-update-success",function(a){console.log("auth:account-update-success");var b="Your account has been successfully updated!";d.sweetAlert({title:"Successful",text:b,type:"info",animation:"slide-from-top"})}),f.$on("auth:account-update-error",function(a,b){console.log("auth:account-update-error");var c="Registration failed: "+b.errors[0];d.sweetAlert({title:"Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:account-destroy-success",function(a){console.log("auth:account-destroy-success");var b="Your account has been successfully destroyed!";d.sweetAlert({title:"Successful",text:b,type:"info",animation:"slide-from-top"})}),f.$on("auth:account-destroy-error",function(a,b){console.log("auth:account-destroy-error");var c="Account deletion failed: "+b.errors[0];d.sweetAlert({title:"Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:session-expired",function(a){console.log("auth:session-expired"),"login"!==e.$current.name&&e.go("login")})}]),angular.module("angularApp").controller("LoginCtrl",["$scope","$rootScope","$auth","$http","$state","exMsg","APP",function(a,b,c,d,e,f,g){var h=a;window.loginCtrl=h,h.sendPasswordResetEmail=function(){f.sweetAlert({title:"Password Reset",text:"Email",type:"input",showCancelButton:!0,animation:"slide-from-top"},function(a){return a===!1?!1:""===a?(f.sweetAlert.showInputError("No email provided!"),!1):void c.requestPasswordReset({email:a})})},h.sendConfirmationInstructions=function(){f.sweetAlert({title:"Confirmation Instructions",text:"Email",type:"input",showCancelButton:!0,animation:"slide-from-top"},function(a){return a===!1?!1:""===a?(f.sweetAlert.showInputError("No email provided!"),!1):void d.post(g.apiPrefix+"users/send_confirmation_instructions",{email:a}).success(function(a){a.error?f.sweetAlert("Error",a.message,"error"):f.sweetAlert("Successful",a.message,"success")})})}}]),angular.module("angularApp").controller("AppCtrl",["$scope","$rootScope","$http","$auth","$q","$state","APP","exMsg","$stateParams","authService","stateService",function(a,b,c,d,e,f,g,h,i,j,k){var l=a;window.appCtrl=l,b.partials=g.partials||{},b.modules=g.modules||{},d.validateToken(),b.state=k,b.hasAccess=j.hasAccess,l.drpOptions={showDropdowns:!0,ranges:{Today:[moment().startOf("day"),moment().endOf("day")],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment().endOf("day")],"Last 30 Days":[moment().subtract(29,"days"),moment().endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left"},l.drpOptionsR={showDropdowns:!0,ranges:{Today:[moment().startOf("day"),moment().endOf("day")],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment().endOf("day")],"Last 30 Days":[moment().subtract(29,"days"),moment().endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"right"},b.error=function(a){a=a||{},a.message&&h.error(a.message,a.type||"Error"),a.messages&&h.errorSummary(a.messages)},l.back=function(){f.go("^")},l.hasUrl=function(a){return window.location.hash.indexOf(a)>=0},l.buildQ=function(a){return _.map(a,function(a,b){return b+".eq."+a}).join(":")},l.splitQ=function(a){var b={};return a.split(":").forEach(function(a){var c=a.split(".eq.");c[1]&&(b[c[0]]=c[1])}),b},l.showPasswordChange=function(){h.sweetAlert({title:"Change Password",text:"Current Password:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Current Password"},function(a){return a===!1?!1:""===a?(h.sweetAlert.showInputError("No password provided!"),!1):void h.sweetAlert({title:"Change Password",text:"New Password:",type:"input",
inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password"},function(b){return b===!1?!1:""===b?(h.sweetAlert.showInputError("No password provided!"),!1):void h.sweetAlert({title:"Change Password",text:"New Password Again:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password Again"},function(e){return e===!1?!1:""===e?(h.sweetAlert.showInputError("No password provided!"),!1):void c.post(g.apiPrefix+"users/"+d.user.id+"/change_password",{current_password:a,password:b,password_confirmation:e}).success(function(a){a.error?h.sweetAlert(a.message,(a.messages||[]).join("\n"),"error"):h.sweetAlert("Great!","Password changed successfully","success")})["catch"](function(a){h.sweetAlert("Sorry!","Password changed failed","error")})})})})}}]),angular.module("angularApp").controller("ModuleCtrl",["$scope","APP","$state",function(a,b,c){var d=a;window.moduleCtrl=d,d.hideFloatingActionButton=!0,d.fabActions=[],d.fabMenuState="closed",d.fabMainIcon="fa-chevron-left",d.fabMainLabel="Back",d.fabMainAction=function(){c.go("^")},d.$on("$stateChangeStart",function(a,b,c,e,f){d.hideFloatingActionButton=!0}),d.$on("fab:load-actions",function(a,b,e,f){var g=["fa fa-columns","fa fa-link","fa fa-th-large","fa fa-file-o"];d.fabActions=_.map(e,function(a){return{icon:a.icon||g.pop(),label:a.label,handler:function(){a.handler&&a.handler()}}}).reverse(),f=f||{icon:"fa-chevron-left",label:"Back",handler:function(){c.go("^")}},d.fabMainIcon=f.icon,d.fabMainLabel=f.label,d.fabMainAction=f.handler,d.hideFloatingActionButton=!1})}]),angular.module("angularApp").controller("IndexCtrl",["$scope","$rootScope","$state","$stateParams","$q","$http","APP","resourceManager","$filter","exMsg","byValueFilter","dateFilter","reportService","lookupService","byIdFilter","gridService","authService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a,b){L.modelName=b||h.getName(a),L.model=h.register(L.modelName,g.apiPrefix+a+"/:id"),L.grid=p.get(L.model.key),s()}function s(){f.get(g.apiPrefix+"config/"+L.model.url).success(function(c){L.lookups=c.lookups,L.schema=c.schema,L.initSearch(),b.$broadcast("model:index-config-loaded",L.model.name,c,a)}).error(function(a,b,c,d){})}function t(){if(a.state.isIndex){var c=[],d={};L.hasCreateAccess()&&(d={icon:"fa fa-plus",label:"New "+L.model.name,handler:L["new"]}),c.push({icon:"fa fa-search",label:"Search",handler:L.showSearch}),b.$broadcast("fab:load-actions",L.model.name,c,d)}}function u(c,d,e){L.action.loading=!0,e||(e=L.searchQuery||{}),e.page=c||L.paging.currentPage,e.size=d||L.paging.recordsPerPage,h.query(L.model.name,e,function(a,b){L.paging.totalRecords=b}).then(function(c){L.updateRecords(c),b.$broadcast("model:records-loaded",L.model.name,L.records,a)})["catch"](function(a){console.log(a),L.error(a)})["finally"](function(a){L.action.loading=!1})}function v(a,b){var c=L.schema.properties[b],d=c&&c.lookup||!1,e=a[b];return d?k(L.lookups[d],e).name:"date"===c.type?l(e):"datetime"===c.type?l(e,"yyyy-MM-dd HH:mm:ss"):e}function w(a){a&&a.id&&n.load(L.model.key).then(function(b){var c=b.data;angular.forEach(L.schema.properties,function(b,d){b.lookup&&c[b.lookup]&&!a[b.lookup]&&(a[b.lookup]=k(c[b.lookup],a[d]))})})}function x(a){angular.forEach(a,function(a){L.recordsHash[a.id]||(L.records.push(a),L.recordsHash[a.id]=!0,L.polishRecord(a))})}function y(a){if(a){var b=_.findIndex(L.records,_.pick(a,"id"));b>=0&&(L.records[b]=angular.copy(a),L.polishRecord(L.records[b]))}}function z(a){if(a){var b=_.findIndex(L.records,_.pick(a,"id"));b>=0&&(L.records.splice(b,1),delete L.recordsHash[a.id])}}function A(){L.recordsHash={},L.records=[],L.paging.currentPage=1,L.queryRecords()}function B(){L.records.length<L.paging.totalRecords&&(L.paging.currentPage=L.paging.currentPage+1,L.queryRecords())}function C(){var a=_.chain(L.grid).map(function(a){return{key:a,title:L.schema.properties[a].title}}).value(),c=_.map(L.records,function(a){var b={};return _.each(L.grid,function(c){b[c]=L.fieldData(a,c)||""}),b});m.toCSV(L.model.title,c,a),b.$broadcast("report:csv-generated",L.model.name)}function D(){var a=_.chain(L.grid).map(function(a){return{key:a,title:L.schema.properties[a].title}}).value();a.unshift({key:"no",title:"No"});var c=_.map(L.records,function(a,b){var c={};return c.no=b+1,_.each(L.grid,function(b){c[b]=L.fieldData(a,b)||""}),c});m.toPDF(L.model.title,c,a),b.$broadcast("report:pdf-generated",L.model.name)}function E(){L.search.fields=_.map(L.schema.properties,function(a,b){return a.key=b,a.inputType="text","string"===a.type&&"date"===a.format?a.inputType="date":"number"===a.type&&a.items&&(a.inputType="select"),a}),L.search.dateRange={startDate:moment().startOf("month"),endDate:moment().endOf("month")}}function F(){var a=_.reduce(L.search.params,function(a,b,c){var d=_.findWhere(L.search.fields,{key:c});return d?("date"===d.inputType?a[c+".between"]=_.map(b,function(a){return a.startDate.toISOString()+"|"+a.endDate.toISOString()}).join("||"):"select"===d.inputType?a[c+".in"]=b.join():"text"===d.inputType&&(a[c+".like"]=b.join("|")),a):a},{});if(L.search.dateRange&&L.search.dateRange.startDate){var b=L.search.dateRange.startDate.toISOString(),c=L.search.dateRange.endDate.toISOString();a["created_at.between"]=b+"|"+c}return a}function G(){L.search.queries=_.reduce(L.search.params,function(a,b,c){var d=_.findWhere(L.search.fields,{key:c});if(!d)return a;var e=d.title+": ";if("select"===d.inputType){var f=_.map(b,function(a){var b=_.findWhere(d.items,{value:a})||{};return b.label});e+=_.uniq(f)}else if("date"===d.inputType){var f=_.map(b,function(a){var b=new Date(a.startDate).toISOString().slice(0,10),c=new Date(a.endDate).toISOString().slice(0,10);return b===c?b:"("+b+","+c+")"});e+=_.uniq(f)}else e+=_.uniq(b);return a[c]=e,a},{})}function H(){if(L.search.searchField&&L.search.searchValue){var a=L.search.searchField.key;L.search.params[a]||(L.search.params[a]=[]),L.search.params[a].push(L.search.searchValue),L.search.searchValue=null,L.buildSearchQueries()}}function I(){L.search.params={},L.search.queries={}}function J(a){delete L.search.params[a],L.buildSearchQueries()}function K(){b.$broadcast("model:do-search",L.modelName,L.getQueryParams())}var L=this;a.vmRef=L,window.indexCtrl=L,L.model={},L.modelName=null,L.recordsHash={},L.records=[],L.currentRecord={},L.searchQuery=null,L.action={loading:!1,searching:!1,deleting:!1},L.schema={},L.grid=[],L.paging={totalRecords:0,recordsPerPage:15,currentPage:1,previousId:0,currentId:0,nextId:0},L.initRoute=r,L.queryRecords=u,L.fieldData=v,L.polishRecord=w,L.updateRecords=x,L.updateRecordInRecords=y,L.removeRecordInRecords=z,L.reload=A,L.loadMore=B,L.toPDF=D,L.toCSV=C,L.search={fields:[],inputType:"",params:{},queries:{}},L.initSearch=E,L.getQueryParams=F,L.buildSearchQueries=G,L.addSearchParam=H,L.clearSearchParams=I,L.removeSearchParam=J,L.doSearch=K,a.$watch("vm.search.searchField",function(){L.search.searchField&&"date"===L.search.searchField.inputType&&(L.search.searchValue={startDate:moment().endOf("day"),endDate:moment().endOf("day")})}),a.$on("model:do-search",function(a,b,c){b===L.modelName&&(L.recordsHash={},L.records=[],L.paging.currentPage=1,L.queryRecords(1,1e3,c))}),a.$on("$stateChangeSuccess",function(a,b,c,d,e){t()}),b.$on("$stateChangeSuccess",function(a,b,c,d,e){t()}),a.$on("model:record-loaded",function(a,b,c){L.model.name==b&&(L.currentRecord=c,L.paging.currentId=c.id,L.updateRecordInRecords(c))}),a.$on("model:record-created",function(a,b,c){L.model.name===b&&(L.records.unshift(angular.copy(c)),L.recordsHash[c.id]=!0,L.polishRecord(L.records[0]))}),a.$on("model:record-updated",function(a,b,c){L.model.name===b&&L.updateRecordInRecords(c)}),a.$on("model:record-deleted",function(a,b,c){L.model.name===b&&L.removeRecordInRecords(c)}),a.$watch("vm.paging.recordsPerPage",function(){L.paging.currentPage=1,L.reload()}),L.showSearch=function(){L.action.searching=!0},L.hideSearch=function(){L.action.searching=!1,L.reload()},L["new"]=function(){c.go(".newPop")},L.hasCreateAccess=function(){return q.hasCreateAccess(L.model.name)},L.hasShowAccess=function(){return q.hasShowAccess(L.model.name)},L.hasUpdateAccess=function(){return q.hasUpdateAccess(L.model.name)},L.hasDeleteAccess=function(){return q.hasDeleteAccess(L.model.name)},L.setSearchQuery=function(a){L.searchQuery=a}}]),angular.module("angularApp").controller("FormCtrl",["$scope","$rootScope","APP","resourceManager","exMsg","$state","$stateParams","$http","$translate","fieldService","byValueFilter","authService","$uibModalStack",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){A.modelName=b||d.getName(a),A.model=d.register(A.modelName,c.apiPrefix+a+"/:id"),A.formly.fields=j.get(A.model.key),o();var e=g.id;e&&(A.recordId=e,A.loadRecord(e))}function o(){h.get(c.apiPrefix+"config/"+A.model.url).success(function(c){A.schema=c.schema,b.$broadcast("model:form-config-loaded",A.model.name,c,a),A.setRecord()}).error(function(a,b,c,d){e.error("error")})}function p(c){if(c){A.action.loading=!0;var e={id:c};d.get(A.model.name,e).then(function(c){A.record=c,A.formly.model=angular.copy(A.record),A.sanitizeRecord(),b.$broadcast("model:record-loaded",A.model.name,A.record,a),A.action.loading=!1,A.formly.options.formState.readOnly=!0})["catch"](function(a){A.error(a),A.action.loading=!1})}}function q(){_.each(A.record,function(a,b){null===a&&(A.record[b]="")})}function r(){!A.record.id&&g.q&&(_.each(A.splitQ(g.q),function(a,b){A.record[b]=a}),b.$broadcast("model:record-set",A.model.name,A.record,a))}function s(){A.record={},m.getTop()&&a.$dismiss(),f.go("^")}function t(){A.action.saving=!0,A.action.creating=!0;var c={};c[A.model.key]=A.formly.model,d.create(A.model.name,c).then(function(c){A.record=c,A.formly.model=angular.copy(A.record),b.$broadcast("model:record-created",A.model.name,c,a),e.success(A.schema.title+" created successfully"),A.close()})["catch"](function(a){A.error(a)})["finally"](function(){A.action.saving=!1,A.action.creating=!1})}function u(){A.formly.options.formState.readOnly=!1,A.action.editMode=!0}function v(){A.formly.model=angular.copy(A.record),A.formly.options.formState.readOnly=!0,A.action.editMode=!1}function w(){f.go("^.uploads",g)}function x(){if(A.record.id){A.action.saving=!0,A.action.updating=!0;var c={id:A.record.id};c[A.model.key]=A.formly.model,d.update(A.model.name,c).then(function(c){A.record=c,A.formly.model=angular.copy(A.record),b.$broadcast("model:record-updated",A.model.name,c,a),e.success(A.schema.title+" updated successfully"),A.close()})["catch"](function(a){A.error(a)})["finally"](function(){A.action.saving=!1,A.action.updating=!1})}}function y(){PNotify.removeAll(),A.formly.form.$setSubmitted(!0),A.formly.form.$valid&&(A.record.id?A.update():A.create())}function z(){A.action.deleting=!0;var c="Are you sure you want to delete this "+A.schema.title+"?";e.confirm(c,"Confirm Delete").then(function(){var c={id:A.record.id};c[A.model.key]=A.record,d["delete"](A.model.name,c).then(function(c){b.$broadcast("model:record-deleted",A.model.name,A.record,a),e.success(A.schema.title+" deleted successfully"),A.close()})["catch"](function(a){A.error(a)})["finally"](function(){A.action.deleting=!1})})["catch"](function(){A.action.deleting=!1})}var A=this;a.vmRef=A,window.formCtrl=A,A.model={},A.modelName=null,A.recordId=null,A.record={},A.action={editMode:!1,loading:!0,saving:!1,creating:!1,updating:!1,deleting:!1},A.schema={},A.formly={model:{},fields:[],options:{formState:{readOnly:!1}},form:{}},A.initRoute=n,A.loadRecord=p,A.sanitizeRecord=q,A.setRecord=r,A.close=s,A.create=t,A.edit=u,A.cancelEdit=v,A.uploads=w,A.update=x,A.save=y,A["delete"]=z,A.hasCreateAccess=function(){return l.hasCreateAccess(A.model.name)},A.hasShowAccess=function(){return l.hasShowAccess(A.model.name)},A.hasUpdateAccess=function(){return l.hasUpdateAccess(A.model.name)},A.hasDeleteAccess=function(){return l.hasDeleteAccess(A.model.name)},a.$on("$stateChangeSuccess",function(c,d,e,g,h){if(a.state.isShow){var i=[],j={};A.hasCreateAccess()&&(j={icon:"fa fa-plus",label:"New "+A.model.name,handler:A["new"]}),i.push({icon:"fa fa-chevron-left",label:"Back",handler:function(){f.go("^")}}),b.$broadcast("fab:load-actions",A.model.name,i,j)}}),a.$on("model:reload-record",function(a,b,c){b===A.model.name&&c.id===A.record.id&&A.loadRecord(A.record.id)})}]),angular.module("angularApp").controller("ReportCtrl",["$scope","APP","$http","$state","$stateParams","$sce",function(a,b,c,d,e,f){var g=a;window.reportCtrl=g,g.action={generating:!1},g.report={},g.filter={},g.reports={user_info:{name:"user_info",title:"User",fields:[{key:"user_id",type:"select",templateOptions:{label:"Select User",valueProp:"id",labelProp:"name",options:[]},controller:["$scope","$http",function(a,c){c.get(b.apiPrefix+"users?size=200").success(function(b){a.options.templateOptions.options=b})}]}]},users:{name:"users",title:"Users",fields:[]},roles:{name:"roles",title:"Roles",fields:[]}},g.generateReport=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name;c.get(a,{params:g.filter}).success(function(a){var b="data:application/pdf;base64,"+a;g.pdfSrc=f.trustAsResourceUrl(b)})["finally"](function(){g.action.generating=!1})},g.renderReportPage=function(){var a=e.report;g.report=g.reports[a],g.report&&g.report.fields&&(g.fields=g.report.fields)},g.previewReport=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".html";c.get(a,{params:g.filter}).success(function(a){g.report.html=f.trustAsHtml(a)})["finally"](function(){g.action.generating=!1})},g.downloadAsCSV=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".csv";c.get(a,{params:g.filter}).success(function(a){console.log(a);var b="data:text/csv;charset=utf-8,"+a,c=f.trustAsResourceUrl(b),d=angular.element("<a></a>");d.attr("href",c),d.attr("download",g.report.name+".csv"),d[0].click()})["finally"](function(){g.action.generating=!1})},g.downloadAsXLS=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".xls";c.get(a,{params:g.filter}).success(function(a){console.log(a);var b="data:application/xls;"+a,c=f.trustAsResourceUrl(b),d=angular.element("<a></a>");d.attr("href",c),d.attr("download",g.report.name+".xls"),d[0].click()})["finally"](function(){g.action.generating=!1})},g.downloadAsPDF=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".pdf";c.get(a,{params:g.filter}).success(function(a){var b="data:application/pdf;base64,"+a,c=f.trustAsResourceUrl(b),d=angular.element("<a></a>");d.attr("href",c),d.attr("download",g.report.name+".pdf"),d[0].click()})["finally"](function(){g.action.generating=!1})},g.renderReportPage()}]),angular.module("angularApp").controller("DashboardCtrl",["$scope","APP","$http",function(a,b,c){var d=a;window.dashboardCtrl=d,d.labels=["January","February","March","April","May","June","July"],d.series=["Series A","Series B"],d.data=[[65,59,80,81,56,55,40],[28,48,40,19,86,27,90]],d.labels2=["Download Sales","In-Store Sales","Mail-Order Sales","Tele Sales"],d.data2=[300,100,40,120],d.onClick=function(a,b){console.log(a,b)},d.monthlySummary=[],d.dailySummary=[],d.monthlyTotals={},d.dailyTotals={}}]),angular.module("angularApp").controller("UploadsCtrl",["$scope","$rootScope","APP","exMsg","$state","$stateParams","$http","$translate","resourceManager","FileUploader",function(a,b,c,d,e,f,g,h,i,j){var k=a;k.uploader=new j,window.uploadsCtrl=k,k.model={},k.modelName=null,k.recordId=null,k.record={},k.action={loading:!0,saving:!1,updating:!1},k.schema={},k.init=function(a,b){k.modelName=a,k.model=i.register(a,c.apiPrefix+a.replace(/-/gi,"_")+"/:id"),k.loadConfig(),k.recordId=b,k.loadRecord(b)},k.loadConfig=function(){g.get(c.apiPrefix+"config/"+k.model.url).success(function(a){k.schema=a.schema,b.$broadcast("model:uploads-config-loaded",k.model.name,a,k),k.setRecord()}).error(function(a,b,c,e){d.error("error")})},k.loadRecord=function(a){if(a){k.action.loading=!0;var c={id:a};i.get(k.model.name,c).then(function(a){k.record=a,k.sanitizeRecord(),b.$broadcast("model:record-loaded",k.model.name,k.record,k),k.action.loading=!1})["catch"](function(a){k.error(a),k.action.loading=!1})}},k.hasUpdateAccess=function(){return k.hasAccess(k.model.name+":update")},k.$on("model:reload-record",function(a,b,c){b===k.model.name&&c.id===k.record.id&&k.loadRecord(k.record.id)}),k.sanitizeRecord=function(){_.each(k.record,function(a,b){null===a&&(k.record[b]="")})},k.setRecord=function(){!k.record.id&&f.q&&(_.each(k.splitQ(f.q),function(a,b){k.record[b]=a}),b.$broadcast("model:record-set",k.model.name,k.record,k))},k.modelName||k.init(f.model,f.id)}]),angular.module("angularApp").controller("BulkCtrl",["$scope","$rootScope","APP","exMsg","$stateParams","$state","$http","$translate","resourceManager","XLSXReaderService",function(a,b,c,d,e,f,g,h,i,j){function k(a,b){o.routeName=a,o.masterRecordId=e.id,o.modelName=i.getName(b||e.table),o.model=i.register(o.modelName,c.apiPrefix+e.table.replace(/-/gi,"_")+"/:id"),l(),o.masterRecordId=masterRecordId}function l(){g.get(c.apiPrefix+"config/"+o.model.url).success(function(c){o.schema=c.schema,o.upload.matchFields=_.map(o.schema.properties,function(a,b){return{key:b,title:a.title}}),b.$broadcast("model:bulk-config-loaded",o.model.name,c,a)}).error(function(a,b,c,e){d.error("error")})}function m(){var a=_.map(o.upload.records,function(a){var b={};return _.each(o.upload.matchedFields,function(c,d){b[c]=a[d]}),b});g.post(c.apiPrefix+o.routeName+"/"+o.masterRecordId+"/bulk_upload",{table:o.model.url,data:a}).success(function(a){a.error?d.error(a.message,a.type):(o.upload.data={},o.upload.selectedSheet="",o.upload.records=[],d.success(a.length+" records created successfully"))}).error(function(a,b,c,e){d.error("error")})}function n(){f.go("^")}var o=this;a.vmRef=o,window.bulkCtrl=o,o.model={},o.routeName=null,o.masterRecordId=null,o.modelName=null,o.action={loading:!0,saving:!1,updating:!1},o.schema={},o.upload={},o.upload.matchedFields={},o.upload.matchFields=[],o.initRoute=k,o.bulkUpload=m,o.close=n,a.$watch("vm.upload.file",function(a){a&&(o.upload.selectedSheet="",j.readFile(o.upload.file,!0,!0).then(function(a){o.upload.data=a,o.upload.selectedSheet=_.keys(a.sheets)[0]}))}),a.$watch("vm.upload.selectedSheet",function(){var c=o.upload.data.sheets[o.upload.selectedSheet];return c?(o.upload.selectedHeaders=_.chain(c[0]).keys().pull("$$hashKey").value(),o.upload.records=c,void b.$broadcast("model:bulk-automatch-fields",o.model.name,{},a)):(o.upload.selectedHeaders=[],void(o.upload.records=[]))}),a.$on("model:bulk-automatch-fields",function(a,b,c,d){o.model.name===b&&(d.vmRef.upload.matchedFields={},_.each(d.vmRef.upload.selectedHeaders,function(a){var b=_.find(d.vmRef.upload.matchFields,function(b){return b.title.toUpperCase()===a.toUpperCase()});b&&(d.vmRef.upload.matchedFields[a]=b.key)}))})}]),angular.module("angularApp").run(["gridService","fieldService",function(a,b){function c(){return["name","permissions","status"]}function d(){return[{fieldGroup:[{className:"col-xs-6",key:"name",type:"ex-input",templateOptions:{required:!0,label:"Name"}},{className:"col-xs-6",key:"status",type:"ex-input",templateOptions:{required:!1,label:"Status"}}]},{fieldGroup:[{className:"col-xs-12 large-tags",key:"permissions",type:"ex-select-multiple",templateOptions:{required:!1,label:"Permissions",valueProp:"name",labelProp:"name",options:[]},controller:["$scope","lookupService",function(a,b){b.load("role","permission").then(function(){a.to.options=b.get("role","permission")})}]}]}]}a.set("role",c()),b.set("role",d())}]),angular.module("angularApp").controller("UserCtrl",["$scope","APP","$http","exMsg",function(a,b,c,d){var e=a;e.$on("model:index-config-loaded",function(a,b,c,d){}),e.$on("model:form-config-loaded",function(a,b,c,d){}),e.$on("model:record-loaded",function(a,e,f,g){"User"===e&&(g.vmRef.lockUser=function(){g.vmRef.action.locking=!0,c.post(b.apiPrefix+"users/"+f.id+"/lock").success(function(a){g.vmRef.record=a,d.success("User successfully locked")})["catch"](function(a){d.error(a.message)})["finally"](function(){g.vmRef.action.locking=!1})},g.vmRef.unlockUser=function(){g.vmRef.action.unlocking=!0,c.post(b.apiPrefix+"users/"+f.id+"/unlock").success(function(a){g.vmRef.record=a,d.success("User successfully unlocked")})["catch"](function(a){d.error(a.message)})["finally"](function(){g.vmRef.action.unlocking=!1})},g.vmRef.resetPassword=function(){})})}]),angular.module("angularApp").run(["gridService","fieldService",function(a,b){function c(){return["name","email","current_sign_in_at","current_sign_in_ip"]}function d(){return[{fieldGroup:[{className:"col-xs-6",key:"name",type:"ex-input",templateOptions:{required:!0,label:"Name"}},{className:"col-xs-6",key:"email",type:"ex-input",templateOptions:{required:!0,label:"Email"}}]},{fieldGroup:[{className:"col-xs-6",key:"password",type:"ex-input",templateOptions:{type:"password",required:!0,label:"Password"},hideExpression:"model.id"},{className:"col-xs-6",key:"password_confirmation",type:"ex-input",templateOptions:{type:"password",required:!0,label:"Password Confirmation"},hideExpression:"model.id"}]},{fieldGroup:[{className:"col-xs-6",key:"sign_in_count",type:"ex-input",templateOptions:{required:!0,label:"Sign In Count"},hideExpression:"!(model.id && formState.readOnly)"},{className:"col-xs-6",key:"failed_attempts",type:"ex-input",templateOptions:{required:!0,label:"Failed Attempts"},hideExpression:"!(model.id && formState.readOnly)"}]},{fieldGroup:[{className:"col-xs-6",key:"current_sign_in_at",type:"ex-datepicker",templateOptions:{required:!0,label:"Current Sign In At"},hideExpression:"!(model.id && formState.readOnly)"},{className:"col-xs-6",key:"last_sign_in_at",type:"ex-datepicker",templateOptions:{required:!0,label:"Last Sign In At"},hideExpression:"!(model.id && formState.readOnly)"}]},{fieldGroup:[{className:"col-xs-6",key:"current_sign_in_ip",type:"ex-datepicker",templateOptions:{required:!0,label:"Current Sign In IP"},hideExpression:"!(model.id && formState.readOnly)"},{className:"col-xs-6",key:"last_sign_in_ip",type:"ex-datepicker",templateOptions:{required:!0,label:"Last Sign In IP"},hideExpression:"!(model.id && formState.readOnly)"}]},{fieldGroup:[{className:"col-xs-12",key:"role_ids",type:"ex-select-multiple",templateOptions:{required:!1,label:"Roles",lookup:"role",placeholder:"Select roles ...",valueProp:"value",labelProp:"name",options:[]},controller:["$scope","lookupService",function(a,b){b.load("user","role").then(function(){a.to.options=b.get("user",a.to.lookup)})}]}]},{fieldGroup:[{className:"col-xs-6",key:"enforce_confirmation",type:"checkbox",templateOptions:{required:!1,label:"Enforce Confirmation"},hideExpression:"model.id"}]}]}a.set("user",c()),b.set("user",d())}]);