window&&!window.InflectionJS&&(window.InflectionJS=null),InflectionJS={uncountable_words:["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news","status","info"],plural_rules:[[new RegExp("(m)an$","gi"),"$1en"],[new RegExp("(pe)rson$","gi"),"$1ople"],[new RegExp("(child)$","gi"),"$1ren"],[new RegExp("^(ox)$","gi"),"$1en"],[new RegExp("(ax|test)is$","gi"),"$1es"],[new RegExp("(octop|vir)us$","gi"),"$1i"],[new RegExp("(alias|status)$","gi"),"$1es"],[new RegExp("(bu)s$","gi"),"$1ses"],[new RegExp("(buffal|tomat|potat)o$","gi"),"$1oes"],[new RegExp("([ti])um$","gi"),"$1a"],[new RegExp("sis$","gi"),"ses"],[new RegExp("(?:([^f])fe|([lr])f)$","gi"),"$1$2ves"],[new RegExp("(hive)$","gi"),"$1s"],[new RegExp("([^aeiouy]|qu)y$","gi"),"$1ies"],[new RegExp("(x|ch|ss|sh)$","gi"),"$1es"],[new RegExp("(matr|vert|ind)ix|ex$","gi"),"$1ices"],[new RegExp("([m|l])ouse$","gi"),"$1ice"],[new RegExp("(quiz)$","gi"),"$1zes"],[new RegExp("s$","gi"),"s"],[new RegExp("$","gi"),"s"]],singular_rules:[[new RegExp("(m)en$","gi"),"$1an"],[new RegExp("(pe)ople$","gi"),"$1rson"],[new RegExp("(child)ren$","gi"),"$1"],[new RegExp("([ti])a$","gi"),"$1um"],[new RegExp("((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$","gi"),"$1$2sis"],[new RegExp("(hive)s$","gi"),"$1"],[new RegExp("(tive)s$","gi"),"$1"],[new RegExp("(curve)s$","gi"),"$1"],[new RegExp("([lr])ves$","gi"),"$1f"],[new RegExp("([^fo])ves$","gi"),"$1fe"],[new RegExp("([^aeiouy]|qu)ies$","gi"),"$1y"],[new RegExp("(s)eries$","gi"),"$1eries"],[new RegExp("(m)ovies$","gi"),"$1ovie"],[new RegExp("(x|ch|ss|sh)es$","gi"),"$1"],[new RegExp("([m|l])ice$","gi"),"$1ouse"],[new RegExp("(bus)es$","gi"),"$1"],[new RegExp("(o)es$","gi"),"$1"],[new RegExp("(shoe)s$","gi"),"$1"],[new RegExp("(cris|ax|test)es$","gi"),"$1is"],[new RegExp("(octop|vir)i$","gi"),"$1us"],[new RegExp("(alias|status)es$","gi"),"$1"],[new RegExp("^(ox)en","gi"),"$1"],[new RegExp("(vert|ind)ices$","gi"),"$1ex"],[new RegExp("(matr)ices$","gi"),"$1ix"],[new RegExp("(quiz)zes$","gi"),"$1"],[new RegExp("s$","gi"),""]],non_titlecased_words:["and","or","nor","a","an","the","so","but","to","of","at","by","from","into","on","onto","off","out","in","over","with","for"],id_suffix:new RegExp("(_ids|_id)$","g"),underbar:new RegExp("_","g"),space_or_underbar:new RegExp("[ _]","g"),uppercase:new RegExp("([A-Z])","g"),underbar_prefix:new RegExp("^_"),apply_rules:function(a,b,c,d){if(d)a=d;else{var e=c.indexOf(a.toLowerCase())>-1;if(!e)for(var f=0;f<b.length;f++)if(a.match(b[f][0])){a=a.replace(b[f][0],b[f][1]);break}}return a}},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b,c){b||(b=-1);for(var d=-1,e=b;e<this.length;e++)if(this[e]===a||c&&c(this[e],a)){d=e;break}return d}),String.prototype._uncountable_words||(String.prototype._uncountable_words=InflectionJS.uncountable_words),String.prototype._plural_rules||(String.prototype._plural_rules=InflectionJS.plural_rules),String.prototype._singular_rules||(String.prototype._singular_rules=InflectionJS.singular_rules),String.prototype._non_titlecased_words||(String.prototype._non_titlecased_words=InflectionJS.non_titlecased_words),String.prototype.pluralize||(String.prototype.pluralize=function(a){return InflectionJS.apply_rules(this.toString(),this._plural_rules,this._uncountable_words,a)}),String.prototype.singularize||(String.prototype.singularize=function(a){return InflectionJS.apply_rules(this.toString(),this._singular_rules,this._uncountable_words,a)}),String.prototype.camelize||(String.prototype.camelize=function(a){for(var b=this.toLowerCase(),c=b.split("/"),d=0;d<c.length;d++){for(var e=c[d].split("_"),f=a&&d+1===c.length?1:0,g=f;g<e.length;g++)e[g]=e[g].charAt(0).toUpperCase()+e[g].substring(1);c[d]=e.join("")}return b=c.join("::")}),String.prototype.underscore||(String.prototype.underscore=function(){for(var a=this,b=a.split("::"),c=0;c<b.length;c++)b[c]=b[c].replace(InflectionJS.uppercase,"_$1"),b[c]=b[c].replace(InflectionJS.underbar_prefix,"");return a=b.join("/").toLowerCase()}),String.prototype.humanize||(String.prototype.humanize=function(a){var b=this.toLowerCase();return b=b.replace(InflectionJS.id_suffix,""),b=b.replace(InflectionJS.underbar," "),a||(b=b.capitalize()),b}),String.prototype.capitalize||(String.prototype.capitalize=function(){var a=this.toLowerCase();return a=a.substring(0,1).toUpperCase()+a.substring(1)}),String.prototype.dasherize||(String.prototype.dasherize=function(){var a=this;return a=a.replace(InflectionJS.space_or_underbar,"-")}),String.prototype.titleize||(String.prototype.titleize=function(){var a=this.toLowerCase();a=a.replace(InflectionJS.underbar," ");for(var b=a.split(" "),c=0;c<b.length;c++){for(var d=b[c].split("-"),e=0;e<d.length;e++)this._non_titlecased_words.indexOf(d[e].toLowerCase())<0&&(d[e]=d[e].capitalize());b[c]=d.join("-")}return a=b.join(" "),a=a.substring(0,1).toUpperCase()+a.substring(1)}),String.prototype.demodulize||(String.prototype.demodulize=function(){var a=this,b=a.split("::");return a=b[b.length-1]}),String.prototype.tableize||(String.prototype.tableize=function(){var a=this;return a=a.underscore().pluralize()}),String.prototype.classify||(String.prototype.classify=function(){var a=this;return a=a.camelize().singularize()}),String.prototype.foreign_key||(String.prototype.foreign_key=function(a){var b=this;return b=b.demodulize().underscore()+(a?"":"_")+"id"}),String.prototype.ordinalize||(String.prototype.ordinalize=function(){for(var a=this,b=a.split(" "),c=0;c<b.length;c++){var d=parseInt(b[c]);if(NaN===d){var e=b[c].substring(b[c].length-2),f=b[c].substring(b[c].length-1),g="th";"11"!=e&&"12"!=e&&"13"!=e&&("1"===f?g="st":"2"===f?g="nd":"3"===f&&(g="rd")),b[c]+=g}}return a=b.join(" ")});var app=angular.module("angularApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ui.router","ngSanitize","ngTouch","ng-token-auth","angular-underscore","ngDialog","ui.select","xeditable","daterangepicker","angular-loading-bar","pascalprecht.translate","schemaForm","formly","formlyBootstrap"]);app.constant("APP",{root:"/",apiPrefix:"/api/",modules:{main:{text:"Main Menu",url:"app",icon:"fa fa-home fa-lg",links:[{text:"Samples",url:"samples",icon:"glyphicon glyphicon-user"}]},reports:{text:"Reports",url:"reports",icon:"glyphicon glyphicon-stats",links:[{text:"Samples",url:"samples",icon:"fa fa-clipboard"},{text:"Sample",url:"sample-info",icon:"fa fa-clipboard"}]},setups:{text:"Setups",url:"setups",icon:"fa fa-cogs fa-lg",links:[{text:"Users",url:"users",icon:"fa fa-user"},{text:"New User",url:"form/users",icon:"fa fa-user"},{text:"Roles",url:"roles",icon:"fa fa-user"},{text:"Sample Status",url:"sample-statuses",icon:"fa fa-tags"}]}}}),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),b.when("/","/dashboard"),b.when("/main","/main/samples"),b.when("/reports","/reports/samples"),b.when("/setups","/setups/sample-statuses"),a.state("app",{url:"/",templateUrl:"views/layouts/app.html",controller:"AppCtrl",resolve:{auth:["$auth","$state","$rootScope",function(a,b,c){return a.validateUser()["catch"](function(){b.go("login")})}]}}).state("login",{url:"/login",templateUrl:"views/layouts/login.html",controller:"LoginCtrl"}).state("app.dashboard",{url:"dashboard",templateUrl:function(a){return"views/layouts/dashboard.html"},controller:"ModuleCtrl"}).state("app.reports",{url:"reports",templateUrl:function(a){return"views/layouts/reports_module.html"}}).state("app.reports.report",{url:"/:report",templateUrl:function(a){return"views/app/reports/show.html"},controller:"ReportCtrl"}).state("app.module",{url:":module",templateUrl:function(a){return"views/layouts/"+a.module+"_module.html"},controller:"ModuleCtrl"}).state("app.module.form",{url:"/form",templateUrl:function(a){return"views/layouts/form.html"}}).state("app.module.form.model",{url:"/:model",templateUrl:function(a){return"views/app/"+a.model+"/new.html"},controller:"FormCtrl"}).state("app.module.model",{url:"/:model",templateUrl:function(a){return"views/app/"+a.model+"/index.html"},controller:"IndexCtrl"}).state("app.module.model.index",{url:"/index",templateUrl:function(a){return"views/app/"+a.model+"/index.html"},controller:"IndexCtrl"}).state("app.module.model.new",{url:"/new",templateUrl:function(a){return"views/app/"+a.model+"/new.html"},controller:"FormCtrl"}).state("app.module.model.view",{url:"/:view",templateUrl:function(a){return"views/app/"+a.model+"/"+a.view+"/.html"},controller:"FormCtrl"}).state("app.module.model.show",{url:"/:id/show",templateUrl:function(a){return"views/app/"+a.model+"/show.html"},controller:"FormCtrl"}).state("app.module.model.edit",{url:"/:id/edit",templateUrl:function(a){return"views/app/"+a.model+"/edit.html"},controller:"FormCtrl"})}]).config(["$authProvider",function(a){a.configure({apiUrl:"/api",confirmationSuccessUrl:window.location.href.split("#")[0]})}]).factory("$exceptionHandler",function(){return function(a,b){}}).run(["editableOptions",function(a){a.theme="bs3"}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]).run(["formlyConfig","formlyValidationMessages",function(a,b){a.setType({name:"ui-select","extends":"select",templateUrl:"views/templates/ui-select.html"}),a.setType({name:"ui-select-multiple","extends":"ui-select",templateUrl:"views/templates/ui-select-multiple.html"}),a.setType({name:"datepicker","extends":"input",templateUrl:"views/templates/datepicker.html"})}]).config(["formlyConfigProvider",function(a){}]),angular.module("angularApp").filter("byId",function(){return function(a,b){for(var c=0,d=a.length;d>c;c++)if(+a[c].id==+b)return a[c];return{}}}),angular.module("angularApp").filter("byValue",function(){return function(a,b){for(var c=0,d=a.length;d>c;c++)if(+a[c].value==+b)return a[c];return{}}}),angular.module("angularApp").filter("previousNextIds",function(){return function(a,b){for(var c={previousId:0,nextId:0},d=0,e=a.length;e>d;d++)if(+a[d].id==+b)return d>0&&(c.previousId=a[d-1].id),e-1>d&&(c.nextId=a[d+1].id),c;return c}}),angular.module("angularApp").service("exMsg",["$q",function(a){return{notify:function(a){new PNotify(a)},success:function(a,b){new PNotify({title:b||"Success",text:a,type:"success",nonblock:!0})},error:function(a,b){new PNotify({title:b||"Error",text:a,type:"error",nonblock:!0,nonblock_opacity:.2})},notice:function(a,b){new PNotify({text:a,type:"notice",nonblock:!0,nonblock_opacity:.5})},info:function(a,b){new PNotify({title:b||"Info",text:a,addclass:"custom",opacity:.8,nonblock:!0,nonblock_opacity:.2})},errorSummary:function(a){var b="<ul>";angular.forEach(a,function(a){b+="<li>"+a+"</li>"}),b+="</ul>",new PNotify({title:"Error Summary",text:b,type:"error",hide:!1})},confirm:function(b,c){var d=a.defer();return sweetAlert({title:c||"Confirm",text:b,type:"warning",showCancelButton:!0,animation:"slide-from-top"},function(a){return a?(d.resolve(!0),!0):(d.reject(!1),!1)}),d.promise},clear:function(){PNotify.removeAll()},sweetAlert:sweetAlert,prompt:function(b,c){var d=a.defer();return sweetAlert({title:c||"Input Needed",text:b,type:"input",showCancelButton:!0,animation:"slide-from-top"},function(a){return a===!1?(d.reject(!1),!1):(d.resolve(a),!0)}),d.promise}}}]),angular.module("angularApp").service("resourceManager",["$q","$http","$resource",function(a,b,c){var d={models:{}};return d.getName=function(a){return a=a.replace(/-/gi,"_"),a=a.underscore().split("_"),a=a.slice(0,a.length-1).join("_").camelize()+a[a.length-1].classify()},d.getUrl=function(a){return a=a.underscore().split("_"),a=a.slice(0,a.length-1).join("_").camelize()+a[a.length-1].pluralize().camelize(),a.underscore()},d.getModel=function(a,b){return b=b||{},b.name=a=this.getName(a),b.url||(b.url=this.getUrl(a)),b.key||(b.key=a.underscore()),b.title||(b.title=b.url.titleize()),b},d.register=function(a,b,d,e){if(a=this.getName(a),d=d||{id:"@id"},e=e||{},!this.models[a]){var f=c(b,d,{query:{method:"GET",isArray:!0},update:{method:"PUT"}});app.factory(a,function(){return f}),this.models[a]=this.getModel(a,e),this.models[a].apiUrl=b,this.models[a].klass=f}return this.models[a]},d.query=function(b,c,d){var e=a.defer();return b=this.getName(b),this.models[b].klass.query(c,function(a,b){a.error||a.errors?e.reject(a):e.resolve(a),d&&d(a,b("_meta_total"))},function(a){e.reject(a)}).$promise["catch"](function(a){window.error=a,e.reject({message:"Sorry, you do not have permission."})}),e.promise},d.get=function(b,c,d){var e=a.defer();return b=this.getName(b),this.models[b].klass.get(c,function(a,b){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d.create=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$save(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d.update=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$update(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d["delete"]=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$delete(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d}]),angular.module("angularApp").controller("LoginCtrl",["$scope","$auth","$http","$state","exMsg","APP",function(a,b,c,d,e,f){var g=a;window.loginCtrl=g,g.$on("auth:registration-email-success",function(a,b){var c="A registration email was sent to "+b.email+". Follow the instructions contained in the email to complete registration.";e.sweetAlert({title:"Registration",text:c,type:"success"})}),g.$on("auth:registration-email-error",function(a,b){}),g.$on("auth:login-success",function(a,b){d.go("app")}),g.$on("auth:login-error",function(a,b){e.sweetAlert("Failed",b.errors[0],"error")}),g.sendPasswordResetEmail=function(){e.sweetAlert({title:"Password Reset",text:"Email",type:"input",showCancelButton:!0,animation:"slide-from-top"},function(a){return a===!1?!1:""===a?(e.sweetAlert.showInputError("No email provided!"),!1):void b.requestPasswordReset({email:a}).then(function(a){e.sweetAlert("Successful",a.message,"success")})["catch"](function(a){e.sweetAlert("Error",a.errors[0],"error")})})},g.sendConfirmationInstructions=function(){e.sweetAlert({title:"Confirmation Instructions",text:"Email",type:"input",showCancelButton:!0,animation:"slide-from-top"},function(a){return a===!1?!1:""===a?(e.sweetAlert.showInputError("No email provided!"),!1):void c.post(f.apiPrefix+"users/send_confirmation_instructions",{email:a,redirect_url:window.location.href.split("#")[0]}).success(function(a){a.error?e.sweetAlert("Error",a.message,"error"):e.sweetAlert("Successful",a.message,"success")})})}}]),angular.module("angularApp").controller("AppCtrl",["$scope","$http","$auth","$q","$state","APP","exMsg","$stateParams",function(a,b,c,d,e,f,g,h){var i=a;window.appCtrl=i,i.modules=f.modules||{},i.state={isIndex:!0,isNew:!1,isShow:!1,isEdit:!1,update:function(a){a&&(this.isIndex="app.module.model"==a.name,this.isNew="app.module.model.new"==a.name,this.isShow="app.module.model.show"==a.name,this.isEdit="app.module.model.edit"==a.name)}},i.hasAccess=function(a){if(c.user["admin?"]===!0)return!0;var b=a||"";if(b=b.replace(/-/gi,"_"),b.indexOf(":")<0)if(b=b.split("?")[0],b.indexOf("/")<0)b=b.classify()+":index";else{var d=/^([A-z-_]+)\/new/gi,e=/^([A-z-_]+)\/(\d+)\/show/gi,f=/^([A-z-_]+)\/(\d+)\/edit/gi,g=d.exec(b),h=e.exec(b),i=f.exec(b);g?b=g[1].classify()+":create":h?b=h[1].classify()+":show":i&&(b=i[1].classify()+":update")}var j=_.find(c.user.permissions,function(a){return a===b});return void 0===j?!1:!0},i.error=function(a){a=a||{},a.message&&g.error(a.message,a.type||"Error"),a.messages&&g.errorSummary(a.messages)},i.back=function(){e.go("^")},i.state.update(i.state.update(e.current)),i.$on("$stateChangeSuccess",function(a,b,c,d,e){i.state.update(b)}),i.hasUrl=function(a){return window.location.hash.indexOf(a)>=0},i.buildQ=function(a){return _.map(a,function(a,b){return b+".eq."+a}).join(":")},i.splitQ=function(a){var b={};return a.split(":").forEach(function(a){var c=a.split(".eq.");c[1]&&(b[c[0]]=c[1])}),b},i.$on("auth:logout-success",function(a){e.go("login")}),i.$on("auth:logout-error",function(a){g.error("Unable to complete logout. Please try again.")}),i.showPasswordChange=function(){g.sweetAlert({title:"Change Password",text:"Current Password:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Current Password"},function(a){return a===!1?!1:""===a?(g.sweetAlert.showInputError("No password provided!"),!1):void g.sweetAlert({title:"Change Password",text:"New Password:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password"},function(d){return d===!1?!1:""===d?(g.sweetAlert.showInputError("No password provided!"),!1):void g.sweetAlert({title:"Change Password",text:"New Password Again:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password Again"},function(e){return e===!1?!1:""===e?(g.sweetAlert.showInputError("No password provided!"),!1):void b.post(f.apiPrefix+"users/"+c.user.id+"/change_password",{current_password:a,password:d,password_confirmation:e}).success(function(a){a.error?g.sweetAlert(a.message,(a.messages||[]).join("\n"),"error"):g.sweetAlert("Great!","Password changed successfully","success")})["catch"](function(a){g.sweetAlert("Nice!","You wrote: "+inputValue,"error")})})})})}}]),angular.module("angularApp").controller("ModuleCtrl",["$scope","APP",function(a,b){var c=a;window.moduleCtrl=c,c.drpOptions={showDropdowns:!0,ranges:{Today:[new Date,new Date],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),new Date],"Last 30 Days":[moment().subtract(29,"days"),new Date],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left"}}]),angular.module("angularApp").controller("IndexCtrl",["$scope","$rootScope","$state","$stateParams","$q","$http","APP","resourceManager","$filter","exMsg","byValueFilter","reportService","lookupService","byIdFilter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=a;window.indexCtrl=o,o.model=h.register(d.model,g.apiPrefix+d.model.replace(/-/gi,"_")+"/:id"),o.grid={},o.recordsHash={},o.records=[],o.currentRecord={},o.searchQuery=null,o.action={loading:!1,deleting:!1},o.paging={totalRecords:0,recordsPerPage:15,currentPage:1,previousId:0,currentId:0,nextId:0},o.queryRecords=function(a,c,d){o.action.loading=!0,d||(d=o.searchQuery||{}),d.page=a||o.paging.currentPage,d.size=c||o.paging.recordsPerPage,h.query(o.model.name,d,function(a,b){o.paging.totalRecords=b}).then(function(a){o.updateRecords(a),b.$broadcast("model:records-loaded",o.model.name,o.records,o)})["catch"](function(a){console.log(a),o.error(a)})["finally"](function(a){o.action.loading=!1})},o.hasCreateAccess=function(){return o.hasAccess(o.model.name+":create")},o.hasShowAccess=function(){return o.hasAccess(o.model.name+":show")},o.hasUpdateAccess=function(){return o.hasAccess(o.model.name+":update")},o.hasDeleteAccess=function(){return o.hasAccess(o.model.name+":delete")},o.$on("model:records-loaded",function(a,b,c){o.model.name==b&&o.updatePreviousNext()}),o.$on("model:record-loaded",function(a,b,c){o.model.name==b&&(o.currentRecord=c,o.paging.currentId=c.id,o.updatePreviousNext())}),o.updatePreviousNext=function(){if(0!=o.records.length&&0!=o.paging.currentId){var a=i("previousNextIds")(o.records,o.paging.currentId);a&&(o.paging.previousId=a.previousId,o.paging.nextId=a.nextId)}},o.fieldData=function(b,c){var d=a.schema.properties[c],e=d&&d.lookup||!1,f=b[c];return e?k(o.lookups[e],f).name:f},o.polishRecord=function(a){a&&a.id&&m.load(o.model.key).then(function(b){var c=b.data;angular.forEach(o.schema.properties,function(b,d){b.lookup&&c[b.lookup]&&(a[b.lookup]=k(c[b.lookup],a[d]))})})},o.updateRecords=function(a){angular.forEach(a,function(a){o.recordsHash[a.id]||(o.records.push(a),o.recordsHash[a.id]=!0,o.polishRecord(a))})},o.updateRecordInRecords=function(a){if(a){var b=_.findIndex(o.records,_.pick(a,"id"));b>=0&&(o.records[b]=angular.copy(a),o.polishRecord(o.records[b]))}},o.removeRecordInRecords=function(a){if(a){var b=_.findIndex(o.records,_.pick(a,"id"));b>=0&&(o.records.splice(b,1),delete o.recordsHash[a.id])}},o.$on("model:record-loaded",function(a,b,c){o.model.name===b&&o.updateRecordInRecords(c)}),o.$on("model:record-created",function(a,b,c){o.model.name===b&&(o.records.unshift(angular.copy(c)),o.recordsHash[c.id]=!0,o.polishRecord(o.records[0]))}),o.$on("model:record-updated",function(a,b,c){o.model.name===b&&o.updateRecordInRecords(c)}),o.$on("model:record-deleted",function(a,b,c){o.model.name===b&&o.removeRecordInRecords(c)}),o.reload=function(){o.recordsHash={},o.records=[],o.paging.currentPage=1,o.queryRecords()},o.loadMore=function(){o.records.length<o.paging.totalRecords&&(o.paging.currentPage=o.paging.currentPage+1,o.queryRecords())},o.setSearchQuery=function(a){o.searchQuery=a},o.$watch("paging.recordsPerPage",function(){o.queryRecords()}),o["delete"]=function(a){o.action.deleting=!0;var c="Are you sure you want to delete this "+o.schema.title+"?";j.confirm(c,"Confirm Delete").then(function(){var c={id:a};c[o.model.key]=o.record,h["delete"](o.model.name,c).then(function(a){b.$broadcast("model:record-deleted",o.model.name,a),j.success(o.schema.title+" deleted successfully")})["catch"](function(a){o.error(a)})["finally"](function(){o.action.deleting=!1})})["catch"](function(){o.action.deleting=!1})},o.toCSV=function(){var a=_.chain(o.grid).map(function(a){return{key:a,title:o.schema.properties[a].title}}).value(),c=_.map(o.records,function(a){var b={};return _.each(o.grid,function(c){b[c]=o.fieldData(a,c)||""}),b});l.toCSV(o.model.title,c,a),b.$broadcast("report:csv-generated",o.model.name)},o.toPDF=function(){var a=_.chain(o.grid).map(function(a){return{key:a,title:o.schema.properties[a].title}}).value(),c=_.map(o.records,function(a){var b={};return _.each(o.grid,function(c){b[c]=o.fieldData(a,c)||""}),b});l.toPDF(o.model.title,c,a),b.$broadcast("report:pdf-generated",o.model.name)},o.loadConfig=function(){f.get(g.apiPrefix+"config/"+o.model.url).success(function(a){o.lookups=a.lookups,o.schema=a.schema,o.grid=a.grid,b.$broadcast("model:index-config-loaded",o.model.name,a,o)}).error(function(a,b,c,d){j.error("error")})},o.loadConfig()}]),angular.module("angularApp").controller("FormCtrl",["$scope","$rootScope","APP","resourceManager","exMsg","$state","$stateParams","$http","$translate","fieldService","formService",function(a,b,c,d,e,f,g,h,i,j,k){var l=a;window.formCtrl=l,l.model=d.register(g.model,c.apiPrefix+g.model.replace(/-/gi,"_")+"/:id"),l.record={},l.action={loading:!0,saving:!1,creating:!1,updating:!1,deleting:!1},l.schema={},l.formlyFields=j.get(l.model.key),l.formlyOptions={},l.formlyForm={},l.loadConfig=function(){h.get(c.apiPrefix+"config/"+l.model.url).success(function(a){l.schema=a.schema,l.setDisableFields(),l.form=k.get(l.model.key),b.$broadcast("model:form-config-loaded",l.model.name,a,l),l.setRecord()}).error(function(a,b,c,d){e.error("error")})},l.hasCreateAccess=function(){return l.hasAccess(l.model.name+":create")},l.hasShowAccess=function(){return l.hasAccess(l.model.name+":show")},l.hasUpdateAccess=function(){return l.hasAccess(l.model.name+":update")},l.hasDeleteAccess=function(){return l.hasAccess(l.model.name+":delete")},l.setDisableFields=function(){"app.module.model.show"===f.$current.name?angular.forEach(l.schema.properties,function(a){a.readonly=!0}):angular.forEach(l.schema.properties,function(a){a.readonly=!1}),l.$broadcast("schemaFormRedraw")},l.loadRecord=function(){if(l.action.loading=!0,g.id){var a={id:g.id};d.get(l.model.name,a).then(function(a){l.record=a,l.sanitizeRecord(),b.$broadcast("model:record-loaded",l.model.name,l.record,l),l.action.loading=!1,l.$broadcast("schemaFormRedraw")})["catch"](function(a){l.error(a),l.action.loading=!1})}else b.$broadcast("model:record-new",l.model.name,l.record,l)},l.$on("model:reload-record",function(a,b,c){b===l.model.name&&c.id===l.record.id&&l.loadRecord()}),l.sanitizeRecord=function(){_.each(l.record,function(a,b){null===a&&(l.record[b]="")})},l.setRecord=function(){!l.record.id&&g.q&&(_.each(l.splitQ(g.q),function(a,b){l.record[b]=a}),b.$broadcast("model:record-set",l.model.name,l.record,l))},l.close=function(){l.record={},f.go("^")},l.redirectBack=function(){l.record={},"app.module.form.model"===f.$current.name?f.go(".",g,{reload:!0}):f.go("^")},l.create=function(){l.action.saving=!0,l.action.creating=!0;var a={};a[l.model.key]=l.record,d.create(l.model.name,a).then(function(a){b.$broadcast("model:record-created",l.model.name,l.record,l),e.success(l.schema.title+" created successfully"),l.record.id=a.id,l.redirectBack()})["catch"](function(a){l.error(a)})["finally"](function(){l.action.saving=!1,l.action.creating=!1})},l.edit=function(){f.go("^.edit",{id:g.id})},l.update=function(){l.action.saving=!0,l.action.updating=!0;var a={id:g.id};a[l.model.key]=l.record,d.update(l.model.name,a).then(function(a){b.$broadcast("model:record-updated",l.model.name,l.record,l),e.success(l.schema.title+" updated successfully"),l.redirectBack()})["catch"](function(a){l.error(a)})["finally"](function(){l.action.saving=!1,l.action.updating=!1})},l.save=function(){PNotify.removeAll(),l.$broadcast("schemaFormValidate"),(!l.formObject||l.formObject.$valid)&&(g.id?l.update():l.create())},l["delete"]=function(){l.action.deleting=!0;var a="Are you sure you want to delete this "+l.schema.title+"?";e.confirm(a,"Confirm Delete").then(function(){var a={id:l.record.id};a[l.model.key]=l.record,d["delete"](l.model.name,a).then(function(a){b.$broadcast("model:record-deleted",l.model.name,l.record,l),e.success(l.schema.title+" deleted successfully"),l.redirectBack()})["catch"](function(a){l.error(a)})["finally"](function(){l.action.deleting=!1})})["catch"](function(){l.action.deleting=!1})},l.loadConfig(),l.loadRecord()}]),angular.module("angularApp").controller("ReportCtrl",["$scope","APP","$http","$state","$stateParams","$sce",function(a,b,c,d,e,f){var g=a;window.reportCtrl=g,g.action={generating:!1},g.report={},g.filter={},g.reports={samples:{name:"samples",title:"Samples",fields:[]},"sample-info":{name:"sample",title:"Sample",fields:[{key:"sample_id",type:"select",templateOptions:{label:"Select Sample",valueProp:"id",labelProp:"name",options:[]},controller:function(a,c){c.get(b.apiPrefix+"samples").success(function(b){a.to.options=b})}}]}},g.generateReport=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name;c.get(a,{params:g.filter}).success(function(a){var b="data:application/pdf;base64,"+a;g.pdfSrc=f.trustAsResourceUrl(b)})["finally"](function(){g.action.generating=!1})},g.renderReportPage=function(){var a=e.report;g.report=g.reports[a],g.report&&g.report.fields&&(g.fields=g.report.fields)},g.renderReportPage()}]),angular.module("angularApp").controller("UserCtrl",["$scope","$rootScope","APP","exMsg","$http","$state","$stateParams",function(a,b,c,d,e,f,g){function h(a){var b=["sign_in_count","current_sign_in_at","last_sign_in_at","current_sign_in_ip","last_sign_in_ip","failed_attempts","name","image","email","role_ids","status"];angular.forEach(a.schema.properties,function(c,d){b.indexOf(d)<0&&delete a.schema.properties[d]}),a.form=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"name",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"email",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"sign_in_count",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"failed_attempts",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"current_sign_in_at",fieldHtmlClass:"input-lg",pickadate:{selectYears:!0,selectMonths:!0}}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"last_sign_in_at",fieldHtmlClass:"input-lg",pickadate:{selectYears:!0,selectMonths:!0}}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"current_sign_in_ip",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"last_sign_in_ip",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row large-tags-",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"role_ids",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"status",fieldHtmlClass:"input-lg"}]}]}]}function i(a){a.schema.properties.password={title:"Password",type:"string"},a.schema.properties.password_confirmation={title:"Confirm Password",type:"string"},a.schema.properties.enforce_confirmation={title:"Enforce Email Confirmation",type:"boolean","default":!1},a.form=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"name",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"email",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"password",type:"password",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"password_confirmation",type:"password",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row large-tags",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"role_ids",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"enforce_confirmation",fieldHtmlClass:"input-lg"}]}]},{type:"conditional",condition:"record.enforce_confirmation",items:[{type:"help",helpvalue:'<div class="alert alert-info">A confirmation email will be sent to the User to confirm this account</div>'}]}]}function j(a){a.form=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"name",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"email",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row large-tags-",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"role_ids",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"status",fieldHtmlClass:"input-lg"}]}]}]}var k=a;window.userCtrl=k,k.stateParams=g,k.state=f,k.$on("model:index-config-loaded",function(a,b,c,d){"User"===b&&(d.grid=["name","email","current_sign_in_at","current_sign_in_ip"])}),k.$on("model:form-config-loaded",function(a,c,d,e){"User"===c&&(e.schema.required=["name","email"],e.schema.properties.status={title:"Status",type:"string",readonly:!0},"app.module.model.show"===f.$current.name?(h(e),b.$broadcast("ui:form-updated",c,{},e)):"app.module.model.edit"===f.$current.name?(j(e),b.$broadcast("ui:form-updated",c,{},e)):(i(e),b.$broadcast("ui:form-updated",c,{},e)))}),k.$on("model:record-loaded",function(a,b,f,g){"User"===b&&(g.lockUser=function(){g.action.locking=!0,e.post(c.apiPrefix+"users/"+f.id+"/lock").success(function(a){g.record=a,d.success("User successfully locked")})["catch"](function(a){d.error(a.message)})["finally"](function(){g.action.locking=!1})},g.unlockUser=function(){g.action.unlocking=!0,e.post(c.apiPrefix+"users/"+f.id+"/unlock").success(function(a){g.record=a,d.success("User successfully unlocked")})["catch"](function(a){d.error(a.message)})["finally"](function(){g.action.unlocking=!1})},g.resetPassword=function(){})})}]),angular.module("angularApp").controller("UiCtrl",["$scope","APP","$http","$state","$stateParams",function(a,b,c,d,e){var f=a;window.uiCtrl=f,f.$on("model:index-config-loaded",function(a,b,c,d){}),
f.$on("ui:form-updated",function(a,b){"User"===b&&f.user["admin?"]})}]),angular.module("angularApp").service("reportService",["$document",function(a){return{toCSV:function(b,c,d,e){var f=this.objectify(c);d=d||this.getColumns(f),b=b||"Report",e=e||!0;var g="Report_"+(new Date).toISOString().replace(/\:/g,"-").replace(".","-")+".csv",h="";if(h+=b+"\r\n\n",e){var i=_.chain(d).map(function(a){return a.title}).value().join(",");h+=i+"\r\n"}h+=_.chain(f).map(function(a){return _.chain(d).map(function(b){return a[b.key]}).value().join(",")}).value().join("\r\n");var j="data:text/csv;charset=utf-8,"+escape(h),k=a[0].createElement("a");k.href=j,k.style.visibility="hidden",k.download=g,a[0].body.appendChild(k),k.click(),a[0].body.removeChild(k)},toPDF:function(a,b,c){var d=this.objectify(b);c=c||this.getColumns(d),a=a||"Report";var e="Report_"+(new Date).toISOString().replace(/\:/g,"-").replace(".","-")+".pdf",f=new jsPDF("l","pt"),g=function(b,c,d){b.setFontSize(20),b.text(a,d.margins.horizontal,60),b.setFontSize(d.fontSize)};f.autoTable(c,d,{renderHeader:g,margins:{horizontal:40,top:80,bottom:50}}),f.save(e)},objectify:function(a){return"object"!=typeof a?JSON.parse(a):a},getColumns:function(a){var b=["string","number"],c=a[0];return _.chain(c).keys().reject(function(a){return 0==a.indexOf("$")}).filter(function(a){return b.indexOf(typeof c[a])>=0}).map(function(a){return{title:a,key:a}}).value()}}}]),angular.module("angularApp").service("fieldService",function(){var a={},b={get:function(b){return a[b]||[]}};return a.role=[{fieldGroup:[{className:"col-xs-6",key:"name",type:"input",templateOptions:{required:!0,label:"Name"}},{className:"col-xs-6",key:"status",type:"input",templateOptions:{required:!1,label:"Status"}}]},{fieldGroup:[{className:"col-xs-12",key:"permissions",type:"ui-select-multiple",templateOptions:{required:!1,label:"Permissions",valueProp:"name",labelProp:"name",options:[]},controller:["$scope","lookupService",function(a,b){b.load("role","permission").then(function(){a.to.options=b.get("role","permission")})}]}]}],a.sample=[{fieldGroup:[{className:"col-xs-6",key:"name",type:"input",templateOptions:{required:!1,label:"Name"}},{className:"col-xs-6",key:"description",type:"input",templateOptions:{required:!1,label:"Description"}}]},{fieldGroup:[{className:"col-xs-6",key:"sample_date",type:"datepicker",templateOptions:{required:!1,label:"Sample Date"}},{className:"col-xs-6",key:"sample_status_id",type:"ui-select",templateOptions:{required:!1,label:"Sample Status",lookup:"sample_status",valueProp:"value",labelProp:"name",options:[]},controller:function(a,b){b.load("sample").then(function(){a.to.options=b.get("sample",a.to.lookup)})}}]}],a.sample_status=[{fieldGroup:[{className:"col-xs-6",key:"name",type:"input",templateOptions:{required:!0,label:"Name"}}]}],b}),angular.module("angularApp").service("lookupService",["APP","$http",function(a,b){var c={};return{get:function(a,b){return c[a]||this.load(a),c[a][b]},load:function(d,e){var f=a.apiPrefix+"lookups/"+d;return b.get(f,{cache:!0,params:{models:e}}).success(function(a){return c[d]=a,a})}}}]),angular.module("angularApp").service("formService",function(){var a={},b={get:function(b){return a[b]||[]}};return a.role=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"name",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"status",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"permissions",fieldHtmlClass:"input-lg"}]}]}],a.sample=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"name",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"description",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"sample_date",fieldHtmlClass:"input-lg",type:"datepicker",pickadate:{selectYears:!0,selectMonths:!0}}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"sample_status_id",fieldHtmlClass:"input-lg selectpicker",lookup:"sample_status"}]}]}],a.sample_status=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"name",fieldHtmlClass:"input-lg"}]}]}],b});