window&&!window.InflectionJS&&(window.InflectionJS=null),InflectionJS={uncountable_words:["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news","status","info"],plural_rules:[[new RegExp("(m)an$","gi"),"$1en"],[new RegExp("(pe)rson$","gi"),"$1ople"],[new RegExp("(child)$","gi"),"$1ren"],[new RegExp("^(ox)$","gi"),"$1en"],[new RegExp("(ax|test)is$","gi"),"$1es"],[new RegExp("(octop|vir)us$","gi"),"$1i"],[new RegExp("(alias|status)$","gi"),"$1es"],[new RegExp("(bu)s$","gi"),"$1ses"],[new RegExp("(buffal|tomat|potat)o$","gi"),"$1oes"],[new RegExp("([ti])um$","gi"),"$1a"],[new RegExp("sis$","gi"),"ses"],[new RegExp("(?:([^f])fe|([lr])f)$","gi"),"$1$2ves"],[new RegExp("(hive)$","gi"),"$1s"],[new RegExp("([^aeiouy]|qu)y$","gi"),"$1ies"],[new RegExp("(x|ch|ss|sh)$","gi"),"$1es"],[new RegExp("(matr|vert|ind)ix|ex$","gi"),"$1ices"],[new RegExp("([m|l])ouse$","gi"),"$1ice"],[new RegExp("(quiz)$","gi"),"$1zes"],[new RegExp("s$","gi"),"s"],[new RegExp("$","gi"),"s"]],singular_rules:[[new RegExp("(m)en$","gi"),"$1an"],[new RegExp("(pe)ople$","gi"),"$1rson"],[new RegExp("(child)ren$","gi"),"$1"],[new RegExp("([ti])a$","gi"),"$1um"],[new RegExp("((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$","gi"),"$1$2sis"],[new RegExp("(hive)s$","gi"),"$1"],[new RegExp("(tive)s$","gi"),"$1"],[new RegExp("(curve)s$","gi"),"$1"],[new RegExp("([lr])ves$","gi"),"$1f"],[new RegExp("([^fo])ves$","gi"),"$1fe"],[new RegExp("([^aeiouy]|qu)ies$","gi"),"$1y"],[new RegExp("(s)eries$","gi"),"$1eries"],[new RegExp("(m)ovies$","gi"),"$1ovie"],[new RegExp("(x|ch|ss|sh)es$","gi"),"$1"],[new RegExp("([m|l])ice$","gi"),"$1ouse"],[new RegExp("(bus)es$","gi"),"$1"],[new RegExp("(o)es$","gi"),"$1"],[new RegExp("(shoe)s$","gi"),"$1"],[new RegExp("(cris|ax|test)es$","gi"),"$1is"],[new RegExp("(octop|vir)i$","gi"),"$1us"],[new RegExp("(alias|status)es$","gi"),"$1"],[new RegExp("^(ox)en","gi"),"$1"],[new RegExp("(vert|ind)ices$","gi"),"$1ex"],[new RegExp("(matr)ices$","gi"),"$1ix"],[new RegExp("(quiz)zes$","gi"),"$1"],[new RegExp("s$","gi"),""]],non_titlecased_words:["and","or","nor","a","an","the","so","but","to","of","at","by","from","into","on","onto","off","out","in","over","with","for"],id_suffix:new RegExp("(_ids|_id)$","g"),underbar:new RegExp("_","g"),space_or_underbar:new RegExp("[ _]","g"),uppercase:new RegExp("([A-Z])","g"),underbar_prefix:new RegExp("^_"),apply_rules:function(a,b,c,d){if(d)a=d;else{var e=c.indexOf(a.toLowerCase())>-1;if(!e)for(var f=0;f<b.length;f++)if(a.match(b[f][0])){a=a.replace(b[f][0],b[f][1]);break}}return a}},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b,c){b||(b=-1);for(var d=-1,e=b;e<this.length;e++)if(this[e]===a||c&&c(this[e],a)){d=e;break}return d}),String.prototype._uncountable_words||(String.prototype._uncountable_words=InflectionJS.uncountable_words),String.prototype._plural_rules||(String.prototype._plural_rules=InflectionJS.plural_rules),String.prototype._singular_rules||(String.prototype._singular_rules=InflectionJS.singular_rules),String.prototype._non_titlecased_words||(String.prototype._non_titlecased_words=InflectionJS.non_titlecased_words),String.prototype.pluralize||(String.prototype.pluralize=function(a){return InflectionJS.apply_rules(this.toString(),this._plural_rules,this._uncountable_words,a)}),String.prototype.singularize||(String.prototype.singularize=function(a){return InflectionJS.apply_rules(this.toString(),this._singular_rules,this._uncountable_words,a)}),String.prototype.camelize||(String.prototype.camelize=function(a){for(var b=this.toLowerCase(),c=b.split("/"),d=0;d<c.length;d++){for(var e=c[d].split("_"),f=a&&d+1===c.length?1:0,g=f;g<e.length;g++)e[g]=e[g].charAt(0).toUpperCase()+e[g].substring(1);c[d]=e.join("")}return b=c.join("::")}),String.prototype.underscore||(String.prototype.underscore=function(){for(var a=this,b=a.split("::"),c=0;c<b.length;c++)b[c]=b[c].replace(InflectionJS.uppercase,"_$1"),b[c]=b[c].replace(InflectionJS.underbar_prefix,"");return a=b.join("/").toLowerCase()}),String.prototype.humanize||(String.prototype.humanize=function(a){var b=this.toLowerCase();return b=b.replace(InflectionJS.id_suffix,""),b=b.replace(InflectionJS.underbar," "),a||(b=b.capitalize()),b}),String.prototype.capitalize||(String.prototype.capitalize=function(){var a=this.toLowerCase();return a=a.substring(0,1).toUpperCase()+a.substring(1)}),String.prototype.dasherize||(String.prototype.dasherize=function(){var a=this;return a=a.replace(InflectionJS.space_or_underbar,"-")}),String.prototype.titleize||(String.prototype.titleize=function(){var a=this.toLowerCase();a=a.replace(InflectionJS.underbar," ");for(var b=a.split(" "),c=0;c<b.length;c++){for(var d=b[c].split("-"),e=0;e<d.length;e++)this._non_titlecased_words.indexOf(d[e].toLowerCase())<0&&(d[e]=d[e].capitalize());b[c]=d.join("-")}return a=b.join(" "),a=a.substring(0,1).toUpperCase()+a.substring(1)}),String.prototype.demodulize||(String.prototype.demodulize=function(){var a=this,b=a.split("::");return a=b[b.length-1]}),String.prototype.tableize||(String.prototype.tableize=function(){var a=this;return a=a.underscore().pluralize()}),String.prototype.classify||(String.prototype.classify=function(){var a=this;return a=a.camelize().singularize()}),String.prototype.foreign_key||(String.prototype.foreign_key=function(a){var b=this;return b=b.demodulize().underscore()+(a?"":"_")+"id"}),String.prototype.ordinalize||(String.prototype.ordinalize=function(){for(var a=this,b=a.split(" "),c=0;c<b.length;c++){var d=parseInt(b[c]);if(NaN===d){var e=b[c].substring(b[c].length-2),f=b[c].substring(b[c].length-1),g="th";"11"!=e&&"12"!=e&&"13"!=e&&("1"===f?g="st":"2"===f?g="nd":"3"===f&&(g="rd")),b[c]+=g}}return a=b.join(" ")}),window.Modernizr=function(a,b,c){function d(a){n.cssText=a}function e(a,b){return typeof a===b}var f,g,h,i="2.8.3",j={},k=b.documentElement,l="modernizr",m=b.createElement(l),n=m.style,o=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),p={},q=[],r=q.slice,s=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:l+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',l,'">',a,"</style>"].join(""),j.id=l,(m?j:n).innerHTML+=f,n.appendChild(j),m||(n.style.background="",n.style.overflow="hidden",i=k.style.overflow,k.style.overflow="hidden",k.appendChild(n)),g=c(j,a),m?j.parentNode.removeChild(j):(n.parentNode.removeChild(n),k.style.overflow=i),!!g},t={}.hasOwnProperty;h=e(t,"undefined")||e(t.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return t.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=r.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(r.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(r.call(arguments)))};return d}),p.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:s(["@media (",o.join("touch-enabled),("),l,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c};for(var u in p)h(p,u)&&(g=u.toLowerCase(),j[g]=p[u](),q.push((j[g]?"":"no-")+g));return j.addTest=function(a,b){if("object"==typeof a)for(var d in a)h(a,d)&&j.addTest(d,a[d]);else{if(a=a.toLowerCase(),j[a]!==c)return j;b="function"==typeof b?b():b,"undefined"!=typeof enableClasses&&enableClasses&&(k.className+=" "+(b?"":"no-")+a),j[a]=b}return j},d(""),m=f=null,j._version=i,j._prefixes=o,j.testStyles=s,j}(this,this.document),function(a){"use strict";if("undefined"==typeof XLSX)return void console.log("xlsx.js is required. Get it from https://github.com/SheetJS/js-xlsx");if("undefined"==typeof _)return void console.log("Lodash.js is required. Get it from http://lodash.com/");var b=this,c=(b.XLSXReader,function(a,b,d,e){var f={};return c.utils.intializeFromFile(f,a,b,d,e),f});"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.XLSXReader=c):b.XLSXReader=c,c.VERSION="0.0.1",c.utils={intializeFromFile:function(a,b,d,e,f){var g=new FileReader;g.onload=function(b){var g=b.target.result,h=XLSX.read(g,{type:"binary"});a.sheets=c.utils.parseWorkbook(h,d,e),f(a)},g.readAsBinaryString(b)},parseWorkbook:function(a,b,d){if(d===!0)return c.utils.to_json(a);var e={};return _.forEachRight(a.SheetNames,function(d){var f=a.Sheets[d];e[d]=c.utils.parseSheet(f,b)}),e},parseSheet:function(b,c){var d=XLSX.utils.decode_range(b["!ref"]),e=[];return c===!0&&_.forEachRight(_.range(d.s.r,d.e.r+1),function(c){var f=[];_.forEachRight(_.range(d.s.c,d.e.c+1),function(d){var e=XLSX.utils.encode_cell({c:d,r:c}),g=b[e];f[d]=g?g.v:a}),e[c]=f}),{data:e,name:b.name,col_size:d.e.c+1,row_size:d.e.r+1}},to_json:function(a){var b={};return a.SheetNames.forEach(function(c){var d=XLSX.utils.sheet_to_row_object_array(a.Sheets[c]);d.length>0&&(b[c]=d)}),b}}}.call(this);var app=angular.module("uixApp",["ngAria","ngCookies","ngMessages","ngResource","ngRoute","ui.router","ngSanitize","ngTouch","ng-token-auth","angular-underscore","chart.js","angularFileUpload","ng-mfb","ui.select","ui.bootstrap","mwl.calendar","xeditable","daterangepicker","pickadate","angular-loading-bar","pascalprecht.translate","formly","formlyBootstrap"]);angular.module("uixApp").constant("APP",{root:"/",apiPrefix:"/api/",partials:{fab:"app/partials/floating-action-button.html",filterInput:"app/partials/filter-input.html",header:"app/partials/header.html",searchForm:"app/partials/search-form.html",indexGrid:"app/partials/index-grid.html",loadMoreButton:"app/partials/load-more-button.html",formlyForm:"app/partials/formly-form.html",formNewButtons:"app/partials/form-new-buttons.html",formShowButtons:"app/partials/form-show-buttons.html",formEditButtons:"app/partials/form-edit-buttons.html",bulkNav:"app/partials/bulk-nav.html",bulkGrid:"app/partials/bulk-grid.html",uploadsGrid:"app/partials/uploads-grid.html",closeButton:"app/partials/close-button.html"},modules:{},setModule:function(a,b){this.modules[a]={name:a,title:b.title||_.startCase(a),icon:b.icon||"fa fa-home",links:b.links||[],hasAccess:b.hasAccess||function(){return!0}}}}),angular.module("uixApp").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),b.when("/","/main"),b.when("/main","/main/dashboard"),b.when("/admin","/admin/dashboard"),b.when("/reports","/reports/dashboard"),a.state("app",{url:"/?q",templateUrl:"app/layouts/app.html",controller:"AppCtrl",resolve:{auth:["$auth","$state",function(a,b){return a.validateUser()["catch"](function(){b.go("auth.signin")})}]}}).state("auth",{url:"/auth",templateUrl:"app/layouts/home.html"}).state("auth.signin",{url:"/signin",onEnter:["$state","$uibModal","$auth",function(a,b,c){c.validateUser().then(function(){a.go("app")})["catch"](function(){b.open({templateUrl:"app/layouts/signin.html",size:"sm",backdrop:"static",keyboard:!1})})}]}).state("auth.signup",{url:"/signup",onEnter:["$uibModal",function(a){a.open({templateUrl:"app/layouts/signup.html",size:"sm",backdrop:"static",keyboard:!1})}]}).state("maintenance",{url:"/maintenance",templateUrl:"app/layouts/maintenance.html"}).state("app.account",{url:"account",onEnter:["$uibModal",function(a){a.open({templateUrl:"app/layouts/account.html",size:"lg",backdrop:"static",keyboard:!1})}]}).state("app.dashboard",{url:"dashboard",templateUrl:function(){return"app/layouts/dashboard.html"},controller:"ModuleCtrl"}).state("app.pages",{url:"pages",template:"<ui-view></ui-view>"}).state("app.pages.page",{url:"/:page",templateUrl:function(a){return"app/pages/"+a.page+".html"}}).state("app.reports",{url:"reports",templateUrl:"app/modules/reports/layout.html"}).state("app.reports.dashboard",{url:"/dashboard",templateUrl:"app/modules/reports/dashboard.html"}).state("app.reports.report",{url:"/:report",templateUrl:"app/modules/reports/viewer.html",controller:"ReportCtrl"}).state("app.module",{url:":module",templateUrl:function(a){return"app/modules/"+a.module+"/layout.html"},controller:"ModuleCtrl"}).state("app.module.dashboard",{url:"/dashboard",templateUrl:function(a){return"app/modules/"+a.module+"/dashboard.html"}}).state("app.module.form",{url:"/form/:model",onEnter:["$stateParams","$uibModal",function(a,b){b.open({templateUrl:"app/components/"+a.model+"/new.html",size:"lg",backdrop:"static",keyboard:!1})}]}).state("app.module.model",{url:"/:model",templateUrl:function(a){return"app/components/"+a.model+"/index.html"}}).state("app.module.model.new",{url:"/new",templateUrl:function(a){return"app/components/"+a.model+"/new.html"}}).state("app.module.model.show",{url:"/:id",templateUrl:function(a){return"app/components/"+a.model+"/show.html"}}).state("app.module.model.newPop",{url:"/new/pop",onEnter:["$stateParams","$uibModal",function(a,b){b.open({templateUrl:"app/components/"+a.model+"/new.html",size:"lg",backdrop:"static",keyboard:!1})}]}).state("app.module.model.page",{url:"/p/:page",templateUrl:function(a){return"app/components/"+a.model+"/"+a.page+".html"}}).state("app.module.model.showPop",{url:"/:id/pop",onEnter:["$stateParams","$uibModal",function(a,b){b.open({templateUrl:"app/components/"+a.model+"/show.html",size:"lg",backdrop:"static",keyboard:!1})}]}).state("app.module.model.bulk",{url:"/:id/bulk/:table",templateUrl:function(a){return"app/components/"+a.model+"/bulk.html"}}).state("app.module.model.view",{url:"/:id/:view",templateUrl:function(a){return"app/components/"+a.model+"/"+a.view+".html"}})}]),angular.module("uixApp").config(["$authProvider",function(a){a.configure({apiUrl:"/api",confirmationSuccessUrl:window.location.href.split("#")[0]})}]).factory("responseInterceptor",["$q","$location",function(a,b){return{responseError:function(c){return 401===c.status?b.path("/login"):404===c.status||601===c.status&&b.path("/account"),a.reject(c)}}}]).config(["$httpProvider",function(a){a.interceptors.push("responseInterceptor")}]).factory("$exceptionHandler",function(){return function(a,b){}}).run(["editableOptions",function(a){a.theme="bs3"}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]).config(["formlyConfigProvider",function(a){a.setType({name:"ex-input",templateUrl:"app/templates/ex-input.html",wrapper:["bootstrapLabel","bootstrapHasError"],overwriteOk:!0}),a.setType({name:"ex-select",templateUrl:"app/templates/ex-select.html",wrapper:["bootstrapLabel","bootstrapHasError"],overwriteOk:!0}),a.setType({name:"ex-select-multiple",templateUrl:"app/templates/ex-select-multiple.html",wrapper:["bootstrapLabel","bootstrapHasError"],overwriteOk:!0}),a.setType({name:"ex-datepicker",templateUrl:"app/templates/ex-datepicker.html",wrapper:["bootstrapLabel","bootstrapHasError"],overwriteOk:!0}),a.setType({name:"ex-timepicker",templateUrl:"app/templates/ex-timepicker.html",wrapper:["bootstrapLabel","bootstrapHasError"],overwriteOk:!0}),a.setType({name:"ex-checkbox",templateUrl:"app/templates/ex-checkbox.html",wrapper:["bootstrapLabel","bootstrapHasError"],overwriteOk:!0}),a.setWrapper({name:"validation",types:["ex-input","ex-select","ex-select-multiple","ex-datepicker"],templateUrl:"app/templates/error-messages.html"})}]).run(["formlyConfig","formlyValidationMessages",function(a,b){a.extras.errorExistsAndShouldBeVisibleExpression="fc.$touched || form.$submitted",b.addStringMessage("required","This field is required"),b.addTemplateOptionValueMessage("pattern","patternValidationMessage","","","Invalid Input")}]).filter("whereMulti",function(){return function(a,b,c){return _(a).indexBy(b).at(c).value()}}),angular.module("uixApp").filter("byId",function(){return function(a,b){for(var c=0,d=a.length;d>c;c++)if(+a[c].id==+b)return a[c];return{}}}),angular.module("uixApp").filter("byValue",function(){return function(a,b){for(var c=0,d=a.length;d>c;c++)if(+a[c].value==+b)return a[c];return{}}}),angular.module("uixApp").filter("lookup",["lookupService",function(a){return function(b,c,d){var e=_.isArray(b)?b:[b],f=a.get(c),g=_.pluck(_.filter(f,function(a){return _.contains(e,a.value)}),"name");return d?g:g.join(", ")}}]),angular.module("uixApp").filter("keyToValue",["lookupService",function(a){return function(a,b){return b[a]}}]),angular.module("uixApp").directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)},isExcel:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|vnd.openxmlformats-officedocument.spreadsheetml.sheet|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)){var h=c.find("canvas"),i=new FileReader;if(i.onload=e,b.isImage(g.file))i.readAsDataURL(g.file);else if(!b.isExcel(g.file))return}}}}}]),angular.module("uixApp").directive("ngFile",function(){return{scope:{ngFile:"="},link:function(a,b,c){b.bind("change",function(b){a.$apply(function(){"multiple"in c?a.ngFile=b.target.files:a.ngFile=b.target.files[0]})})}}}),angular.module("uixApp").service("exMsg",["$q",function(a){return{notify:function(a){new PNotify(a)},success:function(a,b){new PNotify({title:b||"Success",text:a,type:"success",nonblock:!0})},error:function(a,b){new PNotify({title:b||"Error",text:a,type:"error",nonblock:!0,nonblock_opacity:.2})},notice:function(a,b){new PNotify({text:a,type:"notice",nonblock:!0,nonblock_opacity:.5})},info:function(a,b){new PNotify({title:b||"Info",text:a,addclass:"custom",opacity:.8,nonblock:!0,nonblock_opacity:.2})},errorSummary:function(a){var b="<ul>";angular.forEach(a,function(a){b+="<li>"+a+"</li>"}),b+="</ul>",new PNotify({title:"Error Summary",text:b,type:"error",hide:!1})},confirm:function(b,c){var d=a.defer();return sweetAlert({title:c||"Confirm",text:b,type:"warning",showCancelButton:!0,animation:"slide-from-top"},function(a){return a?(d.resolve(!0),!0):(d.reject(!1),!1)}),d.promise},clear:function(){PNotify.removeAll()},sweetAlert:sweetAlert,prompt:function(b,c,d,e){var f=a.defer(),g={title:c||"Input Needed",text:b,type:"input",inputValue:d||"",showCancelButton:!0,animation:"slide-from-top"};return _.merge(g,e||{}),sweetAlert(g,function(a){return a===!1?(f.reject(!1),!1):(f.resolve(a),!0)}),f.promise}}}]),angular.module("uixApp").service("resourceManager",["$q","$http","$resource",function(a,b,c){var d={models:{}};return window.rm=d,d.getName=function(a){return a=a.replace(/-/gi,"_"),a=a.underscore().split("_"),a=a.slice(0,a.length-1).join("_").camelize()+a[a.length-1].classify()},d.getUrl=function(a){return a=a.underscore().split("_"),a=a.slice(0,a.length-1).join("_").camelize()+a[a.length-1].pluralize().camelize(),a.underscore()},d.getModel=function(a,b){return b=b||{},b.name=a=this.getName(a),b.url||(b.url=this.getUrl(a)),b.key||(b.key=a.underscore()),b.title||(b.title=b.url.titleize()),b},d.register=function(a,b,d,e){if(a=this.getName(a),d=d||{id:"@id"},e=e||{},!this.models[a]){var f=c(b,d,{query:{method:"GET",isArray:!0},update:{method:"PUT"}});app.factory(a,function(){return f}),this.models[a]=this.getModel(a,e),this.models[a].apiUrl=b,this.models[a].klass=f}return this.models[a]},d.query=function(b,c,d){var e=a.defer();return b=this.getName(b),this.models[b].klass.query(c,function(a,b){a.error||a.errors?e.reject(a):e.resolve(a),d&&d(a,b("_meta_total"))},function(a){e.reject(a)}).$promise["catch"](function(a){window.error=a,e.reject({message:"Sorry, you do not have permission."})}),e.promise},d.get=function(b,c,d){var e=a.defer();return b=this.getName(b),this.models[b].klass.get(c,function(a,b){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d.create=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$save(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d.update=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$update(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d["delete"]=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$delete(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d}]),angular.module("uixApp").service("reportService",["$document",function(a){return{toCSV:function(b,c,d,e){var f=this.objectify(c);d=d||this.getColumns(f),b=b||"Report",e=e||!0;var g="Report_"+(new Date).toISOString().replace(/\:/g,"-").replace(".","-")+".csv",h="";if(h+=b+"\r\n\n",e){var i=_.chain(d).map(function(a){return a.title}).value().join(",");h+=i+"\r\n"}h+=_.chain(f).map(function(a){return _.chain(d).map(function(b){return a[b.key]}).value().join(",")}).value().join("\r\n");var j="data:text/csv;charset=utf-8,"+escape(h),k=a[0].createElement("a");k.href=j,k.style.visibility="hidden",k.download=g,a[0].body.appendChild(k),k.click(),a[0].body.removeChild(k)},toPDF:function(a,b,c){var d=this.objectify(b);c=c||this.getColumns(d),a=a||"Report";var e="Report_"+(new Date).toISOString().replace(/\:/g,"-").replace(".","-")+".pdf",f=new jsPDF("l","pt"),g=function(b,c,d){b.setFontSize(20),b.text(a,d.margins.horizontal,60),b.setFontSize(d.fontSize)};f.autoTable(c,d,{renderHeader:g,margins:{horizontal:40,top:80,bottom:50}}),f.save(e)},objectify:function(a){return"object"!=typeof a?JSON.parse(a):a},getColumns:function(a){var b=["string","number"],c=a[0];return _.chain(c).keys().reject(function(a){return 0==a.indexOf("$")}).filter(function(a){return b.indexOf(typeof c[a])>=0}).map(function(a){return{title:a,key:a}}).value()}}}]),angular.module("uixApp").factory("XLSXReaderService",["$q","$rootScope",function(a,b){var c=function(a){angular.extend(this,a)};return c.readFile=function(c,d,e){var f=a.defer();return XLSXReader(c,d,e,function(a){b.$apply(function(){f.resolve(a)})}),f.promise},c}]),angular.module("uixApp").service("fieldService",function(){var a={},b={get:function(b){return angular.copy(a[b])||[]},set:function(b,c){a[b]=c}};return b}),angular.module("uixApp").service("schemaService",function(){var a={},b={get:function(b){return angular.copy(a[b])||[]},set:function(b,c){a[b]=c}};return b}),angular.module("uixApp").service("lookupService",["APP","$http","$q",function(a,b,c){var d={},e={},f={get:function(a,b){return b&&!f.loaded(b)&&this.load(b),d[a]||[]},update:function(a,b){b&&(e[b]=!0),_.each(a,function(a,b){d[b]=a})},load:function(d,e,g){var h=c.defer();f.loaded(d)&&!g&&h.resolve(!0);var i=a.apiPrefix+"lookups/"+d;return b.get(i,{cache:!0,params:{lookups:e}}).success(function(a){f.update(a,d),console.log(),h.resolve(!0)}),h.promise},loaded:function(a){return e[a]}};return f}]),angular.module("uixApp").service("authService",["APP","$auth","$stateParams","$http","$q","exMsg",function(a,b,c,d,e,f){var g={hasAccess:function(a){var c=a||"";if(c=c.replace(/-/gi,"_"),c.indexOf(":")<0)if(c=c.split("?")[0],c.indexOf("/")<0)c=c.classify()+":index";else{var d=/^([A-z-_]+)\/new/gi,e=/^form\/([A-z-_]+)/gi,f=/^([A-z-_]+)\/(\d+)\/show/gi,g=/^([A-z-_]+)\/(\d+)\/edit/gi,h=d.exec(c),i=e.exec(c),j=f.exec(c),k=g.exec(c);h?c=h[1].classify()+":create":i?c=i[1].classify()+":create":j?c=j[1].classify()+":show":k&&(c=k[1].classify()+":update")}return _.indexOf(b.user.permissions,c)>=0},hasCreateAccess:function(a){return this.hasAccess(a+":create")},hasShowAccess:function(a){return this.hasAccess(a+":show")},hasUpdateAccess:function(a){return this.hasAccess(a+":update")},hasDeleteAccess:function(a){return this.hasAccess(a+":delete")},hasModuleAccess:function(c){var d=a.modules[c];return d?d.hasAccess?d.hasAccess(b.user):!0:!1},updateUser:function(c){var g=e.defer();return d.post(a.apiPrefix+"users/"+b.user.id+"/update_user",c).success(function(a){a.error?f.sweetAlert(a.message,(a.messages||[]).join("\n"),"error"):f.sweetAlert("Great!","Account updated successfully","success"),g.resolve(a)})["catch"](function(a){f.sweetAlert("Sorry!","Failed to update account","error"),g.reject(a)}),g.promise},showChangePassword:function(){f.sweetAlert({title:"Change Password",text:"Current Password:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Current Password"},function(a){return a===!1?!1:""===a?(f.sweetAlert.showInputError("No password provided!"),!1):void f.sweetAlert({title:"Change Password",text:"New Password:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password"},function(b){return b===!1?!1:""===b?(f.sweetAlert.showInputError("No password provided!"),!1):void f.sweetAlert({title:"Change Password",text:"New Password Again:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password Again"},function(c){return c===!1?!1:""===c?(f.sweetAlert.showInputError("No password provided!"),!1):void g.updateUser({current_password:a,password:b,password_confirmation:c})})})})}};return g}]),angular.module("uixApp").service("stateService",["$rootScope","$state","$uibModalStack",function(a,b,c){var d={isIndex:!0,isNew:!1,isNewPop:!1,isShow:!1,isShowPop:!1,isView:!1,isBulk:!1,update:function(a){a&&(this.isIndex="app.module.model"===a.name,this.isNew="app.module.model.new"===a.name||"app.module.form"===a.name,this.isNewPop="app.module.model.newPop"===a.name,this.isShow="app.module.model.show"===a.name,this.isShowPop="app.module.model.showPop"===a.name,this.isView="app.module.model.view"===a.name,this.isBulk="app.module.model.bulk"===a.name,this.showGrid=this.isIndex||this.isNew||this.isNewPop||this.isShow||this.isShowPop,this.collapsedGridMode=this.isNew||this.isShow)}};return a.$on("$stateChangeSuccess",function(a,b,c,e,f){d.update(b)}),d.update(b.current),d}]),angular.module("uixApp").controller("NgTokenAuthEventsCtrl",["$scope","$rootScope","$auth","exMsg","$state",function(a,b,c,d,e){var f=a;PNotify.prototype.options.delay=3e3,f.$on("auth:login-success",function(a,b){console.log("auth:login-success")}),f.$on("auth:login-error",function(a,b){console.log("auth:login-error")}),f.$on("auth:invalid",function(a){}),f.$on("auth:validation-success",function(a){console.log("auth:validation-success"),"auth.signin"===e.$current.name&&e.go("app")}),f.$on("auth:validation-error",function(a){console.log("auth:validation-error")}),f.$on("auth:logout-success",function(a){console.log("auth:logout-success"),"auth.signin"!==e.$current.name&&e.go("auth.signin")}),f.$on("auth:logout-error",function(a,b){console.log("auth:logout-error"),d.error("Unable to complete logout. Please try again.")}),f.$on("auth:registration-email-success",function(a,b){console.log("auth:registration-email-success");var c="A registration email was sent to "+b.email+". Follow the instructions contained in the email to complete registration.";d.sweetAlert({title:"Registration Successful",text:c,type:"success",animation:"slide-from-top"},function(){e.go(".",{},{reload:!0})})}),f.$on("auth:registration-email-error",function(a,b){console.log("auth:registration-email-error");var c=b.errors.full_messages[0];d.sweetAlert({title:"Registration Failed",text:c,type:"error",animation:"slide-from-top"})}),b.$on("auth:email-confirmation-success",function(a,b){console.log("auth:email-confirmation-success");var c="Your account has been verified";d.sweetAlert({title:"Welcome, "+b.name,text:c,type:"info",animation:"slide-from-top"})}),f.$on("auth:email-confirmation-error",function(a,b){console.log("auth:email-confirmation-error"),d.error("There was an error with your registration.")}),f.$on("auth:password-reset-request-success",function(a,b){console.log("auth:password-reset-request-success");var c="Password reset instructions were sent to "+b.email;d.sweetAlert({title:"Password Reset",text:c,type:"info",animation:"slide-from-top"})}),f.$on("auth:password-reset-request-error",function(a,b){console.log("auth:password-reset-request-error");var c=b.errors[0];d.sweetAlert({title:"Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:password-reset-confirm-success",function(){console.log("auth:password-reset-confirm-success"),d.sweetAlert({title:"Reset Password",text:"New Password:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password"},function(a){return a===!1?!1:""===a?(d.sweetAlert.showInputError("No password provided!"),!1):void d.sweetAlert({title:"Reset Password",text:"New Password Again:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password Again"},function(b){return b===!1?!1:""===b?(d.sweetAlert.showInputError("No password provided!"),!1):void c.updatePassword({password:a,password_confirmation:b})})})}),f.$on("auth:password-reset-confirm-error",function(a,b){console.log("auth:password-reset-confirm-error");var c="Unable to verify your account. Please try again.";d.sweetAlert({title:"Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:password-change-success",function(a){console.log("auth:password-change-success");var b="Your password has been successfully updated!";d.sweetAlert({title:"Successful",text:b,type:"info",animation:"slide-from-top"})}),f.$on("auth:password-change-error",function(a,b){console.log("auth:password-change-error");var c="Registration failed: "+b.errors[0];d.sweetAlert({title:"Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:account-update-success",function(a){console.log("auth:account-update-success");var b="Your account has been successfully updated!";d.sweetAlert({title:"Successful",text:b,type:"info",animation:"slide-from-top"})}),f.$on("auth:account-update-error",function(a,b){console.log("auth:account-update-error");var c="Registration failed: "+b.errors[0];d.sweetAlert({title:"Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:account-destroy-success",function(a){console.log("auth:account-destroy-success");var b="Your account has been successfully destroyed!";d.sweetAlert({title:"Successful",text:b,type:"info",animation:"slide-from-top"})}),f.$on("auth:account-destroy-error",function(a,b){console.log("auth:account-destroy-error");var c="Account deletion failed: "+b.errors[0];d.sweetAlert({title:"Failed",text:c,type:"error",animation:"slide-from-top"})}),f.$on("auth:session-expired",function(a){console.log("auth:session-expired"),"auth.signin"!==e.$current.name&&e.go("auth.signin")})}]),angular.module("uixApp").controller("AuthCtrl",["$scope","$rootScope","APP","$auth","$http","$state","exMsg","$uibModalStack",function(a,b,c,d,e,f,g,h){var i=this;i.user={},i.showLoginError=!1,i.submitLogin=function(a){d.submitLogin(i.user)},b.$on("auth:login-success",function(a,b){h.dismissAll(),f.go("app")}),b.$on("auth:login-error",function(a,b){i.showLoginError=!0}),i.submitRegistration=function(a){d.submitRegistration(i.user)},i.goToSignUp=function(){h.dismissAll(),f.go("auth.signup")},i.backToSignIn=function(){h.dismissAll(),f.go("auth.signin")},i.sendPasswordResetEmail=function(){g.sweetAlert({title:"Password Reset",text:"Email",type:"input",showCancelButton:!0,animation:"slide-from-top"},function(a){return a===!1?!1:""===a?(g.sweetAlert.showInputError("No email provided!"),!1):void d.requestPasswordReset({email:a})})},i.sendConfirmationInstructions=function(){g.sweetAlert({title:"Confirmation Instructions",text:"Email",type:"input",showCancelButton:!0,animation:"slide-from-top"},function(a){return a===!1?!1:""===a?(g.sweetAlert.showInputError("No email provided!"),
!1):void e.post(c.apiPrefix+"users/send_confirmation_instructions",{email:a}).success(function(a){a.error?g.sweetAlert("Error",a.message,"error"):g.sweetAlert("Successful",a.message,"success")})})},i.sendUnlockInstructions=function(){}}]),angular.module("uixApp").controller("AppCtrl",["$scope","$rootScope","$http","$auth","$q","$state","APP","exMsg","$stateParams","authService","stateService",function(a,b,c,d,e,f,g,h,i,j,k){var l=a;window.appCtrl=l,b.partials=g.partials||{},b.modules=g.modules||{},d.validateToken(),b.state=k,b.hasAccess=j.hasAccess,b.hasModuleAccess=j.hasModuleAccess,l.drpOptions={showDropdowns:!0,ranges:{Today:[moment().startOf("day"),moment().endOf("day")],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment().endOf("day")],"Last 30 Days":[moment().subtract(29,"days"),moment().endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"This Year":[moment().startOf("year"),moment().endOf("year")]},opens:"left"},l.drpOptionsR={showDropdowns:!0,ranges:{Today:[moment().startOf("day"),moment().endOf("day")],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment().endOf("day")],"Last 30 Days":[moment().subtract(29,"days"),moment().endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"This Year":[moment().startOf("year"),moment().endOf("year")]},opens:"right"},b.error=function(a){a=a||{},a.message&&h.error(a.message,a.type||"Error"),a.messages&&h.errorSummary(a.messages)},l.back=function(){f.go("^")},l.hasUrl=function(a){return window.location.hash.indexOf(a)>=0},l.buildQ=function(a){return _.map(a,function(a,b){return b+".eq."+a}).join(":")},l.splitQ=function(a){var b={};return a.split(":").forEach(function(a){var c=a.split(".eq.");c[1]&&(b[c[0]]=c[1])}),b},l.showPasswordChange=function(){j.showChangePassword()}}]),angular.module("uixApp").controller("AccountCtrl",["$scope","APP","$auth","$http","$state","exMsg","authService","$uibModalStack",function(a,b,c,d,e,f,g,h){var i=this;i.model={},i.action={updating:!1,deleting:!1},i.initRoute=function(){i.reset()},i.reset=function(){i.model={},i.model.name=c.user.name,i.model.email=c.user.email},i.close=function(){h.getTop()&&a.$dismiss(),e.go("^")},i.update=function(){i.action.updating=!0,g.updateUser(i.model)["finally"](function(){c.validateToken()["finally"](function(){i.close()})})},i["delete"]=function(){i.action.deleting=!0,d.post(b.apiPrefix+"users/"+c.user.id+"/delete_user").success(function(a){a.error?f.sweetAlert(a.message,(a.messages||[]).join("\n"),"error"):f.sweetAlert("Great!","Your account has been scheduled for deletion","success")})["catch"](function(a){f.sweetAlert("Sorry!","Account deletion failed","error")})["finally"](function(){i.action.deleting=!1})}}]),angular.module("uixApp").controller("DashboardCtrl",["APP","$http",function(a,b){var c=this;c.data={},c.routeName=null,c.initRoute=function(a){c.routeName=a,c.reload()},c.reload=function(){b.get(a.apiPrefix+"dashboard/"+c.routeName).success(function(a){c.data=a})},c.onClick=function(a,b){console.log(a,b)}}]),angular.module("uixApp").controller("ReportCtrl",["$scope","APP","$http","$state","$stateParams","$sce",function(a,b,c,d,e,f){var g=a;window.reportCtrl=g,g.action={generating:!1},g.currentLink={},g.report={},g.filter={},g.reports={user_info:{name:"user_info",title:"User",fields:[{key:"user_id",type:"select",templateOptions:{label:"Select User",valueProp:"id",labelProp:"name",options:[]},controller:["$scope","$http",function(a,c){c.get(b.apiPrefix+"users?size=200").success(function(b){a.options.templateOptions.options=b})}]}]},users:{name:"users",title:"Users",fields:[]},roles:{name:"roles",title:"Roles",fields:[]}},a.$on("$stateChangeSuccess",function(a,c,d,f,h){var i=b.modules.reports;i&&(g.currentLink=_.first(_.where(i.links,{url:e.report})))}),g.generateReport=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name;c.get(a,{params:g.filter}).success(function(a){var b="data:application/pdf;base64,"+a;g.pdfSrc=f.trustAsResourceUrl(b)})["finally"](function(){g.action.generating=!1})},g.renderReportPage=function(){var a=e.report;g.report=g.reports[a],g.report&&g.report.fields&&(g.fields=g.report.fields)},g.previewReport=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".html";c.get(a,{params:g.filter}).success(function(a){g.report.html=f.trustAsHtml(a)})["finally"](function(){g.action.generating=!1})},g.downloadAsCSV=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".csv";c.get(a,{params:g.filter}).success(function(a){console.log(a);var b="data:text/csv;charset=utf-8,"+a,c=f.trustAsResourceUrl(b),d=angular.element("<a></a>");d.attr("href",c),d.attr("download",g.report.name+".csv"),d[0].click()})["finally"](function(){g.action.generating=!1})},g.downloadAsXLS=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".xls";c.get(a,{params:g.filter}).success(function(a){console.log(a);var b="data:application/xls;"+a,c=f.trustAsResourceUrl(b),d=angular.element("<a></a>");d.attr("href",c),d.attr("download",g.report.name+".xls"),d[0].click()})["finally"](function(){g.action.generating=!1})},g.downloadAsPDF=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".pdf";c.get(a,{params:g.filter}).success(function(a){var b="data:application/pdf;base64,"+a,c=f.trustAsResourceUrl(b),d=angular.element("<a></a>");d.attr("href",c),d.attr("download",g.report.name+".pdf"),d[0].click()})["finally"](function(){g.action.generating=!1})},g.renderReportPage()}]),angular.module("uixApp").controller("ModuleCtrl",["$scope","APP","$state",function(a,b,c){var d=a;window.moduleCtrl=d,d.hideFloatingActionButton=!0,d.fabActions=[],d.fabMenuState="closed",d.fabMainIcon="fa-chevron-left",d.fabMainLabel="Back",d.fabMainAction=function(){c.go("^")},d.$on("$stateChangeStart",function(a,b,c,e,f){d.hideFloatingActionButton=!0}),d.$on("fab:load-actions",function(a,b,e,f){var g=["fa fa-columns","fa fa-link","fa fa-th-large","fa fa-file-o"];d.fabActions=_.map(e,function(a){return{icon:a.icon||g.pop(),label:a.label,handler:function(){a.handler&&a.handler()}}}).reverse(),f=f||{icon:"fa-chevron-left",label:"Back",handler:function(){c.go("^")}},d.fabMainIcon=f.icon,d.fabMainLabel=f.label,d.fabMainAction=f.handler,d.hideFloatingActionButton=!1})}]),angular.module("uixApp").controller("IndexCtrl",["$scope","$rootScope","$state","$stateParams","$http","APP","resourceManager","$filter","exMsg","byValueFilter","reportService","lookupService","schemaService","authService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(c,d){d=d||{},N.modelName=d.name||g.getName(c),window[N.modelName+"IndexCtrl"]=N,N.model=g.register(N.modelName,f.apiPrefix+c+"/:id"),l.load(N.model.key,d.lookups).then(function(){H(),b.$broadcast("uix:index-ready",N.model.name,N,a)})}function p(a){N.options=_.merge(N.options,a)}function q(a,b){N.classConfig={field:a,data:b}}function r(a,b,c,d){a&&(b=b||_.startCase(a),N.columns.push({name:a,title:b,filter:c,filterParam:d}),N.collapsedColumn.name||(N.collapsedColumn=_.last(N.columns)))}function s(a,b,c,d){a&&(b=b||_.startCase(a),N.collapsedColumn={name:a,title:b,filter:c,filterParam:d})}function t(){var a=f.modules[d.module];a&&(N.currentLink=_.first(_.where(a.links,{url:d.model})))}function u(){if(a.state.isIndex){var c=[],d={icon:"fa fa-refresh",label:"Reload",handler:N.reload};N.hasCreateAccess()&&c.push({icon:"fa fa-plus",label:"New "+N.model.name,handler:N["new"]}),c.push({icon:"fa fa-search",label:"Search",handler:N.showSearch}),b.$broadcast("fab:load-actions",N.model.name,c,d)}}function v(a){var b=m.get(N.model.key).properties;return b?(_.chain(b).map(function(a,b){return{key:b,type:a.type,lookupModel:a.lookup}}).reject(function(a){return!a.lookupModel}).each(function(b){var c=b.lookupModel+"_name";"array"===b.type&&(c+="s"),a[c]=h("lookup")(a[b.key],b.lookupModel)}).value(),a):a}function w(a){return a.row_class=N.classConfig.data[a[N.classConfig.field]],a}function x(c,d,e){N.action.loading=!0,N.action.searching?(e=N.getQueryParams(),N.action.searched=!0):e||(e=N.searchQuery||{}),e.page=c||N.paging.currentPage,e.size=d||N.paging.recordsPerPage,g.query(N.model.name,e,function(a,b){N.paging.totalRecords=b}).then(function(c){N.updateRecords(c),b.$broadcast("uix:records-loaded",N.model.name,N.records,a)})["catch"](function(a){console.log(a),N.error(a)})["finally"](function(a){N.action.loading=!1})}function y(a,b){if(!b)return"";var c=a[b.name];return b.filter&&(c=h(b.filter)(c,b.filterParam)),c}function z(a){return l.get(a)}function A(a){angular.forEach(a,function(a){N.recordsHash[a.id]||(N.records.push(w(v(a))),N.recordsHash[a.id]=!0)})}function B(a){if(a){var b=_.findIndex(N.records,_.pick(a,"id"));b>=0&&(N.records[b]=w(v(angular.copy(a))))}}function C(a){if(a){var b=_.findIndex(N.records,_.pick(a,"id"));b>=0&&(N.records.splice(b,1),delete N.recordsHash[a.id])}}function D(){N.recordsHash={},N.records=[],N.paging.currentPage=1,N.queryRecords()}function E(){N.records.length<N.paging.totalRecords&&(N.paging.currentPage=N.paging.currentPage+1,N.queryRecords())}function F(){var a=_.chain(N.columns).map(function(a){return{key:a.name,title:a.title}}).value(),c=_.map(N.records,function(a){var b={};return _.each(N.columns,function(c){b[c.name]=N.columnData(a,c)||""}),b});k.toCSV(N.model.title,c,a),b.$broadcast("report:csv-generated",N.model.name)}function G(){var a=_.chain(N.columns).map(function(a){return{key:a.name,title:a.title}}).value();a.unshift({key:"no",title:"No"});var c=_.map(N.records,function(a,b){var c={};return c.no=b+1,_.each(N.columns,function(b){c[b.name]=N.columnData(a,b)||""}),c});k.toPDF(N.model.title,c,a),b.$broadcast("report:pdf-generated",N.model.name)}function H(){N.search.fields=m.get(N.model.key).properties,N.search.dateRange={startDate:null,endDate:null}}function I(){var a=_.reduce(N.search.params,function(a,b,c){var d=_.findWhere(N.search.fields,{key:c});return d?("date"===d.format?a[c+".between"]=_.map(b,function(a){return a.startDate.toISOString()+"|"+a.endDate.toISOString()}).join("||"):"select"===d.format?a[c+".in"]=b.join():"text"===d.format&&(a[c+".like"]=b.join("|")),a):a},{});if(N.search.dateRange&&N.search.dateRange.startDate){var b=N.search.dateRange.startDate.toISOString(),c=N.search.dateRange.endDate.toISOString();a["created_at.between"]=b+"|"+c}return a}function J(){N.search.queries=_.reduce(N.search.params,function(a,b,c){var d=_.findWhere(N.search.fields,{key:c});if(!d)return a;var e=d.title+": ";if("select"===d.format)e+=h("lookup")(b,d.lookup,!0);else if("date"===d.format){var f=_.map(b,function(a){var b=new Date(a.startDate).toISOString().slice(0,10),c=new Date(a.endDate).toISOString().slice(0,10);return b===c?b:"("+b+","+c+")"});e+=_.uniq(f)}else e+=_.uniq(b);return a[c]=e,a},{})}function K(){if(N.search.searchField&&N.search.searchValue){var a=N.search.searchField.key;N.search.params[a]||(N.search.params[a]=[]),N.search.params[a].push(N.search.searchValue),N.search.searchValue=null,N.buildSearchQueries()}}function L(){N.search.params={},N.search.queries={}}function M(a){delete N.search.params[a],N.buildSearchQueries()}var N=this;a.vmRef=N,N.currentLink={},N.model={},N.modelName=null,N.recordsHash={},N.records=[],N.currentRecord={},N.searchQuery=null,N.action={loading:!1,searching:!1,deleting:!1,searched:!1},N.paging={totalRecords:0,recordsPerPage:15,currentPage:1,previousId:0,currentId:0,nextId:0},N.columns=[],N.classConfig={field:"",data:""},N.collapsedColumn={},N.options={openable:!0,popable:!0,collapsible:!0},N.initRoute=o,N.config=p,N.classes=q,N.column=r,N.setCollapsedColumn=s,N.queryRecords=x,N.columnData=y,N.lookupData=z,N.updateRecords=A,N.updateRecordInRecords=B,N.removeRecordInRecords=C,N.reload=D,N.loadMore=E,N.toPDF=G,N.toCSV=F,N.search={fields:[],params:{},queries:{}},N.initSearch=H,N.getQueryParams=I,N.buildSearchQueries=J,N.addSearchParam=K,N.clearSearchParams=L,N.removeSearchParam=M,a.$on("$stateChangeSuccess",function(a,b,c,d,e){t(),u()}),a.$on("uix:record-loaded",function(a,b,c){N.model.name==b&&(N.currentRecord=c,N.paging.currentId=c.id,N.updateRecordInRecords(c))}),a.$on("uix:record-created",function(a,b,c){N.model.name===b&&(N.records.unshift(angular.copy(c)),N.recordsHash[c.id]=!0,w(v(N.records[0])))}),a.$on("uix:record-updated",function(a,b,c){N.model.name===b&&N.updateRecordInRecords(c)}),a.$on("uix:record-deleted",function(a,b,c){N.model.name===b&&N.removeRecordInRecords(c)}),a.$watch("vm.paging.recordsPerPage",function(){N.paging.currentPage=1,N.reload()}),N.showSearch=function(){N.action.searching=!0},N.hideSearch=function(){N.action.searching=!1,N.paging.recordsPerPage=15,N.action.searched&&(N.action.searched=!1,N.reload())},N.toggleSearch=function(){N.action.searching?N.hideSearch():N.showSearch()},N["new"]=function(){c.go(".newPop")},N.hasCreateAccess=function(){return n.hasCreateAccess(N.model.name)},N.hasShowAccess=function(){return n.hasShowAccess(N.model.name)},N.hasUpdateAccess=function(){return n.hasUpdateAccess(N.model.name)},N.hasDeleteAccess=function(){return n.hasDeleteAccess(N.model.name)},N.setSearchQuery=function(a){N.searchQuery=a}}]),angular.module("uixApp").controller("FormCtrl",["$scope","$rootScope","APP","resourceManager","exMsg","$state","$stateParams","$http","$translate","fieldService","lookupService","schemaService","authService","$uibModalStack",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(e,f){f=f||{},f.loadRecord=void 0===f.loadRecord?!0:f.loadRecord,C.modelName=f.name||d.getName(e),window[C.modelName+"FormCtrl"]=C,C.model=d.register(C.modelName,c.apiPrefix+e+"/:id"),C.formly.fields=j.get(C.model.key),k.load(C.model.key,f.lookups,!0).then(function(){C.setRecord(),b.$broadcast("uix:form-ready",C.model.name,C,a)}),f.loadRecord&&g.id?C.recordId=g.id:f.recordId?C.recordId=f.recordId:b[C.model.key+"_id"]&&(C.recordId=b[C.model.key+"_id"],b[C.model.key+"_id"]=null),C.recordId?C.loadRecord(C.recordId):C.formly.options.formState.readOnly=!1}function p(c){if(c){C.action.loading=!0;var e={id:c};d.get(C.model.name,e).then(function(c){C.record=c,C.formly.model=angular.copy(C.record),C.sanitizeRecord(),b.$broadcast("uix:record-loaded",C.model.name,C.record,a),C.action.loading=!1,C.formly.options.formState.readOnly=!0})["catch"](function(a){C.error(a),C.action.loading=!1})}}function q(){_.each(C.record,function(a,b){null===a&&(C.record[b]="")})}function r(){!C.record.id&&g.q&&(_.each(C.splitQ(g.q),function(a,b){C.record[b]=a}),b.$broadcast("uix:record-set",C.model.name,C.record,a))}function s(){C.record={},n.getTop()&&a.$dismiss(),f.go("^")}function t(){C.action.saving=!0,C.action.creating=!0;var c={};c[C.model.key]=C.formly.model,d.create(C.model.name,c).then(function(c){C.record=c,C.formly.model=angular.copy(C.record),b.$broadcast("uix:record-created",C.model.name,c,a),e.success(C.model.title+" created successfully"),C.close()})["catch"](function(a){C.error(a)})["finally"](function(){C.action.saving=!1,C.action.creating=!1})}function u(){C.formly.options.formState.readOnly=!1,C.action.editMode=!0}function v(){return C.formly.options.formState.readOnly}function w(){return!C.formly.options.formState.readOnly}function x(){C.formly.model=angular.copy(C.record),C.formly.options.formState.readOnly=!0,C.action.editMode=!1}function y(){f.go("^.uploads",g)}function z(){if(C.record.id){C.action.saving=!0,C.action.updating=!0;var c={id:C.record.id};c[C.model.key]=C.formly.model,d.update(C.model.name,c).then(function(c){C.record=c,C.formly.model=angular.copy(C.record),b.$broadcast("uix:record-updated",C.model.name,c,a),e.success(C.model.title+" updated successfully"),C.close()})["catch"](function(a){C.error(a)})["finally"](function(){C.action.saving=!1,C.action.updating=!1})}}function A(){PNotify.removeAll(),C.formly.form.$setSubmitted(!0),C.formly.form.$valid&&(C.record.id?C.update():C.create())}function B(){C.action.deleting=!0;var c="Are you sure you want to delete this "+C.model.title+"?";e.confirm(c,"Confirm Delete").then(function(){var c={id:C.record.id};c[C.model.key]=C.record,d["delete"](C.model.name,c).then(function(c){b.$broadcast("uix:record-deleted",C.model.name,C.record,a),e.success(C.model.title+" deleted successfully"),C.close()})["catch"](function(a){C.error(a)})["finally"](function(){C.action.deleting=!1})})["catch"](function(){C.action.deleting=!1})}var C=this;a.vmRef=C,C.model={},C.modelName=null,C.recordId=null,C.record={},C.action={editMode:!1,loading:!0,saving:!1,creating:!1,updating:!1,deleting:!1},C.formly={model:{},fields:[],options:{formState:{readOnly:!0}},form:{}},C.initRoute=o,C.loadRecord=p,C.sanitizeRecord=q,C.setRecord=r,C.close=s,C.create=t,C.edit=u,C.isViewMode=v,C.isEditMode=w,C.cancelEdit=x,C.uploads=y,C.update=z,C.save=A,C["delete"]=B,C.hasCreateAccess=function(){return m.hasCreateAccess(C.model.name)},C.hasShowAccess=function(){return m.hasShowAccess(C.model.name)},C.hasUpdateAccess=function(){return m.hasUpdateAccess(C.model.name)},C.hasDeleteAccess=function(){return m.hasDeleteAccess(C.model.name)},a.$on("$stateChangeSuccess",function(c,d,e,g,h){if(a.state.isShow){var i=[],j={};C.hasCreateAccess()&&(j={icon:"fa fa-plus",label:"New "+C.model.name,handler:C["new"]}),i.push({icon:"fa fa-chevron-left",label:"Back",handler:function(){f.go("^")}}),b.$broadcast("fab:load-actions",C.model.name,i,j)}}),a.$on("uix:reload-record",function(a,b,c){b===C.model.name&&c.id===C.record.id&&C.loadRecord(C.record.id)})}]),angular.module("uixApp").controller("UploadsCtrl",["$scope","$rootScope","APP","exMsg","$state","$stateParams","$http","$translate","resourceManager","FileUploader",function(a,b,c,d,e,f,g,h,i,j){var k=a;k.uploader=new j,window.uploadsCtrl=k,k.model={},k.modelName=null,k.recordId=null,k.record={},k.action={loading:!0,saving:!1,updating:!1},k.init=function(a,b){k.modelName=a,k.model=i.register(a,c.apiPrefix+a.replace(/-/gi,"_")+"/:id"),k.recordId=b,k.loadRecord(b)},k.loadRecord=function(a){if(a){k.action.loading=!0;var c={id:a};i.get(k.model.name,c).then(function(a){k.record=a,k.sanitizeRecord(),b.$broadcast("uix:record-loaded",k.model.name,k.record,k),k.action.loading=!1})["catch"](function(a){k.error(a),k.action.loading=!1})}},k.hasUpdateAccess=function(){return k.hasAccess(k.model.name+":update")},k.$on("uix:reload-record",function(a,b,c){b===k.model.name&&c.id===k.record.id&&k.loadRecord(k.record.id)}),k.sanitizeRecord=function(){_.each(k.record,function(a,b){null===a&&(k.record[b]="")})},k.setRecord=function(){!k.record.id&&f.q&&(_.each(k.splitQ(f.q),function(a,b){k.record[b]=a}),b.$broadcast("uix:record-set",k.model.name,k.record,k))},k.modelName||k.init(f.model,f.id)}]),angular.module("uixApp").controller("BulkCtrl",["$scope","$rootScope","APP","exMsg","$stateParams","$state","$http","$translate","resourceManager","schemaService","XLSXReaderService",function(a,b,c,d,e,f,g,h,i,j,k){function l(d,f){f=f||{},o.routeName=d,o.masterRecordId=e.id,o.modelName=i.getName(f.table||e.table),window[o.modelName+"BulkCtrl"]=o,o.model=i.register(o.modelName,c.apiPrefix+e.table.replace(/-/gi,"_")+"/:id"),o.upload.matchFields=_.chain(j.get(o.model.key).properties).map(function(a,b){return{key:b,title:a.title}}).filter(function(a){return["created_at","updated_at"].indexOf(a.key)<0}).value(),b.$broadcast("uix:bulk-view-ready",o.model.name,{},a)}function m(){var a=_.map(o.upload.records,function(a){var b={};return _.each(o.upload.matchedFields,function(c,d){b[c]=a[d]}),b});g.post(c.apiPrefix+o.routeName+"/"+o.masterRecordId+"/bulk_upload",{table:o.model.url,data:a}).success(function(a){a.error?d.error(a.message,a.type):(o.upload.data={},o.upload.selectedSheet="",o.upload.records=[],d.success(a.length+" records created successfully"))}).error(function(a,b,c,e){d.error("error")})}function n(){f.go("^")}var o=this;a.vmRef=o,o.model={},o.routeName=null,o.masterRecordId=null,o.modelName=null,o.action={loading:!0,saving:!1,updating:!1},o.upload={},o.upload.matchedFields={},o.upload.matchFields=[],o.initRoute=l,o.bulkUpload=m,o.close=n,a.$watch("vm.upload.file",function(a){a&&(o.upload.selectedSheet="",k.readFile(o.upload.file,!0,!0).then(function(a){o.upload.data=a,o.upload.selectedSheet=_.keys(a.sheets)[0]}))}),a.$watch("vm.upload.selectedSheet",function(){var c=o.upload.data.sheets[o.upload.selectedSheet];return c?(o.upload.selectedHeaders=_.chain(c[0]).keys().pull("$$hashKey").value(),o.upload.records=c,void b.$broadcast("uix:bulk-automatch-fields",o.model.name,{},a)):(o.upload.selectedHeaders=[],void(o.upload.records=[]))}),a.$on("uix:bulk-automatch-fields",function(a,b,c,d){o.model.name===b&&(d.vmRef.upload.matchedFields={},_.each(d.vmRef.upload.selectedHeaders,function(a){var b=_.find(d.vmRef.upload.matchFields,function(b){return b.title.toUpperCase()===a.toUpperCase()});b&&(d.vmRef.upload.matchedFields[a]=b.key)}))})}]),angular.module("uixApp").controller("CalendarCtrl",["APP","$http",function(a,b){var c=this;c.routeName=null,c.view="month",c.events=[],c.viewDate=new Date,c.viewTitle="",c.initRoute=function(a,b){c.routeName=a,b=b||{},b.view&&(c.view=b.view),c.reload()},c.reload=function(){b.get(a.apiPrefix+"dashboard/"+c.routeName).success(function(a){c.events=_.map(a,function(a){return a.incrementsBadgeTotal=!1,a})})}}]),angular.module("uixApp").run(["APP",function(a){function b(){return[{text:"Users",url:"users",icon:"fa fa-users color-deep-purple-300"},{text:"Roles",url:"roles",icon:"glyphicon glyphicon-user color-red-100"},{text:"UserForm",url:"form/roles",icon:"fa fa-user color-teal-500"}]}function c(a){return!0}a.setModule("main",{title:"Home",icon:"fa fa-home",links:b(),hasAccess:c})}]),angular.module("uixApp").run(["APP",function(a){function b(){return[{text:"Users",url:"users",icon:"fa fa-briefcase color-deep-purple-300"},{text:"Roles",url:"roles",icon:"fa fa-user color-red-100"}]}function c(a){return!0}a.setModule("admin",{title:"Admin Panel",icon:"fa fa-cogs",links:b(),hasAccess:c})}]),angular.module("uixApp").run(["APP",function(a){function b(){return[{text:"User",url:"user_info",icon:"fa fa-files-o color-teal-700"},{text:"Users",url:"users",icon:"fa fa-leanpub color-green-800"},{text:"Roles",url:"roles",icon:"fa fa-shekel color-blue-700"}]}function c(a){return!0}a.setModule("reports",{title:"Reports",icon:"fa fa-bar-chart",links:b(),hasAccess:c})}]),angular.module("uixApp").controller("RoleIndexCtrl",["$scope","APP","$http","exMsg",function(a,b,c,d){a.$on("exui:index-ready",function(a,b,c,d){})}]),angular.module("uixApp").controller("RoleFormCtrl",["$scope","APP","$http","exMsg",function(a,b,c,d){a.$on("exui:form-ready",function(a,b,c,d){}),a.$on("exui:record-loaded",function(a,b,c,d){})}]),angular.module("uixApp").run(["fieldService",function(a){function b(){return[{fieldGroup:[{className:"col-xs-6",key:"name",type:"ex-input",templateOptions:{required:!0,label:"Name"}},{className:"col-xs-6",key:"description",type:"ex-input",templateOptions:{required:!1,label:"Description"}}]},{fieldGroup:[{className:"col-xs-12 large-tags",key:"permissions",type:"ex-select-multiple",templateOptions:{required:!1,label:"Permissions",valueProp:"name",labelProp:"name",options:[]},controller:["$scope","lookupService",function(a,b){b.load("role","permission").then(function(){a.to.options=b.get("permission")})}]}]}]}a.set("role",b())}]),angular.module("uixApp").run(["schemaService",function(a){function b(){return{type:"object",title:"Role",required:["name","name"],properties:{name:{key:"name",title:"Name",type:"string",format:"text"},permissions:{key:"permissions",title:"Permissions",type:"string",format:"text"},status:{key:"status",title:"Status",type:"string",format:"text"}}}}a.set("role",b())}]),angular.module("uixApp").controller("UserIndexCtrl",["$scope","APP","$http","exMsg",function(a,b,c,d){a.$on("exui:index-ready",function(a,b,c,d){})}]),angular.module("uixApp").controller("UserFormCtrl",["$scope","APP","$http","exMsg",function(a,b,c,d){a.$on("exui:form-ready",function(a,b,c,d){}),a.$on("exui:record-loaded",function(a,e,f,g){"User"===e&&(g.vmRef.lockUser=function(){g.vmRef.action.locking=!0,c.post(b.apiPrefix+"users/"+f.id+"/lock").success(function(a){g.vmRef.record=a,d.success("User successfully locked")})["catch"](function(a){d.error(a.message)})["finally"](function(){g.vmRef.action.locking=!1})},g.vmRef.unlockUser=function(){g.vmRef.action.unlocking=!0,c.post(b.apiPrefix+"users/"+f.id+"/unlock").success(function(a){g.vmRef.record=a,d.success("User successfully unlocked")})["catch"](function(a){d.error(a.message)})["finally"](function(){g.vmRef.action.unlocking=!1})},g.vmRef.resetPassword=function(){})})}]),angular.module("uixApp").run(["fieldService",function(a){function b(){return[{fieldGroup:[{className:"col-xs-6",key:"name",type:"ex-input",templateOptions:{required:!0,label:"Name"}},{className:"col-xs-6",key:"email",type:"ex-input",templateOptions:{required:!0,label:"Email"}}]},{fieldGroup:[{className:"col-xs-6",key:"password",type:"ex-input",templateOptions:{type:"password",required:!0,label:"Password"},hideExpression:"model.id"},{className:"col-xs-6",key:"password_confirmation",type:"ex-input",templateOptions:{type:"password",required:!0,label:"Password Confirmation"},hideExpression:"model.id"}]},{fieldGroup:[{className:"col-xs-6",key:"sign_in_count",type:"ex-input",templateOptions:{required:!0,label:"Sign In Count"},hideExpression:"!(model.id && formState.readOnly)"},{className:"col-xs-6",key:"failed_attempts",type:"ex-input",templateOptions:{required:!0,label:"Failed Attempts"},hideExpression:"!(model.id && formState.readOnly)"}]},{fieldGroup:[{className:"col-xs-6",key:"current_sign_in_at",type:"ex-datepicker",templateOptions:{required:!0,label:"Current Sign In At"},hideExpression:"!(model.id && formState.readOnly)"},{className:"col-xs-6",key:"last_sign_in_at",type:"ex-datepicker",templateOptions:{required:!0,label:"Last Sign In At"},hideExpression:"!(model.id && formState.readOnly)"}]},{fieldGroup:[{className:"col-xs-6",key:"current_sign_in_ip",type:"ex-datepicker",templateOptions:{required:!0,label:"Current Sign In IP"},hideExpression:"!(model.id && formState.readOnly)"},{className:"col-xs-6",key:"last_sign_in_ip",type:"ex-datepicker",templateOptions:{required:!0,label:"Last Sign In IP"},hideExpression:"!(model.id && formState.readOnly)"}]},{fieldGroup:[{className:"col-xs-12",key:"role_ids",type:"ex-select-multiple",templateOptions:{required:!1,label:"Roles",lookup:"role",placeholder:"Select roles ...",valueProp:"value",labelProp:"name",options:[]},controller:["$scope","lookupService",function(a,b){b.load("user","role").then(function(){a.to.options=b.get(a.to.lookup)})}]}]},{fieldGroup:[{className:"col-xs-6",key:"enforce_confirmation",type:"checkbox",templateOptions:{required:!1,label:"Enforce Confirmation"},hideExpression:"model.id"}]}]}a.set("user",b())}]),angular.module("uixApp").run(["schemaService",function(a){function b(){return{type:"object",title:"User",required:["name","email"],properties:{name:{key:"name",title:"Name",type:"string",format:"text"},email:{key:"email",title:"Email",type:"string",pattern:"^([\\w-]+(?:\\.[\\w-]+)*)@((?:[\\w-]+\\.)*\\w[\\w-]{0,66})\\.([a-z]{2,6}(?:\\.[a-z]{2})?)$",validationMessage:"Should be a correct Email Address",format:"text"},role_ids:{key:"role_ids",title:"Roles",type:"array","default":[],lookup:"role",items:[],format:"select"},sign_in_count:{key:"sign_in_count",title:"Sign In Count",type:"number",format:"text"},current_sign_in_at:{key:"current_sign_in_at",title:"Current Sign In At",type:"datetime",format:"date"},last_sign_in_at:{key:"last_sign_in_at",title:"Last Sign In At",type:"datetime",format:"date"},current_sign_in_ip:{key:"current_sign_in_ip",title:"Current Sign In Ip",type:"string",format:"text"},last_sign_in_ip:{key:"last_sign_in_ip",title:"Last Sign In Ip",type:"string",format:"text"},failed_attempts:{key:"failed_attempts",title:"Failed Attempts",type:"number",format:"text"},locked_at:{key:"locked_at",title:"Locked At",type:"datetime",format:"date"},password_expired_at:{key:"password_expired_at",title:"Password Expired At",type:"datetime",format:"date"}}}}a.set("user",b())}]);