window&&!window.InflectionJS&&(window.InflectionJS=null),InflectionJS={uncountable_words:["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news","status","info"],plural_rules:[[new RegExp("(m)an$","gi"),"$1en"],[new RegExp("(pe)rson$","gi"),"$1ople"],[new RegExp("(child)$","gi"),"$1ren"],[new RegExp("^(ox)$","gi"),"$1en"],[new RegExp("(ax|test)is$","gi"),"$1es"],[new RegExp("(octop|vir)us$","gi"),"$1i"],[new RegExp("(alias|status)$","gi"),"$1es"],[new RegExp("(bu)s$","gi"),"$1ses"],[new RegExp("(buffal|tomat|potat)o$","gi"),"$1oes"],[new RegExp("([ti])um$","gi"),"$1a"],[new RegExp("sis$","gi"),"ses"],[new RegExp("(?:([^f])fe|([lr])f)$","gi"),"$1$2ves"],[new RegExp("(hive)$","gi"),"$1s"],[new RegExp("([^aeiouy]|qu)y$","gi"),"$1ies"],[new RegExp("(x|ch|ss|sh)$","gi"),"$1es"],[new RegExp("(matr|vert|ind)ix|ex$","gi"),"$1ices"],[new RegExp("([m|l])ouse$","gi"),"$1ice"],[new RegExp("(quiz)$","gi"),"$1zes"],[new RegExp("s$","gi"),"s"],[new RegExp("$","gi"),"s"]],singular_rules:[[new RegExp("(m)en$","gi"),"$1an"],[new RegExp("(pe)ople$","gi"),"$1rson"],[new RegExp("(child)ren$","gi"),"$1"],[new RegExp("([ti])a$","gi"),"$1um"],[new RegExp("((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$","gi"),"$1$2sis"],[new RegExp("(hive)s$","gi"),"$1"],[new RegExp("(tive)s$","gi"),"$1"],[new RegExp("(curve)s$","gi"),"$1"],[new RegExp("([lr])ves$","gi"),"$1f"],[new RegExp("([^fo])ves$","gi"),"$1fe"],[new RegExp("([^aeiouy]|qu)ies$","gi"),"$1y"],[new RegExp("(s)eries$","gi"),"$1eries"],[new RegExp("(m)ovies$","gi"),"$1ovie"],[new RegExp("(x|ch|ss|sh)es$","gi"),"$1"],[new RegExp("([m|l])ice$","gi"),"$1ouse"],[new RegExp("(bus)es$","gi"),"$1"],[new RegExp("(o)es$","gi"),"$1"],[new RegExp("(shoe)s$","gi"),"$1"],[new RegExp("(cris|ax|test)es$","gi"),"$1is"],[new RegExp("(octop|vir)i$","gi"),"$1us"],[new RegExp("(alias|status)es$","gi"),"$1"],[new RegExp("^(ox)en","gi"),"$1"],[new RegExp("(vert|ind)ices$","gi"),"$1ex"],[new RegExp("(matr)ices$","gi"),"$1ix"],[new RegExp("(quiz)zes$","gi"),"$1"],[new RegExp("s$","gi"),""]],non_titlecased_words:["and","or","nor","a","an","the","so","but","to","of","at","by","from","into","on","onto","off","out","in","over","with","for"],id_suffix:new RegExp("(_ids|_id)$","g"),underbar:new RegExp("_","g"),space_or_underbar:new RegExp("[ _]","g"),uppercase:new RegExp("([A-Z])","g"),underbar_prefix:new RegExp("^_"),apply_rules:function(a,b,c,d){if(d)a=d;else{var e=c.indexOf(a.toLowerCase())>-1;if(!e)for(var f=0;f<b.length;f++)if(a.match(b[f][0])){a=a.replace(b[f][0],b[f][1]);break}}return a}},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b,c){b||(b=-1);for(var d=-1,e=b;e<this.length;e++)if(this[e]===a||c&&c(this[e],a)){d=e;break}return d}),String.prototype._uncountable_words||(String.prototype._uncountable_words=InflectionJS.uncountable_words),String.prototype._plural_rules||(String.prototype._plural_rules=InflectionJS.plural_rules),String.prototype._singular_rules||(String.prototype._singular_rules=InflectionJS.singular_rules),String.prototype._non_titlecased_words||(String.prototype._non_titlecased_words=InflectionJS.non_titlecased_words),String.prototype.pluralize||(String.prototype.pluralize=function(a){return InflectionJS.apply_rules(this.toString(),this._plural_rules,this._uncountable_words,a)}),String.prototype.singularize||(String.prototype.singularize=function(a){return InflectionJS.apply_rules(this.toString(),this._singular_rules,this._uncountable_words,a)}),String.prototype.camelize||(String.prototype.camelize=function(a){for(var b=this.toLowerCase(),c=b.split("/"),d=0;d<c.length;d++){for(var e=c[d].split("_"),f=a&&d+1===c.length?1:0,g=f;g<e.length;g++)e[g]=e[g].charAt(0).toUpperCase()+e[g].substring(1);c[d]=e.join("")}return b=c.join("::")}),String.prototype.underscore||(String.prototype.underscore=function(){for(var a=this,b=a.split("::"),c=0;c<b.length;c++)b[c]=b[c].replace(InflectionJS.uppercase,"_$1"),b[c]=b[c].replace(InflectionJS.underbar_prefix,"");return a=b.join("/").toLowerCase()}),String.prototype.humanize||(String.prototype.humanize=function(a){var b=this.toLowerCase();return b=b.replace(InflectionJS.id_suffix,""),b=b.replace(InflectionJS.underbar," "),a||(b=b.capitalize()),b}),String.prototype.capitalize||(String.prototype.capitalize=function(){var a=this.toLowerCase();return a=a.substring(0,1).toUpperCase()+a.substring(1)}),String.prototype.dasherize||(String.prototype.dasherize=function(){var a=this;return a=a.replace(InflectionJS.space_or_underbar,"-")}),String.prototype.titleize||(String.prototype.titleize=function(){var a=this.toLowerCase();a=a.replace(InflectionJS.underbar," ");for(var b=a.split(" "),c=0;c<b.length;c++){for(var d=b[c].split("-"),e=0;e<d.length;e++)this._non_titlecased_words.indexOf(d[e].toLowerCase())<0&&(d[e]=d[e].capitalize());b[c]=d.join("-")}return a=b.join(" "),a=a.substring(0,1).toUpperCase()+a.substring(1)}),String.prototype.demodulize||(String.prototype.demodulize=function(){var a=this,b=a.split("::");return a=b[b.length-1]}),String.prototype.tableize||(String.prototype.tableize=function(){var a=this;return a=a.underscore().pluralize()}),String.prototype.classify||(String.prototype.classify=function(){var a=this;return a=a.camelize().singularize()}),String.prototype.foreign_key||(String.prototype.foreign_key=function(a){var b=this;return b=b.demodulize().underscore()+(a?"":"_")+"id"}),String.prototype.ordinalize||(String.prototype.ordinalize=function(){for(var a=this,b=a.split(" "),c=0;c<b.length;c++){var d=parseInt(b[c]);if(NaN===d){var e=b[c].substring(b[c].length-2),f=b[c].substring(b[c].length-1),g="th";"11"!=e&&"12"!=e&&"13"!=e&&("1"===f?g="st":"2"===f?g="nd":"3"===f&&(g="rd")),b[c]+=g}}return a=b.join(" ")}),window.Modernizr=function(a,b,c){function d(a){n.cssText=a}function e(a,b){return typeof a===b}var f,g,h,i="2.8.3",j={},k=b.documentElement,l="modernizr",m=b.createElement(l),n=m.style,o=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),p={},q=[],r=q.slice,s=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:l+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',l,'">',a,"</style>"].join(""),j.id=l,(m?j:n).innerHTML+=f,n.appendChild(j),m||(n.style.background="",n.style.overflow="hidden",i=k.style.overflow,k.style.overflow="hidden",k.appendChild(n)),g=c(j,a),m?j.parentNode.removeChild(j):(n.parentNode.removeChild(n),k.style.overflow=i),!!g},t={}.hasOwnProperty;h=e(t,"undefined")||e(t.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return t.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=r.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(r.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(r.call(arguments)))};return d}),p.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:s(["@media (",o.join("touch-enabled),("),l,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c};for(var u in p)h(p,u)&&(g=u.toLowerCase(),j[g]=p[u](),q.push((j[g]?"":"no-")+g));return j.addTest=function(a,b){if("object"==typeof a)for(var d in a)h(a,d)&&j.addTest(d,a[d]);else{if(a=a.toLowerCase(),j[a]!==c)return j;b="function"==typeof b?b():b,"undefined"!=typeof enableClasses&&enableClasses&&(k.className+=" "+(b?"":"no-")+a),j[a]=b}return j},d(""),m=f=null,j._version=i,j._prefixes=o,j.testStyles=s,j}(this,this.document),function(a){"use strict";if("undefined"==typeof XLSX)return void console.log("xlsx.js is required. Get it from https://github.com/SheetJS/js-xlsx");if("undefined"==typeof _)return void console.log("Lodash.js is required. Get it from http://lodash.com/");var b=this,c=(b.XLSXReader,function(a,b,d,e){var f={};return c.utils.intializeFromFile(f,a,b,d,e),f});"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.XLSXReader=c):b.XLSXReader=c,c.VERSION="0.0.1",c.utils={intializeFromFile:function(a,b,d,e,f){var g=new FileReader;g.onload=function(b){var g=b.target.result,h=XLSX.read(g,{type:"binary"});a.sheets=c.utils.parseWorkbook(h,d,e),f(a)},g.readAsBinaryString(b)},parseWorkbook:function(a,b,d){if(d===!0)return c.utils.to_json(a);var e={};return _.forEachRight(a.SheetNames,function(d){var f=a.Sheets[d];e[d]=c.utils.parseSheet(f,b)}),e},parseSheet:function(b,c){var d=XLSX.utils.decode_range(b["!ref"]),e=[];return c===!0&&_.forEachRight(_.range(d.s.r,d.e.r+1),function(c){var f=[];_.forEachRight(_.range(d.s.c,d.e.c+1),function(d){var e=XLSX.utils.encode_cell({c:d,r:c}),g=b[e];f[d]=g?g.v:a}),e[c]=f}),{data:e,name:b.name,col_size:d.e.c+1,row_size:d.e.r+1}},to_json:function(a){var b={};return a.SheetNames.forEach(function(c){var d=XLSX.utils.sheet_to_row_object_array(a.Sheets[c]);d.length>0&&(b[c]=d)}),b}}}.call(this);var app=angular.module("angularApp",["ngAria","ngCookies","ngMessages","ngResource","ngRoute","ui.router","ngSanitize","ngTouch","ng-token-auth","angular-underscore","chart.js","angularFileUpload","ngDialog","ng-mfb","ui.select","xeditable","daterangepicker","angular-loading-bar","pascalprecht.translate","schemaForm","formly","formlyBootstrap"]);app.constant("APP",{root:"/",apiPrefix:"/api/",modules:{main:[{text:"Users",url:"users",icon:"fa fa-users color-deep-purple-300"},{text:"Roles",url:"roles",icon:"glyphicon glyphicon-user color-red-100"},{text:"UserForm",url:"form/users",icon:"fa fa-user color-teal-500"}],admin:[{text:"Users",url:"users",icon:"fa fa-briefcase color-deep-purple-300"},{text:"Roles",url:"roles",icon:"fa fa-user color-red-100"}],reports:[{text:"User",url:"user_info",icon:"fa fa-files-o color-teal-500"},{text:"Users",url:"users",icon:"fa fa-clipboard color-blue-grey-500"},{text:"Roles",url:"roles",icon:"fa fa-clipboard"}]}}),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),b.when("/","/main"),a.state("app",{url:"/",templateUrl:"app/layouts/app.html",controller:"AppCtrl",resolve:{auth:["$auth","$state","$rootScope",function(a,b,c){return a.validateUser()["catch"](function(){b.go("login")})}]}}).state("login",{url:"/login",templateUrl:"app/layouts/login.html",controller:"LoginCtrl"}).state("ussd",{url:"/ussd",templateUrl:"app/layouts/ussd.html",controller:"UssdCtrl"}).state("app.dashboard",{url:"dashboard",templateUrl:function(a){return"app/layouts/dashboard.html"},controller:"ModuleCtrl"}).state("app.reports",{url:"reports",templateUrl:function(a){return"app/layouts/reports_module.html"}}).state("app.reports.report",{url:"/:report",templateUrl:function(a){return"app/components/reports/show.html"},controller:"ReportCtrl"}).state("app.module",{url:":module",templateUrl:function(a){return"app/layouts/"+a.module+"_module.html"},controller:"ModuleCtrl"}).state("app.module.form",{url:"/form",templateUrl:function(a){return"app/layouts/form.html"}}).state("app.module.form.model",{url:"/:model",templateUrl:function(a){return"app/components/"+a.model+"/new.html"},controller:"FormCtrl"}).state("app.module.reports",{url:"/report",template:"<div ui-view></div>"}).state("app.module.reports.report",{url:"/:report",templateUrl:function(a){return"app/components/reports/show.html"},controller:"ReportCtrl"}).state("app.module.model",{url:"/:model",templateUrl:function(a){return"app/components/"+a.model+"/index.html"},controller:"IndexCtrl"}).state("app.module.model.index",{url:"/index",templateUrl:function(a){return"app/components/"+a.model+"/index.html"},controller:"IndexCtrl"}).state("app.module.model.new",{url:"/new",templateUrl:function(a){return"app/components/"+a.model+"/new.html"},controller:"FormCtrl"}).state("app.module.model.view",{url:"/:view",templateUrl:function(a){return"app/components/"+a.model+"/"+a.view+".html"},controller:"FormCtrl"}).state("app.module.model.show",{url:"/:id/show",templateUrl:function(a){return"app/components/"+a.model+"/show.html"},controller:"FormCtrl"}).state("app.module.model.edit",{url:"/:id/edit",templateUrl:function(a){return"app/components/"+a.model+"/edit.html"},controller:"FormCtrl"}).state("app.module.model.bulk",{url:"/:id/bulk/:table",templateUrl:function(a){return"app/components/"+a.model+"/bulk.html"},controller:"BulkCtrl"}).state("app.module.model.uploads",{url:"/:id/uploads",templateUrl:function(a){return"app/components/"+a.model+"/uploads.html"},controller:"UploadsCtrl"})}]).config(["$authProvider",function(a){a.configure({apiUrl:"/api",confirmationSuccessUrl:window.location.href.split("#")[0]})}]).factory("auth401Interceptor",["$q","$location",function(a,b){return{responseError:function(c){return 401===c.status&&b.path("/login"),a.reject(c)}}}]).config(["$httpProvider",function(a){a.interceptors.push("auth401Interceptor")}]).factory("$exceptionHandler",function(){return function(a,b){}}).run(["editableOptions",function(a){a.theme="bs3"}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]).run(["formlyConfig","formlyValidationMessages",function(a,b){a.setType({name:"ui-select","extends":"select",templateUrl:"app/templates/ui-select.html"}),a.setType({name:"ui-select-multiple","extends":"ui-select",templateUrl:"app/templates/ui-select-multiple.html"}),a.setType({name:"datepicker","extends":"input",templateUrl:"app/templates/datepicker.html"})}]),angular.module("angularApp").filter("byId",function(){return function(a,b){for(var c=0,d=a.length;d>c;c++)if(+a[c].id==+b)return a[c];return{}}}),angular.module("angularApp").filter("byValue",function(){return function(a,b){for(var c=0,d=a.length;d>c;c++)if(+a[c].value==+b)return a[c];return{}}}),angular.module("angularApp").filter("previousNextIds",function(){return function(a,b){for(var c={previousId:0,nextId:0},d=0,e=a.length;e>d;d++)if(+a[d].id==+b)return d>0&&(c.previousId=a[d-1].id),e-1>d&&(c.nextId=a[d+1].id),c;return c}}),angular.module("angularApp").service("exMsg",["$q",function(a){return{notify:function(a){new PNotify(a)},success:function(a,b){new PNotify({title:b||"Success",text:a,type:"success",nonblock:!0})},error:function(a,b){new PNotify({title:b||"Error",text:a,type:"error",nonblock:!0,nonblock_opacity:.2})},notice:function(a,b){new PNotify({text:a,type:"notice",nonblock:!0,nonblock_opacity:.5})},info:function(a,b){new PNotify({title:b||"Info",text:a,addclass:"custom",opacity:.8,nonblock:!0,nonblock_opacity:.2})},errorSummary:function(a){var b="<ul>";angular.forEach(a,function(a){b+="<li>"+a+"</li>"}),b+="</ul>",new PNotify({title:"Error Summary",text:b,type:"error",hide:!1})},confirm:function(b,c){var d=a.defer();return sweetAlert({title:c||"Confirm",text:b,type:"warning",showCancelButton:!0,animation:"slide-from-top"},function(a){return a?(d.resolve(!0),!0):(d.reject(!1),!1)}),d.promise},clear:function(){PNotify.removeAll()},sweetAlert:sweetAlert,prompt:function(b,c){var d=a.defer();return sweetAlert({title:c||"Input Needed",text:b,type:"input",showCancelButton:!0,animation:"slide-from-top"},function(a){return a===!1?(d.reject(!1),!1):(d.resolve(a),!0)}),d.promise}}}]),angular.module("angularApp").directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)},isExcel:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|vnd.openxmlformats-officedocument.spreadsheetml.sheet|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)){var h=c.find("canvas"),i=new FileReader;if(i.onload=e,b.isImage(g.file))i.readAsDataURL(g.file);else if(!b.isExcel(g.file))return}}}}}]),angular.module("angularApp").directive("ngFile",function(){return{scope:{ngFile:"="},link:function(a,b,c){b.bind("change",function(b){a.$apply(function(){"multiple"in c?a.ngFile=b.target.files:a.ngFile=b.target.files[0]})})}}}),angular.module("angularApp").service("resourceManager",["$q","$http","$resource",function(a,b,c){var d={models:{}};return d.getName=function(a){return a=a.replace(/-/gi,"_"),a=a.underscore().split("_"),a=a.slice(0,a.length-1).join("_").camelize()+a[a.length-1].classify()},d.getUrl=function(a){return a=a.underscore().split("_"),a=a.slice(0,a.length-1).join("_").camelize()+a[a.length-1].pluralize().camelize(),a.underscore()},d.getModel=function(a,b){return b=b||{},b.name=a=this.getName(a),b.url||(b.url=this.getUrl(a)),b.key||(b.key=a.underscore()),b.title||(b.title=b.url.titleize()),b},d.register=function(a,b,d,e){if(a=this.getName(a),d=d||{id:"@id"},e=e||{},!this.models[a]){var f=c(b,d,{query:{method:"GET",isArray:!0},update:{method:"PUT"}});app.factory(a,function(){return f}),this.models[a]=this.getModel(a,e),this.models[a].apiUrl=b,this.models[a].klass=f}return this.models[a]},d.query=function(b,c,d){var e=a.defer();return b=this.getName(b),this.models[b].klass.query(c,function(a,b){a.error||a.errors?e.reject(a):e.resolve(a),d&&d(a,b("_meta_total"))},function(a){e.reject(a)}).$promise["catch"](function(a){window.error=a,e.reject({message:"Sorry, you do not have permission."})}),e.promise},d.get=function(b,c,d){var e=a.defer();return b=this.getName(b),this.models[b].klass.get(c,function(a,b){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d.create=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$save(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d.update=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$update(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d["delete"]=function(b,c,d){var e=a.defer();return b=this.getName(b),new this.models[b].klass(c).$delete(function(a){a.error?e.reject(a):e.resolve(a),d&&d(a)},function(a){console.log(a)}),e.promise},d}]),angular.module("angularApp").service("reportService",["$document",function(a){return{toCSV:function(b,c,d,e){var f=this.objectify(c);d=d||this.getColumns(f),b=b||"Report",e=e||!0;var g="Report_"+(new Date).toISOString().replace(/\:/g,"-").replace(".","-")+".csv",h="";if(h+=b+"\r\n\n",e){var i=_.chain(d).map(function(a){return a.title}).value().join(",");h+=i+"\r\n"}h+=_.chain(f).map(function(a){return _.chain(d).map(function(b){return a[b.key]}).value().join(",")}).value().join("\r\n");var j="data:text/csv;charset=utf-8,"+escape(h),k=a[0].createElement("a");k.href=j,k.style.visibility="hidden",k.download=g,a[0].body.appendChild(k),k.click(),a[0].body.removeChild(k)},toPDF:function(a,b,c){var d=this.objectify(b);c=c||this.getColumns(d),a=a||"Report";var e="Report_"+(new Date).toISOString().replace(/\:/g,"-").replace(".","-")+".pdf",f=new jsPDF("l","pt"),g=function(b,c,d){b.setFontSize(20),b.text(a,d.margins.horizontal,60),b.setFontSize(d.fontSize)};f.autoTable(c,d,{renderHeader:g,margins:{horizontal:40,top:80,bottom:50}}),f.save(e)},objectify:function(a){return"object"!=typeof a?JSON.parse(a):a},getColumns:function(a){var b=["string","number"],c=a[0];return _.chain(c).keys().reject(function(a){return 0==a.indexOf("$")}).filter(function(a){return b.indexOf(typeof c[a])>=0}).map(function(a){return{title:a,key:a}}).value()}}}]),angular.module("angularApp").factory("XLSXReaderService",["$q","$rootScope",function(a,b){var c=function(a){angular.extend(this,a)};return c.readFile=function(c,d,e){var f=a.defer();return XLSXReader(c,d,e,function(a){b.$apply(function(){f.resolve(a)})}),f.promise},c}]),angular.module("angularApp").service("fieldService",function(){var a={},b={get:function(b){return angular.copy(a[b])||[]},set:function(b,c){a[b]=c}};return b}),angular.module("angularApp").service("lookupService",["APP","$http",function(a,b){var c={};return{get:function(a,b){return c[a]||this.load(a),c[a][b]},load:function(d,e){var f=a.apiPrefix+"lookups/"+d;return b.get(f,{cache:!0,params:{models:e}}).success(function(a){return c[d]=a,a})}}}]),angular.module("angularApp").service("formService",function(){var a={},b={get:function(b){return angular.copy(a[b])||[]},set:function(b,c){a[b]=c}};return b}),angular.module("angularApp").run(["formService","fieldService",function(a,b){function c(){return[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"name",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"status",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"permissions",fieldHtmlClass:"input-lg"}]}]}]}function d(){return[{fieldGroup:[{className:"col-xs-6",key:"name",type:"input",templateOptions:{required:!0,label:"Name"}},{className:"col-xs-6",key:"status",type:"input",templateOptions:{required:!1,label:"Status"}}]},{fieldGroup:[{className:"col-xs-12",key:"permissions",type:"ui-select-multiple",templateOptions:{required:!1,label:"Permissions",valueProp:"name",labelProp:"name",options:[]},controller:["$scope","lookupService",function(a,b){b.load("role","permission").then(function(){a.to.options=b.get("role","permission")})}]}]}]}a.set("role",c()),b.set("role",d())}]),angular.module("angularApp").run(["formService","fieldService",function(a,b){function c(){return[]}function d(){return[]}a.set("user",c()),b.set("user",d())}]),angular.module("angularApp").controller("LoginCtrl",["$scope","$auth","$http","$state","exMsg","APP",function(a,b,c,d,e,f){var g=a;window.loginCtrl=g,g.$on("auth:registration-email-success",function(a,b){var c="A registration email was sent to "+b.email+". Follow the instructions contained in the email to complete registration.";e.sweetAlert({title:"Registration",text:c,type:"success"})}),g.$on("auth:registration-email-error",function(a,b){}),g.$on("auth:login-success",function(a,b){d.go("app")}),g.$on("auth:login-error",function(a,b){e.sweetAlert("Failed",b.errors[0],"error")}),g.sendPasswordResetEmail=function(){e.sweetAlert({title:"Password Reset",text:"Email",type:"input",showCancelButton:!0,animation:"slide-from-top"},function(a){return a===!1?!1:""===a?(e.sweetAlert.showInputError("No email provided!"),!1):void b.requestPasswordReset({email:a}).then(function(a){e.sweetAlert("Successful",a.message,"success")})["catch"](function(a){e.sweetAlert("Error",a.errors[0],"error")})})},g.sendConfirmationInstructions=function(){e.sweetAlert({title:"Confirmation Instructions",text:"Email",type:"input",showCancelButton:!0,animation:"slide-from-top"},function(a){return a===!1?!1:""===a?(e.sweetAlert.showInputError("No email provided!"),!1):void c.post(f.apiPrefix+"users/send_confirmation_instructions",{email:a,redirect_url:window.location.href.split("#")[0]}).success(function(a){a.error?e.sweetAlert("Error",a.message,"error"):e.sweetAlert("Successful",a.message,"success")})})}}]),angular.module("angularApp").controller("AppCtrl",["$scope","$http","$auth","$q","$state","APP","exMsg","$stateParams",function(a,b,c,d,e,f,g,h){var i=a;window.appCtrl=i,i.modules=f.modules||{},i.state={isIndex:!0,isNew:!1,isShow:!1,isEdit:!1,isUploads:!1,isBulk:!1,hideNameGrid:!1,hideFormNav:!1,update:function(a){a&&(this.isIndex="app.module.model"===a.name,this.isNew="app.module.model.new"===a.name||"app.module.form.model"===a.name,this.isShow="app.module.model.show"===a.name,this.isEdit="app.module.model.edit"===a.name,this.isBulk="app.module.model.bulk"===a.name,this.isUploads="app.module.model.uploads"===a.name,this.hideNameGrid=this.isIndex||this.isBulk,this.hideFormNav=this.isBulk)}},i.hasAccess=function(a){var b=a||"";if(b=b.replace(/-/gi,"_"),b.indexOf(":")<0)if(b=b.split("?")[0],b.indexOf("/")<0)b=b.classify()+":index";else{var d=/^([A-z-_]+)\/new/gi,e=/^([A-z-_]+)\/(\d+)\/show/gi,f=/^([A-z-_]+)\/(\d+)\/edit/gi,g=d.exec(b),h=e.exec(b),i=f.exec(b);g?b=g[1].classify()+":create":h?b=h[1].classify()+":show":i&&(b=i[1].classify()+":update")}var j=_.find(c.user.permissions,function(a){return a===b});return void 0===j?!1:!0},i.error=function(a){a=a||{},a.message&&g.error(a.message,a.type||"Error"),a.messages&&g.errorSummary(a.messages)},i.back=function(){e.go("^")},i.state.update(i.state.update(e.current)),i.$on("$stateChangeSuccess",function(a,b,c,d,e){i.state.update(b)}),i.hasUrl=function(a){return window.location.hash.indexOf(a)>=0},i.buildQ=function(a){return _.map(a,function(a,b){return b+".eq."+a}).join(":")},i.splitQ=function(a){var b={};return a.split(":").forEach(function(a){var c=a.split(".eq.");c[1]&&(b[c[0]]=c[1])}),b},i.$on("auth:logout-success",function(a){e.go("login")}),i.$on("auth:logout-error",function(a){g.error("Unable to complete logout. Please try again.")}),i.showPasswordChange=function(){g.sweetAlert({title:"Change Password",text:"Current Password:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Current Password"},function(a){return a===!1?!1:""===a?(g.sweetAlert.showInputError("No password provided!"),!1):void g.sweetAlert({title:"Change Password",text:"New Password:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password"},function(d){return d===!1?!1:""===d?(g.sweetAlert.showInputError("No password provided!"),!1):void g.sweetAlert({title:"Change Password",text:"New Password Again:",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"New Password Again"},function(e){return e===!1?!1:""===e?(g.sweetAlert.showInputError("No password provided!"),!1):void b.post(f.apiPrefix+"users/"+c.user.id+"/change_password",{current_password:a,password:d,password_confirmation:e}).success(function(a){a.error?g.sweetAlert(a.message,(a.messages||[]).join("\n"),"error"):g.sweetAlert("Great!","Password changed successfully","success")})["catch"](function(a){g.sweetAlert("Nice!","You wrote: "+inputValue,"error")})})})})}}]),angular.module("angularApp").controller("ModuleCtrl",["$scope","APP",function(a,b){var c=a;window.moduleCtrl=c,c.partials={fab:"app/partials/floating-action-button.html",filterInput:"app/partials/filter-input.html",header:"app/partials/header.html",searchForm:"app/partials/search-form.html",indexGrid:"app/partials/index-grid.html",nameGrid:"app/partials/name-grid.html",loadMoreButton:"app/partials/load-more-button.html",formNav:"app/partials/form-nav.html",formlyForm:"app/partials/formly-form.html",schemaForm:"app/partials/schema-form.html",formNewButtons:"app/partials/form-new-buttons.html",formShowButtons:"app/partials/form-show-buttons.html",formEditButtons:"app/partials/form-edit-buttons.html",bulkNav:"app/partials/bulk-nav.html",bulkGrid:"app/partials/bulk-grid.html",uploadsGrid:"app/partials/uploads-grid.html"},c.hideFloatingActionButton=!0,c.fabActions=[],c.fabMenuState="closed",c.drpOptions={showDropdowns:!0,ranges:{Today:[new Date,new Date],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),new Date],"Last 30 Days":[moment().subtract(29,"days"),new Date],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left"},c.drpOptionsR={showDropdowns:!0,ranges:{Today:[new Date,new Date],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),new Date],"Last 30 Days":[moment().subtract(29,"days"),new Date],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"right"},c.$on("$stateChangeStart",function(a,b,d,e,f){c.hideFloatingActionButton=!0}),c.$on("fab:load-actions",function(a,b,d){var e=["fa fa-columns","fa fa-link","fa fa-th-large","fa fa-file-o"];c.fabActions=_.map(d,function(a){return{icon:a.icon||e.pop(),label:a.label,handler:function(){a.handler&&a.handler()}}}).reverse(),c.hideFloatingActionButton=!1})}]),angular.module("angularApp").controller("IndexCtrl",["$scope","$rootScope","$state","$stateParams","$q","$http","APP","resourceManager","$filter","exMsg","byValueFilter","reportService","lookupService","byIdFilter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=a;window.indexCtrl=o,o.model={},o.modelName=null,o.grid={},o.recordsHash={},o.records=[],o.currentRecord={},o.searchQuery=null,o.action={loading:!1,searching:!1,deleting:!1},o.paging={totalRecords:0,recordsPerPage:15,currentPage:1,previousId:0,currentId:0,nextId:0},o.init=function(a){o.modelName=a,o.model=h.register(a,g.apiPrefix+a.replace(/-/gi,"_")+"/:id"),o.loadConfig()},o.loadConfig=function(){f.get(g.apiPrefix+"config/"+o.model.url).success(function(a){o.lookups=a.lookups,o.schema=a.schema,o.grid=a.grid,b.$broadcast("model:index-config-loaded",o.model.name,a,o)}).error(function(a,b,c,d){j.error("error")})},o.$on("model:do-search",function(a,b,c){b===o.modelName&&(o.recordsHash={},o.records=[],o.paging.currentPage=1,o.queryRecords(1,1e3,c))}),o.$on("$stateChangeSuccess",function(a,c,d,e,f){if(o.state.isIndex){var g=[];o.hasCreateAccess()&&g.push({icon:"fa fa-plus",label:"New "+o.model.name,handler:o["new"]}),g.push({icon:"fa fa-search",label:"Search",handler:o.showSearch}),b.$broadcast("fab:load-actions",o.model.name,g)}}),o.showSearch=function(){o.action.searching=!0},o.hideSearch=function(){o.action.searching=!1},o["new"]=function(){c.go(".new")},o.queryRecords=function(a,c,d){o.action.loading=!0,d||(d=o.searchQuery||{}),d.page=a||o.paging.currentPage,d.size=c||o.paging.recordsPerPage,h.query(o.model.name,d,function(a,b){o.paging.totalRecords=b}).then(function(a){o.updateRecords(a),b.$broadcast("model:records-loaded",o.model.name,o.records,o)})["catch"](function(a){console.log(a),o.error(a)})["finally"](function(a){o.action.loading=!1})},o.hasCreateAccess=function(){return o.hasAccess(o.model.name+":create")},o.hasShowAccess=function(){return o.hasAccess(o.model.name+":show")},o.hasUpdateAccess=function(){return o.hasAccess(o.model.name+":update")},o.hasDeleteAccess=function(){return o.hasAccess(o.model.name+":delete")},o.$on("model:record-loaded",function(a,b,c){o.model.name==b&&(o.currentRecord=c,o.paging.currentId=c.id,o.updatePreviousNext())}),o.updatePreviousNext=function(){if(0!=o.records.length&&0!=o.paging.currentId){var a=i("previousNextIds")(o.records,o.paging.currentId);a&&(o.paging.previousId=a.previousId,o.paging.nextId=a.nextId)}},o.fieldData=function(b,c){var d=a.schema.properties[c],e=d&&d.lookup||!1,f=b[c];return e?k(o.lookups[e],f).name:f},o.polishRecord=function(a){a&&a.id&&m.load(o.model.key).then(function(b){var c=b.data;angular.forEach(o.schema.properties,function(b,d){b.lookup&&c[b.lookup]&&(a[b.lookup]=k(c[b.lookup],a[d]))})})},o.updateRecords=function(a){angular.forEach(a,function(a){o.recordsHash[a.id]||(o.records.push(a),o.recordsHash[a.id]=!0,o.polishRecord(a))})},o.updateRecordInRecords=function(a){if(a){var b=_.findIndex(o.records,_.pick(a,"id"));b>=0&&(o.records[b]=angular.copy(a),o.polishRecord(o.records[b]))}},o.removeRecordInRecords=function(a){if(a){var b=_.findIndex(o.records,_.pick(a,"id"));b>=0&&(o.records.splice(b,1),delete o.recordsHash[a.id])}},o.$on("model:record-loaded",function(a,b,c){o.model.name===b&&o.updateRecordInRecords(c)}),o.$on("model:record-created",function(a,b,c){o.model.name===b&&(o.records.unshift(angular.copy(c)),o.recordsHash[c.id]=!0,o.polishRecord(o.records[0]))}),o.$on("model:record-updated",function(a,b,c){
o.model.name===b&&o.updateRecordInRecords(c)}),o.$on("model:record-deleted",function(a,b,c){o.model.name===b&&o.removeRecordInRecords(c)}),o.reload=function(){o.recordsHash={},o.records=[],o.paging.currentPage=1,o.queryRecords()},o.loadMore=function(){o.records.length<o.paging.totalRecords&&(o.paging.currentPage=o.paging.currentPage+1,o.queryRecords())},o.setSearchQuery=function(a){o.searchQuery=a},o.$watch("paging.recordsPerPage",function(){o.queryRecords()}),o["delete"]=function(a){o.action.deleting=!0;var c="Are you sure you want to delete this "+o.schema.title+"?";j.confirm(c,"Confirm Delete").then(function(){var c={id:a};c[o.model.key]=o.record,h["delete"](o.model.name,c).then(function(a){b.$broadcast("model:record-deleted",o.model.name,a),j.success(o.schema.title+" deleted successfully")})["catch"](function(a){o.error(a)})["finally"](function(){o.action.deleting=!1})})["catch"](function(){o.action.deleting=!1})},o.toCSV=function(){var a=_.chain(o.grid).map(function(a){return{key:a,title:o.schema.properties[a].title}}).value(),c=_.map(o.records,function(a){var b={};return _.each(o.grid,function(c){b[c]=o.fieldData(a,c)||""}),b});l.toCSV(o.model.title,c,a),b.$broadcast("report:csv-generated",o.model.name)},o.toPDF=function(){var a=_.chain(o.grid).map(function(a){return{key:a,title:o.schema.properties[a].title}}).value(),c=_.map(o.records,function(a){var b={};return _.each(o.grid,function(c){b[c]=o.fieldData(a,c)||""}),b});l.toPDF(o.model.title,c,a),b.$broadcast("report:pdf-generated",o.model.name)},o.modelName||o.init(d.model)}]),angular.module("angularApp").controller("FormCtrl",["$scope","$rootScope","APP","resourceManager","exMsg","$state","$stateParams","$http","$translate","fieldService","formService",function(a,b,c,d,e,f,g,h,i,j,k){var l=a;window.formCtrl=l,l.model={},l.modelName=null,l.recordId=null,l.record={},l.action={loading:!0,saving:!1,creating:!1,updating:!1,deleting:!1},l.schema={},l.formlyFields={},l.formlyOptions={},l.formlyForm={},l.init=function(a,b){l.modelName=a,l.model=d.register(a,c.apiPrefix+a.replace(/-/gi,"_")+"/:id"),l.formlyFields=j.get(l.model.key),l.loadConfig(),b&&(l.recordId=b,l.loadRecord(b))},l.loadConfig=function(){h.get(c.apiPrefix+"config/"+l.model.url).success(function(a){l.schema=a.schema,l.setDisableFields(),l.form=k.get(l.model.key),b.$broadcast("model:form-config-loaded",l.model.name,a,l),l.setRecord()}).error(function(a,b,c,d){e.error("error")})},l.loadRecord=function(a){if(a){l.action.loading=!0;var c={id:a};d.get(l.model.name,c).then(function(a){l.record=a,l.sanitizeRecord(),b.$broadcast("model:record-loaded",l.model.name,l.record,l),l.action.loading=!1,l.$broadcast("schemaFormRedraw")})["catch"](function(a){l.error(a),l.action.loading=!1})}},l.$on("$stateChangeSuccess",function(a,c,d,e,g){var h=[];l.state.isShow&&l.hasCreateAccess()&&h.push({icon:"fa fa-plus",label:"New "+l.model.name,handler:function(){f.go("^.new")}}),h.push({icon:"fa fa-chevron-left",label:"Close",handler:l.redirectBack}),b.$broadcast("fab:load-actions",l.model.name,h)}),l.hasCreateAccess=function(){return l.hasAccess(l.model.name+":create")},l.hasShowAccess=function(){return l.hasAccess(l.model.name+":show")},l.hasUpdateAccess=function(){return l.hasAccess(l.model.name+":update")},l.hasDeleteAccess=function(){return l.hasAccess(l.model.name+":delete")},l.setDisableFields=function(){"app.module.model.show"===f.$current.name?angular.forEach(l.schema.properties,function(a){a.readonly=!0}):angular.forEach(l.schema.properties,function(a){a.readonly=!1}),l.$broadcast("schemaFormRedraw")},l.$on("model:reload-record",function(a,b,c){b===l.model.name&&c.id===l.record.id&&l.loadRecord(l.record.id)}),l.sanitizeRecord=function(){_.each(l.record,function(a,b){null===a&&(l.record[b]="")})},l.setRecord=function(){!l.record.id&&g.q&&(_.each(l.splitQ(g.q),function(a,b){l.record[b]=a}),b.$broadcast("model:record-set",l.model.name,l.record,l))},l.close=function(){l.record={},f.go("^")},l.redirectBack=function(){l.record={},"app.module.form.model"===f.$current.name?f.go(".",g,{reload:!0}):f.go("^")},l.create=function(a){l.action.saving=!0,l.action.creating=!0;var c={};c[l.model.key]=l.record,d.create(l.model.name,c).then(function(c){b.$broadcast("model:record-created",l.model.name,c,l),e.success(l.schema.title+" created successfully"),l.record.id=c.id,a&&l.redirectBack()})["catch"](function(a){l.error(a)})["finally"](function(){l.action.saving=!1,l.action.creating=!1})},l.edit=function(){f.go("^.edit",g)},l.uploads=function(){f.go("^.uploads",g)},l.update=function(a){if(l.record.id){l.action.saving=!0,l.action.updating=!0;var c={id:l.record.id};c[l.model.key]=l.record,d.update(l.model.name,c).then(function(c){b.$broadcast("model:record-updated",l.model.name,c,l),e.success(l.schema.title+" updated successfully"),a&&l.redirectBack()})["catch"](function(a){l.error(a)})["finally"](function(){l.action.saving=!1,l.action.updating=!1})}},l.save=function(a){PNotify.removeAll(),l.$broadcast("schemaFormValidate"),(!l.formObject||l.formObject.$valid)&&(void 0===a&&(a=!0),l.record.id?l.update(a):l.create(a))},l["delete"]=function(){l.action.deleting=!0;var a="Are you sure you want to delete this "+l.schema.title+"?";e.confirm(a,"Confirm Delete").then(function(){var a={id:l.record.id};a[l.model.key]=l.record,d["delete"](l.model.name,a).then(function(a){b.$broadcast("model:record-deleted",l.model.name,l.record,l),e.success(l.schema.title+" deleted successfully"),l.redirectBack()})["catch"](function(a){l.error(a)})["finally"](function(){l.action.deleting=!1})})["catch"](function(){l.action.deleting=!1})},l.modelName||l.init(g.model,g.id)}]),angular.module("angularApp").controller("ReportCtrl",["$scope","APP","$http","$state","$stateParams","$sce",function(a,b,c,d,e,f){var g=a;window.reportCtrl=g,g.action={generating:!1},g.report={},g.filter={},g.reports={user_info:{name:"user_info",title:"User",fields:[{key:"user_id",type:"select",templateOptions:{label:"Select User",valueProp:"id",labelProp:"name",options:[]},controller:["$scope","$http",function(a,c){c.get(b.apiPrefix+"users?size=200").success(function(b){a.options.templateOptions.options=b})}]}]},users:{name:"users",title:"Users",fields:[]},roles:{name:"roles",title:"Roles",fields:[]}},g.generateReport=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name;c.get(a,{params:g.filter}).success(function(a){var b="data:application/pdf;base64,"+a;g.pdfSrc=f.trustAsResourceUrl(b)})["finally"](function(){g.action.generating=!1})},g.renderReportPage=function(){var a=e.report;g.report=g.reports[a],g.report&&g.report.fields&&(g.fields=g.report.fields)},g.previewReport=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".html";c.get(a,{params:g.filter}).success(function(a){g.report.html=f.trustAsHtml(a)})["finally"](function(){g.action.generating=!1})},g.downloadAsCSV=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".csv";c.get(a,{params:g.filter}).success(function(a){console.log(a);var b="data:text/csv;charset=utf-8,"+a,c=f.trustAsResourceUrl(b),d=angular.element("<a></a>");d.attr("href",c),d.attr("download",g.report.name+".csv"),d[0].click()})["finally"](function(){g.action.generating=!1})},g.downloadAsXLS=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".xls";c.get(a,{params:g.filter}).success(function(a){console.log(a);var b="data:application/xls;"+a,c=f.trustAsResourceUrl(b),d=angular.element("<a></a>");d.attr("href",c),d.attr("download",g.report.name+".xls"),d[0].click()})["finally"](function(){g.action.generating=!1})},g.downloadAsPDF=function(){g.action.generating=!0;var a=g.report.url||b.apiPrefix+"reports/"+g.report.name+".pdf";c.get(a,{params:g.filter}).success(function(a){var b="data:application/pdf;base64,"+a,c=f.trustAsResourceUrl(b),d=angular.element("<a></a>");d.attr("href",c),d.attr("download",g.report.name+".pdf"),d[0].click()})["finally"](function(){g.action.generating=!1})},g.renderReportPage()}]),angular.module("angularApp").controller("UserCtrl",["$scope","$rootScope","APP","exMsg","$http","$state","$stateParams",function(a,b,c,d,e,f,g){function h(a){var b=["sign_in_count","current_sign_in_at","last_sign_in_at","current_sign_in_ip","last_sign_in_ip","failed_attempts","name","image","email","role_ids","status"];angular.forEach(a.schema.properties,function(c,d){b.indexOf(d)<0&&delete a.schema.properties[d]}),a.form=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"name",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"email",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"sign_in_count",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"failed_attempts",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"current_sign_in_at",fieldHtmlClass:"input-lg",pickadate:{selectYears:!0,selectMonths:!0}}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"last_sign_in_at",fieldHtmlClass:"input-lg",pickadate:{selectYears:!0,selectMonths:!0}}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"current_sign_in_ip",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"last_sign_in_ip",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row large-tags-",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"role_ids",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"status",fieldHtmlClass:"input-lg"}]}]}]}function i(a){a.schema.properties.password={title:"Password",type:"string"},a.schema.properties.password_confirmation={title:"Confirm Password",type:"string"},a.schema.properties.enforce_confirmation={title:"Enforce Email Confirmation",type:"boolean","default":!1},a.form=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"name",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"email",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"password",type:"password",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"password_confirmation",type:"password",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row large-tags",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"role_ids",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"enforce_confirmation",fieldHtmlClass:"input-lg"}]}]},{type:"conditional",condition:"record.enforce_confirmation",items:[{type:"help",helpvalue:'<div class="alert alert-info">A confirmation email will be sent to the User to confirm this account</div>'}]}]}function j(a){a.form=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"name",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-sm-6 col-xs-12",items:[{key:"email",fieldHtmlClass:"input-lg"}]}]},{type:"section",htmlClass:"row large-tags-",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"role_ids",fieldHtmlClass:"input-lg"}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"status",fieldHtmlClass:"input-lg"}]}]}]}var k=a;window.userCtrl=k,k.stateParams=g,k.state=f,k.$on("model:index-config-loaded",function(a,b,c,d){"User"===b&&(d.grid=["name","email","current_sign_in_at","current_sign_in_ip"])}),k.$on("model:form-config-loaded",function(a,c,d,e){"User"===c&&(e.schema.required=["name","email"],e.schema.properties.status={title:"Status",type:"string",readonly:!0},"app.module.model.show"===f.$current.name?(h(e),b.$broadcast("ui:form-updated",c,{},e)):"app.module.model.edit"===f.$current.name?(j(e),b.$broadcast("ui:form-updated",c,{},e)):(i(e),b.$broadcast("ui:form-updated",c,{},e)))}),k.$on("model:record-loaded",function(a,b,f,g){"User"===b&&(g.lockUser=function(){g.action.locking=!0,e.post(c.apiPrefix+"users/"+f.id+"/lock").success(function(a){g.record=a,d.success("User successfully locked")})["catch"](function(a){d.error(a.message)})["finally"](function(){g.action.locking=!1})},g.unlockUser=function(){g.action.unlocking=!0,e.post(c.apiPrefix+"users/"+f.id+"/unlock").success(function(a){g.record=a,d.success("User successfully unlocked")})["catch"](function(a){d.error(a.message)})["finally"](function(){g.action.unlocking=!1})},g.resetPassword=function(){})})}]),angular.module("angularApp").controller("UiCtrl",["$scope","APP","$http","$state","$stateParams",function(a,b,c,d,e){function f(a){a.services=a.schema.properties.service_ids.items,a.$watch("record.service_ids",function(){a.record.service_ids&&(_.each(a.record.service_ids,function(b){var c=_.findWhere(a.record.subscriptions_attributes,{service_id:b});void 0===c?a.record.subscriptions_attributes.push({service_id:b,subscription_status_id:1,_destroy:!1}):c._destroy=!1}),_.each(a.record.subscriptions_attributes,function(b,c){var d=a.record.service_ids.indexOf(b.service_id);0>d&&(b.id?b._destroy=!0:a.record.subscriptions_attributes.splice(c,1))}))},!0)}var g=a;window.uiCtrl=g,g.$on("model:index-config-loaded",function(a,b,c,d){}),g.$on("model:form-config-loaded",function(a,b,c,e){"Client"===b&&(f(e),"app.module.model.new"===d.$current.name&&(e.record.subscriptions_attributes=[]))}),g.$on("ui:form-updated",function(a,b){"User"===b&&g.user["admin?"]})}]),angular.module("angularApp").controller("SearchCtrl",["$scope","$rootScope",function(a,b){var c=a;window.searchCtrl=c,c.search={fields:[],inputType:"",params:{},queries:{}},c.$on("model:index-config-loaded",function(a,b,d){c.initSearch(d.schema.properties)}),c.initSearch=function(a){c.search.fields=_.map(a,function(a,b){return a.key=b,a.inputType="text","string"===a.type&&"date"===a.format?a.inputType="date":"number"===a.type&&"uiselect"===a.format&&(a.inputType="select"),a}),c.search.dateRange={startDate:moment(),endDate:moment()}},c.$watch("search.searchField",function(){c.search.searchField&&"date"===c.search.searchField.inputType&&(c.search.searchValue=[new Date,new Date])}),c.getQueryParams=function(){var a=_.reduce(c.search.params,function(a,b,d){var e=_.findWhere(c.search.fields,{key:d});return e?("date"===e.inputType?a[d+".between"]=_.map(b,function(a){return a.startDate.toString()+"|"+a.endDate.toString()}).join("||"):"select"===e.inputType?a[d+".in"]=b.join():"text"===e.inputType&&(a[d+".like"]=b.join("|")),a):a},{});if(c.search.dateRange&&c.search.dateRange.startDate){var b=c.search.dateRange.startDate.toString(),d=c.search.dateRange.endDate.toString();a["created_at.between"]=b+"|"+d}return a},c.buildSearchQueries=function(){c.search.queries=_.reduce(c.search.params,function(a,b,d){var e=_.findWhere(c.search.fields,{key:d});if(!e)return a;var f=e.title+": ";if("select"===e.inputType){var g=_.map(b,function(a){var b=_.findWhere(e.items,{value:a})||{};return b.label});f+=_.uniq(g)}else if("date"===e.inputType){var g=_.map(b,function(a){var b=new Date(a.startDate).toISOString().slice(0,10),c=new Date(a.endDate).toISOString().slice(0,10);return b===c?b:"("+b+","+c+")"});f+=_.uniq(g)}else f+=_.uniq(b);return a[d]=f,a},{})},c.addSearchParam=function(){if(c.search.searchField&&c.search.searchValue){var a=c.search.searchField.key;c.search.params[a]||(c.search.params[a]=[]),c.search.params[a].push(c.search.searchValue),c.search.searchValue=null,c.buildSearchQueries()}},c.clearSearchParams=function(){c.search.params={},c.search.queries={}},c.removeSearchParam=function(a){delete c.search.params[a],c.buildSearchQueries()},c.doSearch=function(){b.$broadcast("model:do-search",c.modelName,c.getQueryParams())},c.schema&&c.schema.properties&&c.initSearch(c.schema.properties)}]),angular.module("angularApp").controller("DashboardCtrl",["$scope","APP","$http",function(a,b,c){var d=a;window.dashboardCtrl=d,d.labels=["January","February","March","April","May","June","July"],d.series=["Series A","Series B"],d.data=[[65,59,80,81,56,55,40],[28,48,40,19,86,27,90]],d.labels2=["Download Sales","In-Store Sales","Mail-Order Sales","Tele Sales"],d.data2=[300,100,40,120],d.onClick=function(a,b){console.log(a,b)},d.monthlySummary=[],d.dailySummary=[],d.monthlyTotals={},d.dailyTotals={}}]),angular.module("angularApp").controller("UploadsCtrl",["$scope","$rootScope","APP","exMsg","$state","$stateParams","$http","$translate","resourceManager","FileUploader",function(a,b,c,d,e,f,g,h,i,j){var k=a;k.uploader=new j,window.uploadsCtrl=k,k.model={},k.modelName=null,k.recordId=null,k.record={},k.action={loading:!0,saving:!1,updating:!1},k.schema={},k.init=function(a,b){k.modelName=a,k.model=i.register(a,c.apiPrefix+a.replace(/-/gi,"_")+"/:id"),k.loadConfig(),k.recordId=b,k.loadRecord(b)},k.loadConfig=function(){g.get(c.apiPrefix+"config/"+k.model.url).success(function(a){k.schema=a.schema,b.$broadcast("model:uploads-config-loaded",k.model.name,a,k),k.setRecord()}).error(function(a,b,c,e){d.error("error")})},k.loadRecord=function(a){if(a){k.action.loading=!0;var c={id:a};i.get(k.model.name,c).then(function(a){k.record=a,k.sanitizeRecord(),b.$broadcast("model:record-loaded",k.model.name,k.record,k),k.action.loading=!1})["catch"](function(a){k.error(a),k.action.loading=!1})}},k.hasUpdateAccess=function(){return k.hasAccess(k.model.name+":update")},k.$on("model:reload-record",function(a,b,c){b===k.model.name&&c.id===k.record.id&&k.loadRecord(k.record.id)}),k.sanitizeRecord=function(){_.each(k.record,function(a,b){null===a&&(k.record[b]="")})},k.setRecord=function(){!k.record.id&&f.q&&(_.each(k.splitQ(f.q),function(a,b){k.record[b]=a}),b.$broadcast("model:record-set",k.model.name,k.record,k))},k.modelName||k.init(f.model,f.id)}]),angular.module("angularApp").controller("BulkCtrl",["$scope","$rootScope","APP","exMsg","$stateParams","$http","$translate","resourceManager","XLSXReaderService",function(a,b,c,d,e,f,g,h,i){var j=a;window.bulkCtrl=j,j.model={},j.modelName=null,j.masterRecordId=null,j.action={loading:!0,saving:!1,updating:!1},j.schema={},j.upload={},j.upload.matchedFields={},j.upload.matchFields=[],j.$watch("upload.file",function(a){a&&(j.upload.selectedSheet="",i.readFile(j.upload.file,!0,!0).then(function(a){j.upload.data=a,j.upload.selectedSheet=_.keys(a.sheets)[0]}))}),j.$watch("upload.selectedSheet",function(){var a=j.upload.data.sheets[j.upload.selectedSheet];return a?(j.upload.selectedHeaders=_.chain(a[0]).keys().pull("$$hashKey").value(),j.upload.records=a,void b.$broadcast("model:bulk-automatch-fields",j.model.name,{},j)):(j.upload.selectedHeaders=[],void(j.upload.records=[]))}),j.init=function(a,b){j.modelName=a,j.model=h.register(a,c.apiPrefix+a.replace(/-/gi,"_")+"/:id"),j.loadConfig(),j.masterRecordId=b},j.loadConfig=function(){f.get(c.apiPrefix+"config/"+j.model.url).success(function(a){j.schema=a.schema,j.upload.matchFields=_.map(j.schema.properties,function(a,b){return{key:b,title:a.title}}),b.$broadcast("model:bulk-config-loaded",j.model.name,a,j)}).error(function(a,b,c,e){d.error("error")})},j.$on("model:bulk-automatch-fields",function(a,b,c,d){j.model.name===b&&(d.upload.matchedFields={},_.each(d.upload.selectedHeaders,function(a){var b=_.find(d.upload.matchFields,function(b){return b.title.toUpperCase()===a.toUpperCase()});b&&(d.upload.matchedFields[a]=b.key)}))}),j.bulkUpload=function(){var a=h.getUrl(e.model)+"/"+j.masterRecordId,b=_.map(j.upload.records,function(a){var b={};return _.each(j.upload.matchedFields,function(c,d){b[c]=a[d]}),b});f.post(c.apiPrefix+a+"/bulk_upload",{table:j.model.url,data:b}).success(function(a){a.error?d.error(a.message,a.type):(j.upload.data={},j.upload.selectedSheet="",j.upload.records=[],d.success(a.length+" records created successfully"))}).error(function(a,b,c,e){d.error("error")})},j.init(e.table,e.id)}]);